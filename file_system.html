<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›²ç«¯æª”æ¡ˆç®¡ç†ç³»çµ± - éœ€æ±‚åˆ†æèˆ‡è¨­è¨ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ä½¿ç”¨æ¨™æº– Script è¼‰å…¥ Mermaid ä»¥ç¢ºä¿å…¨åŸŸå­˜å–ç©©å®šæ€§ -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        .tree-node { margin-left: 20px; border-left: 1px dashed #ccc; padding-left: 10px; position: relative; }
        .file-icon { color: #6b7280; }
        .folder-icon { color: #f59e0b; }
        .tab-content { display: none; opacity: 0; transition: opacity 0.3s ease-in-out; }
        .tab-content.active { display: block; opacity: 1; }
        .tab-btn.active { 
            border-bottom: 4px solid #1e40af; 
            color: #1e40af; 
            font-weight: 700;
        }
        .mermaid { min-height: 250px; display: flex; justify-content: center; }
        .control-panel { background: #f8fafc; border: 1px solid #e2e8f0; }
        .delete-btn { opacity: 0; transition: opacity 0.2s; }
        .tree-item-row:hover .delete-btn { opacity: 1; }
        #terminal-output { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 font-sans leading-relaxed">

    <div class="max-w-5xl mx-auto py-12 px-6">
        <!-- Header -->
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-extrabold text-blue-800 mb-4">é›²ç«¯æª”æ¡ˆç®¡ç†ç³»çµ±åˆ†æèˆ‡è¨­è¨ˆ</h1>
            <p class="text-lg text-gray-600">ç³»çµ±åˆ†æå¸«ï¼šGemini | ä¿®æ­£å¾Œçš„è³‡æ–™åº«æ¶æ§‹èˆ‡å¯¦ä½œ</p>
        </header>

        <!-- Tab Navigation -->
        <div class="flex border-b border-gray-200 mb-8 sticky top-0 bg-gray-50 z-20">
            <button onclick="openTab(event, 'arch')" class="tab-btn active px-6 py-3 text-gray-500 hover:text-blue-600 transition-all focus:outline-none">ç³»çµ±æ¶æ§‹</button>
            <button onclick="openTab(event, 'domain')" class="tab-btn px-6 py-3 text-gray-500 hover:text-blue-600 transition-all focus:outline-none">é ˜åŸŸæ¨¡å‹ (UML)</button>
            <button onclick="openTab(event, 'er')" class="tab-btn px-6 py-3 text-gray-500 hover:text-blue-600 transition-all focus:outline-none">è³‡æ–™åº«è¨­è¨ˆ (ERD)</button>
            <button onclick="openTab(event, 'demo')" class="tab-btn px-6 py-3 text-gray-500 hover:text-blue-600 transition-all focus:outline-none">ç³»çµ± Demo</button>
            <button onclick="openTab(event, 'java')" class="tab-btn px-6 py-3 text-gray-500 hover:text-blue-600 transition-all focus:outline-none">Java å¯¦ä½œ</button>
        </div>

        <!-- 1. ç³»çµ±æ¶æ§‹èªªæ˜ -->
        <div id="arch" class="tab-content active">
            <section class="bg-white p-8 rounded-xl shadow-sm border border-gray-200">
                <h2 class="text-2xl font-bold border-b-2 border-blue-500 pb-2 mb-6">1. æ ¸å¿ƒè¨­è¨ˆè¦ç¯„</h2>
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-semibold mb-3 text-blue-700">ä¿®æ­£å¾Œçš„è³‡æ–™åº«æ€è·¯</h3>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li><strong>æ­£è¦åŒ–å¯¦é«”</strong>ï¼šé€é `USERS` èˆ‡ `NODES` çš„é—œè¯å¯¦ä½œæ¬Šé™åŸºç¤ã€‚</li>
                            <li><strong>é«˜æ“´å……æ€§</strong>ï¼šæ¡ç”¨ TPT æ¨¡å¼ï¼Œæœªä¾†è‹¥æ–°å¢ã€Œå½±ç‰‡ã€æˆ–ã€ŒéŸ³æ¨‚ã€é¡å‹ï¼Œåªéœ€å¢åŠ å…ƒæ•¸æ“šè¡¨ï¼Œä¸å½±éŸ¿æ ¸å¿ƒè¡¨çµæ§‹ã€‚</li>
                            <li><strong>éšå±¤å„ªåŒ–</strong>ï¼š`NODES` è¡¨çš„ `parent_id` å»ºç«‹ç´¢å¼•ï¼Œå„ªåŒ–éè¿´è®€å–æ•ˆèƒ½ã€‚</li>
                        </ul>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold mb-3 text-blue-800">æ¥­å‹™è¦å‰‡æ‘˜è¦</h3>
                        <p class="text-sm">
                            ç³»çµ±æ”¯æ´ç„¡é™å±¤ç´šç›®éŒ„ã€‚æª”æ¡ˆç¸½å¤§å°ç‚ºå…¶æ‰€åœ¨ç¯€é»æ‰€æœ‰å­é …ç›®çš„æ¬Šé‡ç¸½å’Œã€‚XML åŒ¯å‡ºæ”¯æ´æ¨™æº–æ¨™ç±¤å®šç¾©ï¼Œä¾¿æ–¼è·¨å¹³å°æ•´åˆã€‚
                        </p>
                    </div>
                </div>
            </section>
        </div>

        <!-- 2. Domain Model (UML) -->
        <div id="domain" class="tab-content">
            <section class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <h2 class="text-2xl font-bold border-b-2 border-blue-500 pb-2 mb-6">2. é ˜åŸŸæ¨¡å‹ (Domain Model)</h2>
                
                <!-- åŸå§‹è¨­è¨ˆ -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-blue-700 mb-3">ğŸ“‹ è¨­è¨ˆæ–¹å¼ 1: åŸºæœ¬æ¨¹ç‹€çµæ§‹ (Composite Pattern)</h3>
                    <div class="overflow-x-auto py-4">
                        <pre class="mermaid">
classDiagram
    class Node {
        &lt;&lt;abstract&gt;&gt;
        +UUID id
        +String name
        +DateTime created_at
        +get_display_name() String
        +toXML() String
        +getTotalSize() long
    }

    class Folder {
        +List~Node~ children
        +add_child(Node node)
        +remove_child(UUID id)
        +find_by_extension(String ext) List~Node~
    }

    class File {
        &lt;&lt;abstract&gt;&gt;
        +long size_bytes
        +get_size_display() String
    }

    class WordDocument { +int pages }
    class ImageFile { +int width, int height }
    class TextFile { +String encoding }

    Node <|-- Folder
    Node <|-- File
    File <|-- WordDocument
    File <|-- ImageFile
    File <|-- TextFile
    Folder "1" o-- "*" Node : contains
                        </pre>
                    </div>
                </div>

                <!-- Visitor Pattern è¨­è¨ˆ -->
                <div>
                    <h3 class="text-lg font-semibold text-blue-700 mb-3">âœ¨ è¨­è¨ˆæ–¹å¼ 2: Visitor Pattern (è¨ªå•è€…æ¨¡å¼)</h3>
                    <p class="text-gray-600 text-sm mb-4">
                        ä½¿ç”¨ Visitor Pattern å¯ä»¥å°‡ä¸åŒçš„æ“ä½œï¼ˆå¦‚å¤§å°è¨ˆç®—ã€æœå°‹ã€åŒ¯å‡ºç­‰ï¼‰èˆ‡è³‡æ–™çµæ§‹åˆ†é›¢ï¼Œ
                        ä½¿å¾—æ–°å¢æ“ä½œæ™‚ç„¡éœ€ä¿®æ”¹ç¾æœ‰çš„ç¯€é»é¡åˆ¥ã€‚æ¯å€‹è¨ªå•è€…è² è²¬ç‰¹å®šæ“ä½œçš„é‚è¼¯ã€‚
                    </p>
                    <div class="overflow-x-auto py-4">
                        <pre class="mermaid">
classDiagram
    class SystemEntryComponent {
        &lt;&lt;abstract&gt;&gt;
        #String name
        #DateTime created
        #int size
        #String attributes
        +abstract String getType()
        +abstract void accept(IVisitor visitor)
        +String getSizeDisplay()
    }

    class FileLeaf {
        &lt;&lt;abstract&gt;&gt;
        +void accept(IVisitor visitor)
    }

    class DirectoryComposite {
        -List~SystemEntryComponent~ children
        +void add(SystemEntryComponent child)
        +void remove(SystemEntryComponent child)
        +SystemEntryComponent[] getChildren()
        +String getType()
        +void accept(IVisitor visitor)
    }

    class WordDocumentLeaf {
        -int pages
        +int getPages()
    }
    class ImageFileLeaf {
        -int width
        -int height
        +int getWidth()
        +int getHeight()
    }
    class TextFileLeaf {
        -String encoding
        +String getEncoding()
    }

    class IVisitor {
        &lt;&lt;interface&gt;&gt;
        +void visit(FileLeaf leaf)
        +void visit(DirectoryComposite composite)
    }

    class DepthManagedVisitor {
        &lt;&lt;interface&gt;&gt;
        +void increaseDepth()
        +void decreaseDepth()
    }

    class SizeCalculatorVisitor {
        -long totalSize
        +void visit(FileLeaf leaf)*
        +void visit(DirectoryComposite composite)*
        +long getTotalSize()
    }

    class FileSearchVisitor {
        -String extension
        -List~FileLeaf~ results
        +void visit(FileLeaf leaf)*
        +void visit(DirectoryComposite composite)*
        +List~FileLeaf~ getResults()
    }

    class DisplayVisitor {
        -int depth
        -StringBuilder output
        -boolean isRoot
        +void visit(FileLeaf leaf)*
        +void visit(DirectoryComposite composite)*
        +void increaseDepth()
        +void decreaseDepth()
        +String getOutput()
    }

    class XMLExportVisitor {
        -int depth
        -StringBuilder xmlOutput
        -boolean isRoot
        -Queue~String~ pendingCloseTags
        +void visit(FileLeaf leaf)*
        +void visit(DirectoryComposite composite)*
        +void increaseDepth()
        +void decreaseDepth()
        +String getXMLOutput()
    }

    SystemEntryComponent <|-- FileLeaf
    SystemEntryComponent <|-- DirectoryComposite
    FileLeaf <|-- WordDocumentLeaf
    FileLeaf <|-- ImageFileLeaf
    FileLeaf <|-- TextFileLeaf
    DirectoryComposite "1" o-- "*" SystemEntryComponent : contains
    IVisitor <|.. SizeCalculatorVisitor
    IVisitor <|.. FileSearchVisitor
    IVisitor <|.. DisplayVisitor
    IVisitor <|.. XMLExportVisitor
    DepthManagedVisitor <|.. DisplayVisitor
    DepthManagedVisitor <|.. XMLExportVisitor
    SystemEntryComponent --> IVisitor : depend
                        </pre>
                    </div>
                    
                    <div class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <h4 class="font-bold text-blue-700 mb-2">ğŸ’¡ Visitor Pattern çš„å„ªå‹¢ï¼š</h4>
                        <ul class="text-sm text-gray-700 list-disc list-inside space-y-1">
                            <li><strong>é–‹æ”¾å°é–‰åŸå‰‡</strong>ï¼šæ–°å¢æ“ä½œæ™‚ç„¡éœ€ä¿®æ”¹ç¯€é»é¡åˆ¥ï¼Œåªéœ€æ–°å¢ Visitor å¯¦ä½œ</li>
                            <li><strong>è·è²¬åˆ†é›¢</strong>ï¼šè³‡æ–™çµæ§‹èˆ‡æ“ä½œé‚è¼¯å®Œå…¨åˆ†é›¢ï¼Œä»£ç¢¼æ›´æ˜“ç¶­è­·</li>
                            <li><strong>æ“´å±•æ€§å¼·</strong>ï¼šæ”¯æ´çµ±è¨ˆã€æœå°‹ã€é©—è­‰ã€å‚™ä»½ç­‰å¤šç¨®æ“ä½œï¼Œæ¯å€‹éƒ½æ˜¯ç¨ç«‹çš„ Visitor</li>
                            <li><strong>é›™é‡åˆ†æ´¾</strong>ï¼šæ ¹æ“šè¨ªå•è€…å’Œç¯€é»çš„å…·é«”é¡å‹æ±ºå®šåŸ·è¡Œçš„æ–¹æ³•</li>
                            <li><strong>ç°¡æ½”è¨­è¨ˆ</strong>ï¼šVisitor æ¥å£åªéœ€å…©å€‹ Visit æ–¹æ³•ï¼ˆè‘‰å­ã€è¤‡åˆç¯€é»ï¼‰</li>
                        </ul>
                    </div>

                    <div class="mt-4 p-4 bg-amber-50 rounded-lg border border-amber-200">
                        <h4 class="font-bold text-amber-700 mb-2">ğŸ“ å¯¦ä½œé—œéµï¼š</h4>
                        <pre class="text-xs bg-white p-2 rounded border border-amber-100 overflow-x-auto"><code>// åŸºç¤å…ƒä»¶å®šç¾© accept æ–¹æ³•
abstract class SystemEntryComponent {
    abstract void accept(IVisitor visitor)
}

// è‘‰å­ç¯€é»å¯¦ä½œ
abstract class FileLeaf extends SystemEntryComponent {
    void accept(IVisitor visitor) {
        visitor.visit(this)
    }
}

// è¤‡åˆç¯€é»å¯¦ä½œ
class DirectoryComposite extends SystemEntryComponent {
    List children = []
    
    void accept(IVisitor visitor) {
        visitor.visit(this)        // è¨ªå•è‡ªèº«
        visitor.increaseDepth()
        children.forEach(child => child.accept(visitor))  // éè¿´è¨ªå•å­ç¯€é»
        visitor.decreaseDepth()
    }
}

// è¨ªå•è€…æ¥å£ - ç°¡æ½”è¨­è¨ˆ
interface IVisitor {
    void visit(FileLeaf leaf)
    void visit(DirectoryComposite composite)
    void increaseDepth()      // é€²å…¥å­ç›®éŒ„æ™‚å¢åŠ æ·±åº¦
    void decreaseDepth()      // é›¢é–‹å­ç›®éŒ„æ™‚æ¸›å°‘æ·±åº¦
}</code></pre>
                    </div>

                    <div class="mt-4 p-4 bg-red-50 rounded-lg border border-red-200">
                        <h4 class="font-bold text-red-700 mb-2">â“ ç‚ºä»€éº¼éœ€è¦ increaseDepth å’Œ decreaseDepthï¼Ÿ</h4>
                        <p class="text-sm text-gray-700 mb-3">
                            é€™å…©å€‹æ–¹æ³•ç”¨ä¾†<strong>ç®¡ç†æ¨¹éæ­·æ™‚çš„æ·±åº¦</strong>ï¼Œç¢ºä¿è¨ªå•è€…çŸ¥é“ç•¶å‰åœ¨æ¨¹çš„å“ªä¸€å±¤ï¼Œé€²è€Œè¼¸å‡ºæ­£ç¢ºçš„ç¼©è¿›ã€‚
                        </p>
                        <div class="bg-white p-3 rounded border border-red-100 text-xs">
                            <strong>å…·é«”ä¾‹å­ï¼š</strong>
                            <pre class="mt-2 overflow-x-auto"><code>çµæ§‹ï¼š
ğŸ“ æ ¹ç›®éŒ„ (depth=0)
  ğŸ“ è³‡æ–™å¤¾1 (depth=1)
    ğŸ“„ æª”æ¡ˆ1 (depth=2)
  ğŸ“„ æª”æ¡ˆ2 (depth=1)

è¨ªå•é †åºï¼š
1. visit(æ ¹ç›®éŒ„)         // è¼¸å‡º"ğŸ“ æ ¹ç›®éŒ„"
2. increaseDepth()       // depth=0â†’1
3. visit(è³‡æ–™å¤¾1)        // è¼¸å‡º"  ğŸ“ è³‡æ–™å¤¾1"
4. increaseDepth()       // depth=1â†’2
5. visit(æª”æ¡ˆ1)          // è¼¸å‡º"    ğŸ“„ æª”æ¡ˆ1"
6. decreaseDepth()       // depth=2â†’1
7. visit(æª”æ¡ˆ2)          // è¼¸å‡º"  ğŸ“„ æª”æ¡ˆ2"
8. decreaseDepth()       // depth=1â†’0

ç¼©è¿› = "  ".repeat(depth)ï¼Œæ‰€ä»¥ï¼š
- depth=0: ç„¡ç¼©è¿›
- depth=1: "  " (2å€‹ç©ºæ ¼)
- depth=2: "    " (4å€‹ç©ºæ ¼)</code></pre>
                        </div>
                        <p class="text-sm text-gray-700 mt-3">
                            <strong>é—œéµè¨­è¨ˆï¼š</strong>ç”± DirectoryComposite çš„ accept() æ–¹æ³•è² è²¬ç®¡ç†æ·±åº¦å¢æ¸›ï¼Œ
                            Visitor çš„ visit() æ–¹æ³•åªä½¿ç”¨ depth å€¼ï¼Œä¸ä¿®æ”¹å®ƒã€‚é€™æ¨£å¯ä»¥è®“è¨ªå•è€…çš„é‚è¼¯ä¿æŒç°¡æ½”ã€‚
                        </p>
                    </div>

                    <div class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                        <h4 class="font-bold text-yellow-700 mb-2">âš–ï¸ æ¡ç”¨ã€Œæ¥å£éš”é›¢åŸå‰‡ã€çš„è¨­è¨ˆ</h4>
                        <p class="text-sm text-gray-700 mb-3">
                            <strong>è¨­è¨ˆæ”¹é€²ï¼š</strong>å‰µå»ºå…©å€‹æ¥å£ï¼Œåªæœ‰éœ€è¦æ·±åº¦ç®¡ç†çš„ Visitor æ‰å¯¦ç¾ DepthManagedVisitorã€‚
                        </p>
                        <pre class="text-xs bg-white p-2 rounded border border-yellow-100 overflow-x-auto"><code>// åŸºç¤è¨ªå•è€…æ¥å£
interface IVisitor {
    void visit(FileLeaf leaf)
    void visit(DirectoryComposite composite)
}

// éœ€è¦æ·±åº¦ç®¡ç†çš„è¨ªå•è€…æ¥å£
interface DepthManagedVisitor extends IVisitor {
    void increaseDepth()
    void decreaseDepth()
}

// DirectoryComposite çš„ accept æ–¹æ³•
void accept(IVisitor visitor) {
    visitor.visit(this);
    if (visitor instanceof DepthManagedVisitor) {
        DepthManagedVisitor dmv = (DepthManagedVisitor) visitor;
        dmv.increaseDepth();
        this.children.forEach(child => child.accept(visitor));
        dmv.decreaseDepth();
    } else {
        // ä¸éœ€è¦æ·±åº¦ç®¡ç†çš„è¨ªå•è€…
        this.children.forEach(child => child.accept(visitor));
    }
}

// å¯¦ç¾ç¯„ä¾‹
class SizeCalculatorVisitor implements IVisitor {
    // åªå¯¦ç¾å¿…è¦çš„æ–¹æ³•ï¼Œç„¡éœ€ç©ºæ–¹æ³•
}

class DisplayVisitor implements DepthManagedVisitor {
    private int depth = 0;
    
    @Override
    public void increaseDepth() { depth++; }
    
    @Override
    public void decreaseDepth() { if (depth > 0) depth--; }
}</code></pre>
                        <p class="text-sm text-gray-700 mt-3">
                            <strong>å„ªå‹¢ï¼š</strong>
                        </p>
                        <ul class="text-sm text-gray-700 list-disc list-inside space-y-1">
                            <li>âœ… <strong>æ¥å£éš”é›¢</strong>ï¼šåªå¼·åˆ¶å¯¦ç¾å¿…è¦çš„æ–¹æ³•</li>
                            <li>âœ… <strong>ä»£ç¢¼æ¸…æ™°</strong>ï¼šä¸€ç›®äº†ç„¶èª°éœ€è¦æ·±åº¦ç®¡ç†</li>
                            <li>âœ… <strong>éˆæ´»æ“´å±•</strong>ï¼šæ–°å¢ Visitor æ™‚ç„¡éœ€æ±ºå®šæ˜¯å¦å¯¦ç¾ç©ºæ–¹æ³•</li>
                            <li>âœ… <strong>ç¬¦åˆ SOLID åŸå‰‡</strong>ï¼šå®¢æˆ¶ç«¯åªä¾è³´éœ€è¦çš„æ¥å£</li>

                        </ul>
                        <p class="text-sm text-yellow-700 mt-3 font-bold">
                            ğŸ’¡ æœ¬å¯¦ä½œä¸­æ¡ç”¨äº†ã€Œå¯¦ç¾ç©ºæ–¹æ³•ã€çš„æ–¹å¼ï¼Œé€™å°æ–¼å°å‹é …ç›®æ˜¯å¯æ¥å—çš„æŠ˜è¡·æ–¹æ¡ˆã€‚
                            ä½†å°æ–¼å¤§å‹é …ç›®ï¼Œæ‡‰å„ªå…ˆè€ƒæ…®ã€Œæ¥å£éš”é›¢ã€çš„æ–¹æ¡ˆã€‚
                        </p>
                    </div>

                    <div class="mt-4 p-4 bg-green-50 rounded-lg border border-green-200">
                        <h4 class="font-bold text-green-700 mb-2">ğŸ”§ å…·é«” Visitor å¯¦ç¾ç¯„ä¾‹ï¼š</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h5 class="text-sm font-bold text-green-700 mb-1">å¤§å°è¨ˆç®—å™¨</h5>
                                <pre class="text-xs bg-white p-2 rounded border border-green-100 overflow-x-auto"><code>class SizeCalculatorVisitor {
    totalSize = 0
    
    visit(leaf: FileLeaf) {
        totalSize += leaf.size
    }
    
    visit(composite: DirectoryComposite) {
        // åªè¨˜éŒ„è¨ªå•äº‹ä»¶
        // éè¿´ç”± accept è™•ç†
    }
    
    getTotalSize() {
        return totalSize
    }
}</code></pre>
                            </div>
                            <div>
                                <h5 class="text-sm font-bold text-green-700 mb-1">æ–‡ä»¶æœå°‹å™¨</h5>
                                <pre class="text-xs bg-white p-2 rounded border border-green-100 overflow-x-auto"><code>class FileSearchVisitor {
    extension: String
    results: List = []
    
    visit(leaf: FileLeaf) {
        if (leaf.name.endsWith(extension)) {
            results.push(leaf)
        }
    }
    
    visit(composite: DirectoryComposite) {
        // ç›´æ¥è¨ªå•ï¼Œéè¿´ç”±
        // accept æ–¹æ³•è™•ç†
    }
    
    getResults() {
        return results
    }
}</code></pre>
                            </div>
                        </div>
                        <div class="mt-2">
                            <h5 class="text-sm font-bold text-green-700 mb-1">XML åŒ¯å‡ºå™¨</h5>
                            <pre class="text-xs bg-white p-2 rounded border border-green-100 overflow-x-auto"><code>class XMLExportVisitor {
    xmlOutput: String = ""
    depth: int = 0
    
    visit(leaf: FileLeaf) {
        indent = "  ".repeat(depth)
        xmlOutput += `${indent}<${leaf.name} type="${leaf.type}"></${leaf.name}>\n`
    }
    
    visit(composite: DirectoryComposite) {
        if (!isRoot) {
            indent = "  ".repeat(depth)
            xmlOutput += `${indent}<${composite.name} type="ç›®éŒ„">\n`
        }
        isRoot = false
        // å­ç¯€é»éè¿´ç”± accept æ–¹æ³•è™•ç†
        // å›åˆ°æ­¤å±¤å¾Œé—œé–‰æ¨™ç±¤
        if (depth > 0) {
            indent = "  ".repeat(depth)
            xmlOutput += `${indent}</${composite.name}>\n`
        }
    }
    
    increaseDepth() { depth++ }
    decreaseDepth() { if (depth > 0) depth-- }
    getXMLOutput() { return xmlOutput }
}</code></pre>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- 3. ER Diagram (ä¿®æ­£å¾Œçš„è¨­è¨ˆ) -->
        <div id="er" class="tab-content">
            <section class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <h2 class="text-2xl font-bold border-b-2 border-blue-500 pb-2 mb-6">3. ä¿®æ­£å¾Œçš„è³‡æ–™åº«è¨­è¨ˆ (ER Diagram)</h2>
                <div class="overflow-x-auto py-4">
                    <pre class="mermaid">
erDiagram
    USERS ||--o{ NODES : "owns"
    NODES ||--o{ NODES : "contains (parent_id)"
    NODES ||--o| FILES : "specializes"
    FILES ||--o| WORD_DOCS : "is_type"
    FILES ||--o| IMAGE_FILES : "is_type"
    FILES ||--o| TEXT_FILES : "is_type"

    USERS {
        uuid id PK
        string username "ä½¿ç”¨è€…åç¨±"
        string email "é›»å­éƒµä»¶"
    }

    NODES {
        uuid id PK
        uuid parent_id FK "çˆ¶ç¯€é» ID"
        uuid owner_id FK "æ“æœ‰è€… ID"
        string name "åç¨±"
        enum node_type "FOLDER, FILE"
        datetime created_at
        datetime updated_at
    }

    FILES {
        uuid node_id PK, FK "é—œè¯è‡³ NODES"
        bigint size_bytes "æª”æ¡ˆå¤§å°"
        string checksum "æ ¡é©—ç¢¼"
    }

    WORD_DOCS {
        uuid file_id PK, FK
        int page_count "é æ•¸"
        string author "ä½œè€…"
    }

    IMAGE_FILES {
        uuid file_id PK, FK
        int width "åƒç´ å¯¬"
        int height "åƒç´ é«˜"
        string color_space "å¦‚ RGB"
    }

    TEXT_FILES {
        uuid file_id PK, FK
        string encoding "å¦‚ UTF-8"
        boolean has_bom "æ˜¯å¦æœ‰ BOM"
    }
                    </pre>
                </div>
                <div class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-100">
                    <h4 class="font-bold text-gray-700 mb-2">ä¿®æ­£é‡é»è§£æï¼š</h4>
                    <ul class="text-sm text-gray-600 list-disc list-inside space-y-1">
                        <li><strong>å¯¦é«”åŒ–ä½¿ç”¨è€…</strong>ï¼šæª”æ¡ˆç³»çµ±ä¸å†æ˜¯å­¤ç«‹çš„ï¼Œç¾åœ¨æ¯å€‹ç¯€é»éƒ½æœ‰æ˜ç¢ºçš„ `owner_id`ã€‚</li>
                        <li><strong>è§£æ±ºç©ºå€¼å•é¡Œ</strong>ï¼šé€é `FILES` ä¸­ä»‹è¡¨èˆ‡å„ `_METADATA` è¡¨çš„ 1:1 é—œè¯ï¼Œè³‡æ–™åº«ä¸­ä¸å†æœ‰å¤§é‡çš„ NULL æ¬„ä½ã€‚</li>
                        <li><strong>ç¶­è­·ä¸€è‡´æ€§</strong>ï¼šå°‡ `updated_at` ç¨ç«‹å‡ºä¾†ï¼Œæ–¹ä¾¿è¿½è¹¤è³‡æ–™å¤¾å…§å®¹çš„æœ€å¾Œè®Šå‹•æ™‚é–“ã€‚</li>
                    </ul>
                </div>
            </section>
        </div>

        <!-- 4. ç³»çµ±å¯¦ä½œèˆ‡ Demo -->
        <div id="demo" class="tab-content">
            <section class="space-y-6">
                <!-- äº’å‹•æ§åˆ¶é¢æ¿ -->
                <div class="control-panel p-6 rounded-xl shadow-sm">
                    <h3 class="text-lg font-bold mb-4 text-blue-800 flex items-center">
                        <span class="mr-2">ğŸ› ï¸</span> äº’å‹•æ§åˆ¶é¢æ¿
                    </h3>
                    
                    <!-- æ–°å¢åŠŸèƒ½åˆ— -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1 uppercase">æ–°å¢è‡³è³‡æ–™å¤¾</label>
                            <select id="parent-select" class="w-full p-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 bg-white"></select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1 uppercase">ç‰©ä»¶é¡å‹</label>
                            <select id="type-select" onchange="toggleFields()" class="w-full p-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 bg-white">
                                <option value="FOLDER">ğŸ“ è³‡æ–™å¤¾</option>
                                <option value="WORD">ğŸ“„ Word æª”æ¡ˆ</option>
                                <option value="IMAGE">ğŸ–¼ï¸ åœ–ç‰‡æª”æ¡ˆ</option>
                                <option value="TEXT">ğŸ“„ ç´”æ–‡å­—æª”</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1 uppercase">åç¨±</label>
                            <div class="flex gap-2">
                                <input type="text" id="node-name" placeholder="åç¨±" class="flex-grow p-2 border border-gray-300 rounded text-sm">
                                <button onclick="handleAddNode()" class="bg-blue-600 text-white px-4 rounded text-sm font-bold">æ–°å¢</button>
                            </div>
                        </div>
                    </div>

                    <!-- é€²éšæ“ä½œæŒ‰éˆ•åˆ— -->
                    <div class="border-t border-gray-200 pt-4 mt-2">
                        <label class="block text-xs font-bold text-gray-400 mb-3 uppercase tracking-widest">é€²éšåˆ†æåŠŸèƒ½</label>
                        <div class="flex flex-wrap gap-3">
                            <button onclick="showTotalSize()" class="bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-bold py-2 px-4 rounded shadow-sm transition-colors">
                                ğŸ“Š è¨ˆç®—ç¸½å¤§å°
                            </button>
                            <button onclick="findDocxFiles()" class="bg-amber-600 hover:bg-amber-700 text-white text-xs font-bold py-2 px-4 rounded shadow-sm transition-colors">
                                ğŸ” æ‰¾å°‹ .docx æª”æ¡ˆ
                            </button>
                            <button onclick="exportToXML()" class="bg-purple-600 hover:bg-purple-700 text-white text-xs font-bold py-2 px-4 rounded shadow-sm transition-colors">
                                ğŸ“œ åŒ¯å‡º XML æ ¼å¼
                            </button>
                            <button onclick="refreshUI()" class="bg-gray-500 hover:bg-gray-600 text-white text-xs font-bold py-2 px-4 rounded shadow-sm transition-colors ml-auto">
                                ğŸ”„ é‚„åŸçµæ§‹æª¢è¦–
                            </button>
                        </div>
                    </div>

                    <!-- ç‰¹æ®Šæ¬„ä½ -->
                    <div id="extra-fields" class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-4 hidden p-3 bg-blue-50 rounded">
                        <div id="field-pages">
                            <label class="block text-xs font-bold text-gray-500 mb-1">é æ•¸</label>
                            <input type="number" id="node-pages" value="1" class="w-full p-2 border rounded text-sm">
                        </div>
                        <div id="field-width" class="hidden">
                            <label class="block text-xs font-bold text-gray-500 mb-1">å¯¬åº¦</label>
                            <input type="number" id="node-width" value="1920" class="w-full p-2 border rounded text-sm">
                        </div>
                        <div id="field-height" class="hidden">
                            <label class="block text-xs font-bold text-gray-500 mb-1">é«˜åº¦</label>
                            <input type="number" id="node-height" value="1080" class="w-full p-2 border rounded text-sm">
                        </div>
                        <div id="field-encoding" class="hidden">
                            <label class="block text-xs font-bold text-gray-500 mb-1">ç·¨ç¢¼</label>
                            <select id="node-encoding" class="w-full p-2 border rounded text-sm">
                                <option value="UTF-8">UTF-8</option>
                                <option value="ASCII">ASCII</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">å¤§å° (B)</label>
                            <input type="number" id="node-size" value="1024" class="w-full p-2 border rounded text-sm">
                        </div>
                    </div>
                </div>

                <!-- çµæœå‘ˆç¾ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <h3 id="terminal-title" class="text-sm font-bold mb-3 text-gray-400 uppercase tracking-widest">çµ‚ç«¯æ©Ÿè¼¸å‡º</h3>
                        <div class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-xs overflow-x-auto border-l-4 border-green-500 h-96 shadow-inner">
                            <pre id="terminal-output">// ç³»çµ±æº–å‚™å°±ç·’...</pre>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <h3 class="text-sm font-bold mb-3 text-gray-400 uppercase tracking-widest">è¦–è¦ºåŒ–çµæ§‹åœ–</h3>
                        <div id="tree-visual" class="space-y-1 bg-gray-50 p-4 rounded-lg border border-gray-100 h-96 overflow-y-auto shadow-inner text-sm"></div>
                    </div>
                </div>
            </section>
        </div>

        <!-- 5. Java å¯¦ä½œ -->
        <div id="java" class="tab-content">
            <section class="space-y-6">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h2 class="text-2xl font-bold border-b-2 border-blue-500 pb-2 mb-6">5. Java å®Œæ•´å¯¦ä½œ</h2>
                    
                    <div class="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <h3 class="font-bold text-blue-700 mb-3">ğŸ“¦ é …ç›®çµæ§‹</h3>
                        <pre class="text-xs bg-white p-2 rounded border border-blue-100 overflow-x-auto">FileSystemDemo/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ SystemEntryComponent.java
â”‚   â”œâ”€â”€ FileLeaf.java
â”‚   â”œâ”€â”€ DirectoryComposite.java
â”‚   â”œâ”€â”€ WordDocument.java
â”‚   â”œâ”€â”€ ImageFile.java
â”‚   â”œâ”€â”€ TextFile.java
â”‚   â”œâ”€â”€ IVisitor.java
â”‚   â”œâ”€â”€ DepthManagedVisitor.java
â”‚   â”œâ”€â”€ SizeCalculatorVisitor.java
â”‚   â”œâ”€â”€ FileSearchVisitor.java
â”‚   â”œâ”€â”€ DisplayVisitor.java
â”‚   â”œâ”€â”€ XMLExportVisitor.java
â”‚   â””â”€â”€ FileSystemDemo.java
â””â”€â”€ README.md</pre>
                    </div>

                    <div class="mb-6">
                        <button onclick="downloadJavaProject()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-colors flex items-center gap-2">
                            <span>ğŸ“¥</span> ä¸€éµä¸‹è¼‰å®Œæ•´ Java å°ˆæ¡ˆ
                        </button>
                    </div>

                    <!-- Java ä»£ç¢¼å±•ç¤º -->
                    <div class="space-y-4">
                        <div>
                            <h3 class="text-lg font-semibold text-blue-700 mb-2">ğŸ“„ æ ¸å¿ƒé¡åˆ¥</h3>
                            
                            <!-- SystemEntryComponent -->
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-4">
                                <h4 class="font-bold text-gray-700 mb-2">SystemEntryComponent.java</h4>
                                <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public abstract class SystemEntryComponent {
    protected String name;
    protected java.time.LocalDateTime created;
    protected long size;
    protected String attributes;
    
    public SystemEntryComponent(String name) {
        this.name = name;
        this.created = java.time.LocalDateTime.now();
        this.size = 0;
    }
    
    public abstract String getType();
    public abstract void accept(IVisitor visitor);
    
    public String getSizeDisplay() {
        if (size < 1024) return size + " B";
        return String.format("%.1f KB", size / 1024.0);
    }
    
    public String getName() { return name; }
    public long getSize() { return size; }
}</code></pre>
                            </div>

                            <!-- FileLeaf -->
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-4">
                                <h4 class="font-bold text-gray-700 mb-2">FileLeaf.java</h4>
                                <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public abstract class FileLeaf extends SystemEntryComponent {
    public FileLeaf(String name, long sizeBytes) {
        super(name);
        this.size = sizeBytes;
    }
    
    @Override
    public void accept(IVisitor visitor) {
        visitor.visit(this);
    }
}</code></pre>
                            </div>

                            <!-- DirectoryComposite -->
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-4">
                                <h4 class="font-bold text-gray-700 mb-2">DirectoryComposite.java</h4>
                                <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>import java.util.*;

public class DirectoryComposite extends SystemEntryComponent {
    private List&lt;SystemEntryComponent&gt; children = new ArrayList&lt;&gt;();
    
    public DirectoryComposite(String name) {
        super(name);
    }
    
    public void add(SystemEntryComponent child) {
        children.add(child);
    }
    
    public void remove(SystemEntryComponent child) {
        children.remove(child);
    }
    
    public List&lt;SystemEntryComponent&gt; getChildren() {
        return new ArrayList&lt;&gt;(children);
    }
    
    @Override
    public String getType() { return "ç›®éŒ„"; }
    
    @Override
    public void accept(IVisitor visitor) {
        visitor.visit(this);
        // ä½¿ç”¨ instanceof æª¢æŸ¥æ˜¯å¦éœ€è¦æ·±åº¦ç®¡ç†
        if (visitor instanceof DepthManagedVisitor) {
            DepthManagedVisitor depthVisitor = 
                (DepthManagedVisitor) visitor;
            depthVisitor.increaseDepth();
            for (SystemEntryComponent child : children) {
                child.accept(visitor);
            }
            depthVisitor.decreaseDepth();
        } else {
            for (SystemEntryComponent child : children) {
                child.accept(visitor);
            }
        }
    }
}</code></pre>
                            </div>

                            <!-- å…·é«”æ–‡ä»¶é¡å‹ -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-bold text-gray-700 mb-2">WordDocument.java</h4>
                                    <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public class WordDocument 
    extends FileLeaf {
    private int pages;
    
    public WordDocument(String name, 
        long size, int pages) {
        super(name, size);
        this.pages = pages;
    }
    
    @Override
    public String getType() { 
        return "Word æª”æ¡ˆ"; 
    }
    
    public int getPages() { 
        return pages; 
    }
}</code></pre>
                                </div>

                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-bold text-gray-700 mb-2">ImageFile.java</h4>
                                    <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public class ImageFile extends FileLeaf {
    private int width;
    private int height;
    
    public ImageFile(String name, 
        long size, int w, int h) {
        super(name, size);
        this.width = w;
        this.height = h;
    }
    
    @Override
    public String getType() { 
        return "åœ–ç‰‡"; 
    }
    
    public int getWidth() { 
        return width; 
    }
    public int getHeight() { 
        return height; 
    }
}</code></pre>
                                </div>

                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-bold text-gray-700 mb-2">TextFile.java</h4>
                                    <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public class TextFile extends FileLeaf {
    private String encoding;
    
    public TextFile(String name, 
        long size, String enc) {
        super(name, size);
        this.encoding = enc;
    }
    
    @Override
    public String getType() { 
        return "ç´”æ–‡å­—æª”"; 
    }
    
    public String getEncoding() { 
        return encoding; 
    }
}</code></pre>
                                </div>
                            </div>
                        </div>

                        <!-- Visitor æ¥å£èˆ‡å¯¦ç¾ -->
                        <div>
                            <h3 class="text-lg font-semibold text-blue-700 mb-2">ğŸ” Visitor æ¨¡å¼ - æ¥å£éš”é›¢è¨­è¨ˆ</h3>

                            <div class="mb-4 p-4 bg-amber-50 rounded-lg border border-amber-200">
                                <h4 class="font-bold text-amber-700 mb-2">ğŸ’¡ è¨­è¨ˆåŸå‰‡ï¼šInterface Segregation Principle</h4>
                                <p class="text-sm text-gray-700">ä¸åŒè¨ªå•è€…æœ‰ä¸åŒéœ€æ±‚ã€‚ç°¡å–®è¨ªå•è€…ï¼ˆè¨ˆç®—å¤§å°ã€æœå°‹ï¼‰ä¸éœ€æ·±åº¦ç®¡ç†ï¼Œè¤‡é›œè¨ªå•è€…ï¼ˆé¡¯ç¤ºã€XML å°å‡ºï¼‰éœ€è¦ã€‚å› æ­¤åˆ†é›¢ç‚ºå…©å€‹æ¥å£ï¼š</p>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-bold text-gray-700 mb-2">IVisitor.java</h4>
                                    <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public interface IVisitor {
    void visit(FileLeaf leaf);
    void visit(DirectoryComposite composite);
}</code></pre>
                                </div>

                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-bold text-gray-700 mb-2">DepthManagedVisitor.java</h4>
                                    <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public interface DepthManagedVisitor 
    extends IVisitor {
    void increaseDepth();
    void decreaseDepth();
}</code></pre>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-bold text-gray-700 mb-2">SizeCalculatorVisitor.java</h4>
                                    <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public class SizeCalculatorVisitor 
    implements IVisitor {
    private long totalSize = 0;
    
    @Override
    public void visit(FileLeaf leaf) {
        totalSize += leaf.getSize();
    }
    
    @Override
    public void visit(
        DirectoryComposite comp) {
        // éè¿´ç”± DirectoryComposite
        // çš„ accept æ–¹æ³•è™•ç†
    }
    
    public long getTotalSize() { 
        return totalSize; 
    }
}</code></pre>
                                </div>

                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-bold text-gray-700 mb-2">FileSearchVisitor.java</h4>
                                    <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>import java.util.*;

public class FileSearchVisitor 
    implements IVisitor {
    private String extension;
    private List&lt;FileLeaf&gt; results 
        = new ArrayList&lt;&gt;();
    
    public FileSearchVisitor(String ext) {
        this.extension = ext.toLowerCase();
    }
    
    @Override
    public void visit(FileLeaf leaf) {
        if (leaf.getName()
            .toLowerCase()
            .endsWith(extension)) {
            results.add(leaf);
        }
    }
    
    @Override
    public void visit(
        DirectoryComposite comp) {}
    
    public List&lt;FileLeaf&gt; 
        getResults() { 
        return results; 
    }
}</code></pre>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-bold text-gray-700 mb-2">DisplayVisitor.java</h4>
                                    <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public class DisplayVisitor 
    implements DepthManagedVisitor {
    private StringBuilder output = 
        new StringBuilder();
    private int depth = 0;
    private boolean isRoot = true;
    
    @Override
    public void visit(FileLeaf leaf) {
        String indent = "  ".repeat(depth);
        output.append(indent).append("ğŸ“„ ")
              .append(leaf.getName())
              .append("\\n");
    }
    
    @Override
    public void visit(
        DirectoryComposite comp) {
        if (!isRoot) {
            String indent = 
                "  ".repeat(depth);
            output.append(indent)
                  .append("ğŸ“ ")
                  .append(comp.getName())
                  .append("\\n");
        }
        isRoot = false;
    }
    
    @Override
    public void increaseDepth() { 
        depth++; 
    }
    
    @Override
    public void decreaseDepth() { 
        if (depth > 0) depth--; 
    }
    
    public String getOutput() { 
        return output.toString(); 
    }
}</code></pre>
                                </div>

                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-bold text-gray-700 mb-2">XMLExportVisitor.java</h4>
                                    <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>import java.util.*;

public class XMLExportVisitor 
    implements DepthManagedVisitor {
    private StringBuilder xmlOutput = 
        new StringBuilder();
    private int depth = 0;
    private Stack&lt;String&gt; 
        pendingCloseTags = new Stack&lt;&gt;();
    
    @Override
    public void visit(FileLeaf leaf) {
        String indent = "  ".repeat(depth);
        xmlOutput.append(indent)
                 .append("&lt;").append(leaf
                 .getName()).append("&gt;")
                 .append("&lt;/").append(leaf
                 .getName()).append("&gt;\\n");
    }
    
    @Override
    public void visit(
        DirectoryComposite comp) {
        String indent = "  ".repeat(depth);
        xmlOutput.append(indent)
                 .append("&lt;").append(comp
                 .getName()).append("&gt;\\n");
        pendingCloseTags.push(comp
            .getName());
    }
    
    @Override
    public void increaseDepth() { 
        depth++; 
    }
    
    @Override
    public void decreaseDepth() {
        if (depth > 0) {
            depth--;
            if (!pendingCloseTags
                .isEmpty()) {
                String tagName = 
                    pendingCloseTags.pop();
                String indent = 
                    "  ".repeat(depth);
                xmlOutput.append(indent)
                    .append("&lt;/")
                    .append(tagName)
                    .append("&gt;\\n");
            }
        }
    }
    
    public String getXMLOutput() { 
        return xmlOutput.toString(); 
    }
}</code></pre>
                                </div>
                            </div>
                        </div>

                        <!-- Main Demo -->
                        <div>
                            <h3 class="text-lg font-semibold text-blue-700 mb-2">â–¶ï¸ ä½¿ç”¨ç¯„ä¾‹</h3>
                            
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                <h4 class="font-bold text-gray-700 mb-2">FileSystemDemo.java</h4>
                                <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public class FileSystemDemo {
    public static void main(String[] args) {
        // å»ºç«‹æ ¹ç›®éŒ„
        DirectoryComposite root = 
            new DirectoryComposite("æ ¹ç›®éŒ„");
        
        // å»ºç«‹å­ç›®éŒ„
        DirectoryComposite project = 
            new DirectoryComposite("å°ˆæ¡ˆæ–‡ä»¶");
        project.add(new WordDocument(
            "éœ€æ±‚è¦æ ¼æ›¸.docx", 500*1024, 15));
        project.add(new ImageFile(
            "æ¶æ§‹åœ–.png", 2*1024*1024, 1920, 1080));
        
        DirectoryComposite personal = 
            new DirectoryComposite("å€‹äººç­†è¨˜");
        personal.add(new TextFile(
            "å¾…è¾¦æ¸…å–®.txt", 1024, "UTF-8"));
        
        // çµ„åˆ
        root.add(project);
        root.add(personal);
        root.add(new TextFile(
            "README.txt", 500, "ASCII"));
        
        // æ¸¬è©¦ Visitor
        System.out.println("=== è¨ˆç®—ç¸½å¤§å° ===");
        SizeCalculatorVisitor sizeVisitor = 
            new SizeCalculatorVisitor();
        root.accept(sizeVisitor);
        System.out.println("ç¸½å¤§å°: " + 
            sizeVisitor.getTotalSize() + " Bytes");
        
        System.out.println("\n=== æœå°‹ .docx æª”æ¡ˆ ===");
        FileSearchVisitor searchVisitor = 
            new FileSearchVisitor(".docx");
        root.accept(searchVisitor);
        for (FileLeaf file : 
            searchVisitor.getResults()) {
            System.out.println("æ‰¾åˆ°: " + 
                file.getName());
        }
    }
}</code></pre>
                            </div>
                        </div>
                    </div>

                    <!-- ç·¨è­¯å’Œé‹è¡Œèªªæ˜ -->
                    <div class="mt-6 p-4 bg-purple-50 rounded-lg border border-purple-200">
                        <h3 class="font-bold text-purple-700 mb-3">ğŸš€ ç·¨è­¯èˆ‡é‹è¡Œ</h3>
                        <pre class="text-xs bg-white p-2 rounded border border-purple-100 overflow-x-auto"><code>// ç·¨è­¯æ‰€æœ‰ Java æª”æ¡ˆ
javac src/*.java

// é‹è¡Œç¨‹å¼
java -cp src FileSystemDemo

// é æœŸè¼¸å‡º
=== è¨ˆç®—ç¸½å¤§å° ===
ç¸½å¤§å°: 2503524 Bytes

=== æœå°‹ .docx æª”æ¡ˆ ===
æ‰¾åˆ°: éœ€æ±‚è¦æ ¼æ›¸.docx</code></pre>
                    </div>

                    <!-- å­¸ç¿’é‡é» -->
                    <div class="mt-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                        <h3 class="font-bold text-yellow-700 mb-3">ğŸ’¡ Visitor Pattern å­¸ç¿’é‡é»</h3>
                        <ul class="text-sm text-gray-700 list-disc list-inside space-y-2">
                            <li><strong>é›™é‡åˆ†æ´¾</strong>ï¼švisitor.visit(this) æ ¹æ“š this çš„å…·é«”é¡å‹æ±ºå®šèª¿ç”¨çš„æ–¹æ³•</li>
                            <li><strong>é–‹æ”¾å°é–‰åŸå‰‡</strong>ï¼šæ–°å¢æ“ä½œä¸éœ€ä¿®æ”¹ç¾æœ‰é¡åˆ¥ï¼Œåªéœ€æ–°å¢ Visitor</li>
                            <li><strong>åˆ†é›¢é—œæ³¨é»</strong>ï¼šè³‡æ–™çµæ§‹èˆ‡ç®—æ³•é‚è¼¯å®Œå…¨åˆ†é›¢ï¼Œå„å¸å…¶è·</li>
                            <li><strong>æ˜“æ–¼æ“´å±•</strong>ï¼šè¦æ–°å¢æª”æ¡ˆçµ±è¨ˆã€å‚™ä»½ã€é©—è­‰ç­‰åŠŸèƒ½ï¼Œåªéœ€æ–°å¢ç›¸æ‡‰çš„ Visitor</li>
                        </ul>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ– Mermaid
        mermaid.initialize({ startOnLoad: false, theme: 'neutral', securityLevel: 'loose' });

        // ========== Visitor Pattern è¨­è¨ˆ ==========
        // åŸºç¤å…ƒä»¶æŠ½è±¡é¡
        class SystemEntryComponent {
            constructor(name) {
                this.id = crypto.randomUUID();
                this.name = name;
                this.created = new Date();
                this.size = 0;
                this.attributes = "";
            }
            get type() { throw new Error("Method not implemented."); }
            accept(visitor) { throw new Error("Method not implemented."); }
            getSizeDisplay() {
                if (this.size < 1024) return `${this.size} B`;
                return `${(this.size / 1024).toFixed(1)} KB`;
            }
        }

        // æ–‡ä»¶è‘‰å­ç¯€é»æŠ½è±¡é¡
        class FileLeaf extends SystemEntryComponent {
            constructor(name, size_bytes) {
                super(name);
                this.size = size_bytes;
            }
            accept(visitor) {
                visitor.visit(this);
            }
        }

        // å…·é«”æ–‡ä»¶é¡å‹
        class WordDocumentLeaf extends FileLeaf {
            constructor(name, size_bytes, pages) {
                super(name, size_bytes);
                this.pages = pages;
            }
            get type() { return "Word æª”æ¡ˆ"; }
        }

        class ImageFileLeaf extends FileLeaf {
            constructor(name, size_bytes, width, height) {
                super(name, size_bytes);
                this.width = width;
                this.height = height;
            }
            get type() { return "åœ–ç‰‡"; }
        }

        class TextFileLeaf extends FileLeaf {
            constructor(name, size_bytes, encoding) {
                super(name, size_bytes);
                this.encoding = encoding;
            }
            get type() { return "ç´”æ–‡å­—æª”"; }
        }

        // ç›®éŒ„è¤‡åˆç¯€é»
        class DirectoryComposite extends SystemEntryComponent {
            constructor(name) {
                super(name);
                this.children = [];
            }
            get type() { return "ç›®éŒ„"; }
            
            add(child) { this.children.push(child); }
            remove(childId) { this.children = this.children.filter(c => c.id !== childId); }
            getChildren() { return this.children; }

            accept(visitor) {
                visitor.visit(this);
                // æª¢æŸ¥æ˜¯å¦å¯¦ç¾ DepthManagedVisitor
                if (visitor instanceof DisplayVisitor || visitor instanceof XMLExportVisitor) {
                    visitor.increaseDepth();
                    this.children.forEach(child => child.accept(visitor));
                    visitor.decreaseDepth();
                } else {
                    this.children.forEach(child => child.accept(visitor));
                }
            }
        }

        // ========== è¨ªå•è€…æ¥å£èˆ‡å¯¦ç¾ ==========
        class IVisitor {
            visit(element) { throw new Error("Method not implemented."); }
        }

        // DepthManagedVisitor æ¥å£
        class DepthManagedVisitor extends IVisitor {
            increaseDepth() { throw new Error("Method not implemented."); }
            decreaseDepth() { throw new Error("Method not implemented."); }
        }

        // è¨ˆç®—ç¸½å¤§å°è¨ªå•è€…ï¼ˆåªå¯¦ç¾ IVisitorï¼‰
        class SizeCalculatorVisitor extends IVisitor {
            constructor() {
                super();
                this.totalSize = 0;
            }
            visit(element) {
                if (element instanceof FileLeaf) {
                    this.totalSize += element.size;
                }
            }
            getTotalSize() { return this.totalSize; }
        }

        // æ–‡ä»¶æœå°‹è¨ªå•è€…
        class FileSearchVisitor extends IVisitor {
            constructor(extension) {
                super();
                this.extension = extension.toLowerCase();
                this.results = [];
            }
            visit(element) {
                if (element instanceof FileLeaf && element.name.toLowerCase().endsWith(this.extension)) {
                    this.results.push(element);
                }
            }
            getResults() { return this.results; }
        }

        // æ–‡æœ¬é¡¯ç¤ºè¨ªå•è€…ï¼ˆç”¨æ–¼çµ‚ç«¯è¼¸å‡ºï¼‰
        class DisplayVisitor extends IVisitor {
            constructor() {
                super();
                this.output = "";
                this.depth = 0;
                this.isRoot = true;
            }
            visit(element) {
                const indent = "  ".repeat(this.depth);
                if (element instanceof DirectoryComposite) {
                    if (!this.isRoot) {
                        this.output += `${indent}ğŸ“ ${element.name}\n`;
                    }
                    this.isRoot = false;
                } else if (element instanceof WordDocumentLeaf) {
                    this.output += `${indent}ğŸ“„ ${element.name} (Word, ${element.pages}p, ${element.getSizeDisplay()})\n`;
                } else if (element instanceof ImageFileLeaf) {
                    this.output += `${indent}ğŸ–¼ï¸ ${element.name} (Img, ${element.width}x${element.height}, ${element.getSizeDisplay()})\n`;
                } else if (element instanceof TextFileLeaf) {
                    this.output += `${indent}ğŸ“„ ${element.name} (Txt, ${element.encoding}, ${element.getSizeDisplay()})\n`;
                }
            }
            increaseDepth() { this.depth++; }
            decreaseDepth() { if (this.depth > 0) this.depth--; }
            getOutput() { return this.output; }
        }

        // XML åŒ¯å‡ºè¨ªå•è€…
        class XMLExportVisitor extends IVisitor {
            constructor() {
                super();
                this.xmlOutput = "";
                this.depth = 0;
                this.isRoot = true;
                this.pendingCloseTags = [];  // ç”¨æ–¼è¿½è¹¤å¾…é—œé–‰çš„æ¨™ç±¤
            }
            visit(element) {
                const indent = "  ".repeat(this.depth);
                if (element instanceof DirectoryComposite) {
                    if (!this.isRoot) {
                        this.xmlOutput += `${indent}<${element.name} type="ç›®éŒ„">\n`;
                        this.pendingCloseTags.push({ name: element.name, depth: this.depth });
                    }
                    this.isRoot = false;
                } else if (element instanceof FileLeaf) {
                    this.xmlOutput += `${indent}<${element.name} type="${element.type}"></${element.name}>\n`;
                }
            }
            increaseDepth() { this.depth++; }
            decreaseDepth() { 
                if (this.depth > 0) {
                    this.depth--;
                    // åœ¨è¿”å›ä¸Šä¸€å±¤æ™‚ï¼Œè¼¸å‡ºå°æ‡‰çš„é–‰åˆæ¨™ç±¤
                    if (this.pendingCloseTags.length > 0 && this.pendingCloseTags[this.pendingCloseTags.length - 1].depth === this.depth) {
                        const tag = this.pendingCloseTags.pop();
                        const indent = "  ".repeat(this.depth);
                        this.xmlOutput += `${indent}</${tag.name}>\n`;
                    }
                }
            }
            getXMLOutput() { return this.xmlOutput; }
        }

        // ========== å…¨åŸŸç‹€æ…‹èˆ‡åŠŸèƒ½å¯¦ä½œ ==========
        let systemRoot = new DirectoryComposite("æ ¹ç›®éŒ„(Root)");
        let folderMap = new Map();

        function showTotalSize() {
            const visitor = new SizeCalculatorVisitor();
            systemRoot.accept(visitor);
            const total = visitor.getTotalSize();
            const formatted = total >= 1048576 ? (total/1048576).toFixed(2) + " MB" : (total/1024).toFixed(1) + " KB";
            document.getElementById('terminal-title').innerText = "é€²éšåˆ†æï¼šè¨ˆç®—ç¸½å¤§å°";
            document.getElementById('terminal-output').innerText = `ç³»çµ±å…§æ‰€æœ‰æª”æ¡ˆä¹‹ç¸½å¤§å°ç‚ºï¼š\n------------------------\n${total} Bytes\nç´„ç­‰åŒæ–¼ ${formatted}`;
        }

        function findDocxFiles() {
            const visitor = new FileSearchVisitor(".docx");
            systemRoot.accept(visitor);
            const files = visitor.getResults();
            document.getElementById('terminal-title').innerText = "é€²éšåˆ†æï¼šæœå°‹ .docx æª”æ¡ˆ";
            if (files.length === 0) {
                document.getElementById('terminal-output').innerText = "ç³»çµ±å…§ç›®å‰æ²’æœ‰å‰¯æª”åç‚º .docx çš„æª”æ¡ˆã€‚";
            } else {
                let res = `å…±å°‹ç² ${files.length} å€‹ç¬¦åˆæ¢ä»¶çš„æª”æ¡ˆï¼š\n------------------------\n`;
                files.forEach(f => res += `- ${f.name} (${f.getSizeDisplay()})\n`);
                document.getElementById('terminal-output').innerText = res;
            }
        }

        function exportToXML() {
            const visitor = new XMLExportVisitor();
            systemRoot.accept(visitor);
            // è£œä¸Šæ ¹ç›®éŒ„çš„closing tag
            const output = visitor.getXMLOutput();
            document.getElementById('terminal-title').innerText = "é€²éšåˆ†æï¼šXML æ ¼å¼åŒ¯å‡º";
            document.getElementById('terminal-output').innerText = output;
        }

        // ========== UI æ§åˆ¶ ==========
        function openTab(evt, tabName) {
            document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
            document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
            const activeTab = document.getElementById(tabName);
            activeTab.classList.add("active");
            evt.currentTarget.classList.add("active");

            if (tabName === 'domain' || tabName === 'er') {
                const diagrams = activeTab.querySelectorAll('.mermaid');
                diagrams.forEach(d => {
                    const code = d.getAttribute('data-original-code');
                    if (code) { d.innerHTML = code; d.removeAttribute('data-processed'); }
                });
                setTimeout(() => mermaid.run({ nodes: diagrams }), 50);
            }
        }

        function toggleFields() {
            const type = document.getElementById('type-select').value;
            const extra = document.getElementById('extra-fields');
            document.querySelectorAll("#extra-fields > div").forEach(d => d.classList.add('hidden'));

            if (type === 'FOLDER') { extra.classList.add('hidden'); } 
            else {
                extra.classList.remove('hidden');
                document.getElementById('node-size').parentElement.classList.remove('hidden');
                if (type === 'WORD') document.getElementById('field-pages').classList.remove('hidden');
                if (type === 'IMAGE') { document.getElementById('field-width').classList.remove('hidden'); document.getElementById('field-height').classList.remove('hidden'); }
                if (type === 'TEXT') document.getElementById('field-encoding').classList.remove('hidden');
            }
        }

        function handleAddNode() {
            const pId = document.getElementById('parent-select').value;
            const type = document.getElementById('type-select').value;
            const name = document.getElementById('node-name').value || "æœªå‘½å";
            const parent = folderMap.get(pId);
            if (!parent) return;

            let node;
            const size = parseInt(document.getElementById('node-size').value);
            if (type === 'FOLDER') {
                node = new DirectoryComposite(name);
            } else if (type === 'WORD') {
                node = new WordDocumentLeaf(name, size, parseInt(document.getElementById('node-pages').value));
            } else if (type === 'IMAGE') {
                node = new ImageFileLeaf(name, size, parseInt(document.getElementById('node-width').value), parseInt(document.getElementById('node-height').value));
            } else if (type === 'TEXT') {
                node = new TextFileLeaf(name, size, document.getElementById('node-encoding').value);
            }

            parent.add(node);
            refreshUI();
            document.getElementById('node-name').value = "";
        }

        function handleDeleteNode(id) {
            if (id === systemRoot.id) return;
            function search(curr) {
                const startLen = curr.getChildren().length;
                curr.remove(id);
                if (curr.getChildren().length < startLen) return true;
                for (let c of curr.getChildren()) {
                    if (c instanceof DirectoryComposite && search(c)) return true;
                }
                return false;
            }
            search(systemRoot);
            refreshUI();
        }

        function refreshUI() {
            const displayVisitor = new DisplayVisitor();
            systemRoot.accept(displayVisitor);
            document.getElementById('terminal-title').innerText = "çµ‚ç«¯æ©Ÿè¼¸å‡º (çµæ§‹æª¢è¦–)";
            document.getElementById('terminal-output').innerText = displayVisitor.getOutput();
            const tree = document.getElementById('tree-visual');
            tree.innerHTML = "";
            renderVisual(systemRoot, tree);
            updateSelect();
        }

        function renderVisual(node, container) {
            const row = document.createElement('div');
            row.className = "tree-item-row flex items-center group py-1";
            const content = document.createElement('div');
            content.className = "flex-grow flex items-center";
            let html = "";
            
            if (node instanceof DirectoryComposite) {
                html = `<span class="folder-icon font-bold mr-1">ğŸ“ ${node.name}</span>`;
            } else if (node instanceof WordDocumentLeaf) {
                html = `<span class="file-icon mr-1">ğŸ“„ ${node.name}</span> <span class="text-xs text-gray-400">(Word, ${node.pages}p, ${node.getSizeDisplay()})</span>`;
            } else if (node instanceof ImageFileLeaf) {
                html = `<span class="file-icon mr-1">ğŸ–¼ï¸ ${node.name}</span> <span class="text-xs text-gray-400">(Img, ${node.width}x${node.height}, ${node.getSizeDisplay()})</span>`;
            } else if (node instanceof TextFileLeaf) {
                html = `<span class="file-icon mr-1">ğŸ“„ ${node.name}</span> <span class="text-xs text-gray-400">(Txt, ${node.encoding}, ${node.getSizeDisplay()})</span>`;
            }
            
            content.innerHTML = html;
            row.appendChild(content);
            if (node.id !== systemRoot.id) {
                const btn = document.createElement('button');
                btn.className = "delete-btn text-red-500 text-xs ml-2 font-bold px-1";
                btn.innerHTML = "ğŸ—‘ï¸";
                btn.onclick = (e) => { e.stopPropagation(); handleDeleteNode(node.id); };
                row.appendChild(btn);
            }
            const wrap = document.createElement('div');
            wrap.className = "tree-node";
            wrap.appendChild(row);
            container.appendChild(wrap);
            if (node instanceof DirectoryComposite) {
                node.getChildren().forEach(c => renderVisual(c, wrap));
            }
        }

        function updateSelect() {
            const select = document.getElementById('parent-select');
            const curr = select.value;
            select.innerHTML = "";
            folderMap.clear();
            function walk(n, path = "") {
                if (n instanceof DirectoryComposite) {
                    const p = path + "/" + n.name;
                    folderMap.set(n.id, n);
                    const o = document.createElement('option');
                    o.value = n.id; o.innerText = p;
                    select.appendChild(o);
                    n.getChildren().forEach(c => walk(c, p));
                }
            }
            walk(systemRoot);
            if (folderMap.has(curr)) select.value = curr;
        }

        window.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.mermaid').forEach(d => d.setAttribute('data-original-code', d.innerText.trim()));
            
            // åˆå§‹åŒ–çµæ§‹
            const project = new DirectoryComposite("å°ˆæ¡ˆæ–‡ä»¶ (Project_Docs)");
            project.add(new WordDocumentLeaf("éœ€æ±‚è¦æ ¼æ›¸.docx", 500 * 1024, 15));
            project.add(new ImageFileLeaf("ç³»çµ±æ¶æ§‹åœ–.png", 2 * 1024 * 1024, 1920, 1080));

            const personal = new DirectoryComposite("å€‹äººç­†è¨˜ (Personal_Notes)");
            personal.add(new TextFileLeaf("å¾…è¾¦æ¸…å–®.txt", 1 * 1024, "UTF-8"));
            
            const archive = new DirectoryComposite("2025å‚™ä»½ (Archive_2025)");
            archive.add(new WordDocumentLeaf("èˆŠæœƒè­°è¨˜éŒ„.docx", 200 * 1024, 5));
            personal.add(archive);
            
            systemRoot.add(project);
            systemRoot.add(personal);
            systemRoot.add(new TextFileLeaf("README.txt", 500, "ASCII"));

            refreshUI();
            toggleFields();
        });

        // ========== Java é …ç›®ä¸‹è¼‰åŠŸèƒ½ ==========
        async function downloadJavaProject() {
            // å¼•å…¥ JSZip åº«
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
            script.onload = function() {
                createAndDownloadZip();
            };
            document.head.appendChild(script);
        }

        function createAndDownloadZip() {
            const JSZip = window.JSZip;
            const zip = new JSZip();
            
            // å»ºç«‹è³‡æ–™å¤¾çµæ§‹
            const src = zip.folder('FileSystemDemo').folder('src');
            
            // æ·»åŠ æ‰€æœ‰ Java æºæ–‡ä»¶
            const files = {
                'SystemEntryComponent.java': `public abstract class SystemEntryComponent {
    protected String name;
    protected java.time.LocalDateTime created;
    protected long size;
    protected String attributes;
    
    public SystemEntryComponent(String name) {
        this.name = name;
        this.created = java.time.LocalDateTime.now();
        this.size = 0;
    }
    
    public abstract String getType();
    public abstract void accept(IVisitor visitor);
    
    public String getSizeDisplay() {
        if (size < 1024) return size + " B";
        return String.format("%.1f KB", size / 1024.0);
    }
    
    public String getName() { return name; }
    public long getSize() { return size; }
}`,
                'FileLeaf.java': `public abstract class FileLeaf extends SystemEntryComponent {
    public FileLeaf(String name, long sizeBytes) {
        super(name);
        this.size = sizeBytes;
    }
    
    @Override
    public void accept(IVisitor visitor) {
        visitor.visit(this);
    }
}`,
                'DirectoryComposite.java': `import java.util.*;

public class DirectoryComposite extends SystemEntryComponent {
    private List<SystemEntryComponent> children = new ArrayList<>();
    
    public DirectoryComposite(String name) {
        super(name);
    }
    
    public void add(SystemEntryComponent child) {
        children.add(child);
    }
    
    public void remove(SystemEntryComponent child) {
        children.remove(child);
    }
    
    public List<SystemEntryComponent> getChildren() {
        return new ArrayList<>(children);
    }
    
    @Override
    public String getType() { return "ç›®éŒ„"; }
    
    @Override
    public void accept(IVisitor visitor) {
        visitor.visit(this);
        // åªæœ‰å¯¦ç¾ DepthManagedVisitor çš„è¨ªå•è€…éœ€è¦æ·±åº¦ç®¡ç†
        if (visitor instanceof DepthManagedVisitor) {
            DepthManagedVisitor depthVisitor = (DepthManagedVisitor) visitor;
            depthVisitor.increaseDepth();
            for (SystemEntryComponent child : children) {
                child.accept(visitor);
            }
            depthVisitor.decreaseDepth();
        } else {
            // ç°¡å–®è¨ªå•è€…ä¸éœ€è¦æ·±åº¦ç®¡ç†ï¼Œåªéè¿´è¨ªå•å­ç¯€é»
            for (SystemEntryComponent child : children) {
                child.accept(visitor);
            }
        }
    }
}`,
                'WordDocument.java': `public class WordDocument extends FileLeaf {
    private int pages;
    
    public WordDocument(String name, long size, int pages) {
        super(name, size);
        this.pages = pages;
    }
    
    @Override
    public String getType() { return "Word æª”æ¡ˆ"; }
    
    public int getPages() { return pages; }
}`,
                'ImageFile.java': `public class ImageFile extends FileLeaf {
    private int width;
    private int height;
    
    public ImageFile(String name, long size, int width, int height) {
        super(name, size);
        this.width = width;
        this.height = height;
    }
    
    @Override
    public String getType() { return "åœ–ç‰‡"; }
    
    public int getWidth() { return width; }
    public int getHeight() { return height; }
}`,
                'TextFile.java': `public class TextFile extends FileLeaf {
    private String encoding;
    
    public TextFile(String name, long size, String encoding) {
        super(name, size);
        this.encoding = encoding;
    }
    
    @Override
    public String getType() { return "ç´”æ–‡å­—æª”"; }
    
    public String getEncoding() { return encoding; }
}`,
                'IVisitor.java': `public interface IVisitor {
    void visit(FileLeaf leaf);
    void visit(DirectoryComposite composite);
}`,
                'DepthManagedVisitor.java': `public interface DepthManagedVisitor extends IVisitor {
    void increaseDepth();
    void decreaseDepth();
}`,
                'SizeCalculatorVisitor.java': `public class SizeCalculatorVisitor implements IVisitor {
    private long totalSize = 0;
    
    @Override
    public void visit(FileLeaf leaf) {
        totalSize += leaf.getSize();
    }
    
    @Override
    public void visit(DirectoryComposite composite) {
        // éè¿´ç”± DirectoryComposite.accept æ–¹æ³•è™•ç†
    }
    
    public long getTotalSize() { return totalSize; }
}`,
                'FileSearchVisitor.java': `import java.util.*;

public class FileSearchVisitor implements IVisitor {
    private String extension;
    private List<FileLeaf> results = new ArrayList<>();
    
    public FileSearchVisitor(String extension) {
        this.extension = extension.toLowerCase();
    }
    
    @Override
    public void visit(FileLeaf leaf) {
        if (leaf.getName().toLowerCase().endsWith(extension)) {
            results.add(leaf);
        }
    }
    
    @Override
    public void visit(DirectoryComposite composite) {
        // éè¿´ç”± DirectoryComposite.accept æ–¹æ³•è™•ç†
    }
    
    public List<FileLeaf> getResults() { return results; }
}`,
                'XMLExportVisitor.java': `import java.util.*;

public class XMLExportVisitor implements DepthManagedVisitor {
    private StringBuilder xmlOutput = new StringBuilder();
    private int depth = 0;
    private boolean isRoot = true;
    private Stack<String> pendingCloseTags = new Stack<>();
    
    @Override
    public void visit(FileLeaf leaf) {
        String indent = "  ".repeat(depth);
        xmlOutput.append(indent).append("<").append(leaf.getName())
                .append(" type=\\"").append(leaf.getType()).append("\\">")
                .append("</").append(leaf.getName()).append(">\\n");
    }
    
    @Override
    public void visit(DirectoryComposite composite) {
        if (!isRoot) {
            String indent = "  ".repeat(depth);
            xmlOutput.append(indent).append("<").append(composite.getName())
                    .append(" type=\\"ç›®éŒ„\\">\\n");
            pendingCloseTags.push(composite.getName());
        }
        isRoot = false;
    }
    
    @Override
    public void increaseDepth() { depth++; }
    
    @Override
    public void decreaseDepth() {
        if (depth > 0) {
            depth--;
            if (!pendingCloseTags.isEmpty()) {
                String tagName = pendingCloseTags.pop();
                String indent = "  ".repeat(depth);
                xmlOutput.append(indent).append("</").append(tagName).append(">\\n");
            }
        }
    }
    
    public String getXMLOutput() { return xmlOutput.toString(); }
}`,
                'DisplayVisitor.java': `public class DisplayVisitor implements DepthManagedVisitor {
    private StringBuilder output = new StringBuilder();
    private int depth = 0;
    private boolean isRoot = true;
    
    @Override
    public void visit(FileLeaf leaf) {
        String indent = "  ".repeat(depth);
        output.append(indent).append("ğŸ“„ ").append(leaf.getName());
        if (leaf instanceof WordDocument) {
            WordDocument doc = (WordDocument) leaf;
            output.append(" (Word, ").append(doc.getPages()).append("p, ")
                   .append(doc.getSizeDisplay()).append(")");
        } else if (leaf instanceof ImageFile) {
            ImageFile img = (ImageFile) leaf;
            output.append(" (Img, ").append(img.getWidth()).append("x")
                   .append(img.getHeight()).append(", ")
                   .append(img.getSizeDisplay()).append(")");
        } else if (leaf instanceof TextFile) {
            TextFile txt = (TextFile) leaf;
            output.append(" (Txt, ").append(txt.getEncoding()).append(", ")
                   .append(txt.getSizeDisplay()).append(")");
        }
        output.append("\\n");
    }
    
    @Override
    public void visit(DirectoryComposite composite) {
        if (!isRoot) {
            String indent = "  ".repeat(depth);
            output.append(indent).append("ğŸ“ ").append(composite.getName()).append("\\n");
        }
        isRoot = false;
    }
    
    @Override
    public void increaseDepth() { depth++; }
    
    @Override
    public void decreaseDepth() { if (depth > 0) depth--; }
    
    public String getOutput() { return output.toString(); }
}`,
                'FileSystemDemo.java': `public class FileSystemDemo {
    public static void main(String[] args) {
        // å»ºç«‹æ ¹ç›®éŒ„
        DirectoryComposite root = new DirectoryComposite("æ ¹ç›®éŒ„(Root)");
        
        // å»ºç«‹å°ˆæ¡ˆæ–‡ä»¶ç›®éŒ„
        DirectoryComposite project = new DirectoryComposite("å°ˆæ¡ˆæ–‡ä»¶ (Project_Docs)");
        project.add(new WordDocument("éœ€æ±‚è¦æ ¼æ›¸.docx", 500 * 1024, 15));
        project.add(new ImageFile("ç³»çµ±æ¶æ§‹åœ–.png", 2 * 1024 * 1024, 1920, 1080));
        
        // å»ºç«‹å€‹äººç­†è¨˜ç›®éŒ„
        DirectoryComposite personal = new DirectoryComposite("å€‹äººç­†è¨˜ (Personal_Notes)");
        personal.add(new TextFile("å¾…è¾¦æ¸…å–®.txt", 1 * 1024, "UTF-8"));
        
        // å»ºç«‹å‚™ä»½ç›®éŒ„
        DirectoryComposite archive = new DirectoryComposite("2025å‚™ä»½ (Archive_2025)");
        archive.add(new WordDocument("èˆŠæœƒè­°è¨˜éŒ„.docx", 200 * 1024, 5));
        personal.add(archive);
        
        // çµ„åˆçµæ§‹
        root.add(project);
        root.add(personal);
        root.add(new TextFile("README.txt", 500, "ASCII"));
        
        // æ¸¬è©¦ 1: è¨ˆç®—ç¸½å¤§å°
        System.out.println("=== è¨ˆç®—ç¸½å¤§å° ===");
        SizeCalculatorVisitor sizeVisitor = new SizeCalculatorVisitor();
        root.accept(sizeVisitor);
        long total = sizeVisitor.getTotalSize();
        String formatted = total >= 1048576 ? 
            String.format("%.2f MB", total / 1048576.0) : 
            String.format("%.1f KB", total / 1024.0);
        System.out.println("ç¸½å¤§å°: " + total + " Bytes (" + formatted + ")\\n");
        
        // æ¸¬è©¦ 2: æœå°‹ .docx æª”æ¡ˆ
        System.out.println("=== æœå°‹ .docx æª”æ¡ˆ ===");
        FileSearchVisitor searchVisitor = new FileSearchVisitor(".docx");
        root.accept(searchVisitor);
        java.util.List<FileLeaf> results = searchVisitor.getResults();
        System.out.println("å…±æ‰¾åˆ° " + results.size() + " å€‹æª”æ¡ˆ:");
        for (FileLeaf file : results) {
            System.out.println("  - " + file.getName() + " (" + file.getSizeDisplay() + ")");
        }
        System.out.println();
        
        // æ¸¬è©¦ 3: é¡¯ç¤ºçµæ§‹
        System.out.println("=== æª”æ¡ˆçµæ§‹ ===");
        DisplayVisitor displayVisitor = new DisplayVisitor();
        root.accept(displayVisitor);
        System.out.println(displayVisitor.getOutput());
        
        // æ¸¬è©¦ 4: XML åŒ¯å‡º
        System.out.println("=== XML æ ¼å¼åŒ¯å‡º ===");
        XMLExportVisitor xmlVisitor = new XMLExportVisitor();
        root.accept(xmlVisitor);
        System.out.println(xmlVisitor.getXMLOutput());
    }
}`
            };
            
            // æ·»åŠ æ‰€æœ‰ Java æ–‡ä»¶
            Object.entries(files).forEach(([filename, content]) => {
                src.file(filename, content);
            });
            
            // æ·»åŠ  README
            zip.file('FileSystemDemo/README.md', `# é›²ç«¯æª”æ¡ˆç®¡ç†ç³»çµ± - Java å¯¦ä½œ

## é …ç›®æ¦‚è¿°
ä½¿ç”¨ Visitor Patternï¼ˆè¨ªå•è€…æ¨¡å¼ï¼‰å¯¦ä½œçš„æª”æ¡ˆç³»çµ±ç®¡ç†ç³»çµ±ï¼Œå±•ç¤ºè¨­è¨ˆæ¨¡å¼åœ¨å¯¦éš›æ‡‰ç”¨ä¸­çš„å¨åŠ›ã€‚

## é …ç›®çµæ§‹
\`\`\`
FileSystemDemo/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ SystemEntryComponent.java        // åŸºç¤å…ƒä»¶æŠ½è±¡é¡
â”‚   â”œâ”€â”€ FileLeaf.java                    // æ–‡ä»¶è‘‰å­ç¯€é»æŠ½è±¡é¡
â”‚   â”œâ”€â”€ DirectoryComposite.java          // ç›®éŒ„è¤‡åˆç¯€é»
â”‚   â”œâ”€â”€ WordDocument.java                // Word æ–‡ä»¶
â”‚   â”œâ”€â”€ ImageFile.java                   // åœ–ç‰‡æ–‡ä»¶
â”‚   â”œâ”€â”€ TextFile.java                    // ç´”æ–‡å­—æ–‡ä»¶
â”‚   â”œâ”€â”€ IVisitor.java                    // è¨ªå•è€…æ¥å£
â”‚   â”œâ”€â”€ SizeCalculatorVisitor.java       // å¤§å°è¨ˆç®—è¨ªå•è€…
â”‚   â”œâ”€â”€ FileSearchVisitor.java           // æ–‡ä»¶æœå°‹è¨ªå•è€…
â”‚   â”œâ”€â”€ XMLExportVisitor.java            // XML åŒ¯å‡ºè¨ªå•è€…
â”‚   â”œâ”€â”€ DisplayVisitor.java              // æ–‡æœ¬é¡¯ç¤ºè¨ªå•è€…
â”‚   â””â”€â”€ FileSystemDemo.java              // ä¸»ç¨‹å¼
â””â”€â”€ README.md                            // æœ¬æ–‡ä»¶
\`\`\`

## ç·¨è­¯æ­¥é©Ÿ

### Windows
\`\`\`cmd
cd FileSystemDemo
javac -encoding UTF-8 src/*.java
java -cp src FileSystemDemo
\`\`\`

### macOS / Linux
\`\`\`bash
cd FileSystemDemo
javac src/*.java
java -cp src FileSystemDemo
\`\`\`

## é‹è¡Œçµæœé æœŸ
\`\`\`
=== è¨ˆç®—ç¸½å¤§å° ===
ç¸½å¤§å°: 2603524 Bytes (2.48 MB)

=== æœå°‹ .docx æª”æ¡ˆ ===
å…±æ‰¾åˆ° 2 å€‹æª”æ¡ˆ:
  - éœ€æ±‚è¦æ ¼æ›¸.docx (500.0 KB)
  - èˆŠæœƒè­°è¨˜éŒ„.docx (200.0 KB)

=== æª”æ¡ˆçµæ§‹ ===
ğŸ“ å°ˆæ¡ˆæ–‡ä»¶ (Project_Docs)
  ğŸ“„ éœ€æ±‚è¦æ ¼æ›¸.docx (Word, 15p, 500.0 KB)
  ğŸ–¼ï¸ ç³»çµ±æ¶æ§‹åœ–.png (Img, 1920x1080, 2.0 MB)
ğŸ“ å€‹äººç­†è¨˜ (Personal_Notes)
  ğŸ“„ å¾…è¾¦æ¸…å–®.txt (Txt, UTF-8, 1.0 KB)
  ğŸ“ 2025å‚™ä»½ (Archive_2025)
    ğŸ“„ èˆŠæœƒè­°è¨˜éŒ„.docx (Word, 5p, 200.0 KB)
ğŸ“„ README.txt (Txt, ASCII, 500 B)

=== XML æ ¼å¼åŒ¯å‡º ===
<å°ˆæ¡ˆæ–‡ä»¶ (Project_Docs) type="ç›®éŒ„">
  <éœ€æ±‚è¦æ ¼æ›¸.docx type="Word æª”æ¡ˆ"></éœ€æ±‚è¦æ ¼æ›¸.docx>
  <ç³»çµ±æ¶æ§‹åœ–.png type="åœ–ç‰‡"></ç³»çµ±æ¶æ§‹åœ–.png>
</å°ˆæ¡ˆæ–‡ä»¶ (Project_Docs)>
...
\`\`\`

## é—œéµæ¦‚å¿µ

### Visitor Patternï¼ˆè¨ªå•è€…æ¨¡å¼ï¼‰
- **ç›®çš„**ï¼šå°‡ç®—æ³•èˆ‡å…¶æ‰€ä½œç”¨çš„å°è±¡åˆ†é›¢
- **å„ªå‹¢**ï¼š
  - âœ… é–‹æ”¾å°é–‰åŸå‰‡ï¼šæ–°å¢æ“ä½œç„¡éœ€ä¿®æ”¹ç¾æœ‰é¡åˆ¥
  - âœ… å–®ä¸€è·è²¬ï¼šæ¯å€‹è¨ªå•è€…åªè² è²¬ä¸€ç¨®æ“ä½œ
  - âœ… æ˜“æ–¼ç¶­è­·ï¼šé‚è¼¯æ¸…æ™°ï¼Œä»£ç¢¼çµ„ç¹”åˆç†

### Interface Segregation Principleï¼ˆæ¥å£éš”é›¢åŸå‰‡ï¼‰
- ä¸å¼·åˆ¶å®¢æˆ¶ç«¯ä¾è³´å®ƒå€‘ä¸ä½¿ç”¨çš„æ¥å£
- **è¨­è¨ˆåˆ†é›¢**ï¼š
  - \`IVisitor\`ï¼šæ ¸å¿ƒè¨ªå•å¥‘ç´„ï¼ˆvisit æ–¹æ³•ï¼‰
  - \`DepthManagedVisitor\`ï¼šæ“´å±•æ¥å£ï¼Œåƒ…ä¾›éœ€è¦æ·±åº¦ç®¡ç†çš„è¨ªå•è€…ä½¿ç”¨
- **å„ªå‹¢**ï¼š
  - ç°¡å–®è¨ªå•è€…ç„¡éœ€å¯¦ç¾ç„¡ç”¨æ–¹æ³•
  - ä»£ç¢¼æ›´æ¸…æ™°ï¼Œæ¸›å°‘å†—ä½™

### è¨­è¨ˆæ¨¡å¼æ‡‰ç”¨
1. **Composite Pattern**ï¼šæ¨¹ç‹€çµæ§‹ï¼ˆç›®éŒ„/æ–‡ä»¶ï¼‰
2. **Visitor Pattern**ï¼šä¸åŒçš„è¨ªå•æ“ä½œ
3. **Strategy Pattern**ï¼šä¸åŒè¨ªå•è€…çš„ä¸åŒç­–ç•¥
4. **Interface Segregation**ï¼šå…©å±¤æ¥å£æ¶æ§‹

## èª²ç¨‹å­¸ç¿’é‡é»

1. **ç†è§£é›™é‡åˆ†æ´¾**
   - è¨ªå•è€…æ¨¡å¼é€šé \`accept()\` å’Œ \`visit()\` å¯¦ç¾é›™é‡åˆ†æ´¾
   - æ ¹æ“šè¨ªå•è€…å’Œå…ƒç´ çš„é¡å‹æ±ºå®šåŸ·è¡Œçš„æ–¹æ³•
   - \`instanceof\` æª¢æŸ¥ç”¨æ–¼å‹•æ…‹è­˜åˆ¥è¨ªå•è€…é¡å‹

2. **åˆ†é›¢é—œæ³¨é»**
   - æ•¸æ“šçµæ§‹ï¼ˆComponentï¼‰èˆ‡æ“ä½œé‚è¼¯ï¼ˆVisitorï¼‰åˆ†é›¢
   - æ˜“æ–¼æ–°å¢åŠŸèƒ½è€Œç„¡éœ€ä¿®æ”¹ç¾æœ‰ä»£ç¢¼
   - DirectoryComposite çš„ \`accept()\` å±•ç¤ºäº†æ™ºèƒ½åˆ†æ´¾

3. **å¯¦ç¾å¯æ“´å±•æ€§**
   - è¦æ–°å¢çµ±è¨ˆã€å‚™ä»½ã€é©—è­‰ç­‰åŠŸèƒ½ï¼Ÿåªéœ€æ–°å¢ Visitor
   - ç¬¦åˆé–‹æ”¾å°é–‰åŸå‰‡ï¼ˆOpen/Closed Principleï¼‰
   - æ¯å€‹ Visitor å°ˆæ³¨æ–¼è‡ªå·±çš„è·è²¬

4. **æ¥å£è¨­è¨ˆæœ€ä½³å¯¦è¸**
   - æœ€å°åŒ–æ¥å£ï¼šIVisitor åªåŒ…å«å¿…é ˆæ–¹æ³•
   - åˆ†å±¤è¨­è¨ˆï¼šDepthManagedVisitor æ“´å±• IVisitor
   - é¿å…æ¥å£æ±¡æŸ“ï¼šä¸å¼·åˆ¶å¯¦ç¾ç„¡ç”¨æ–¹æ³•

## æ“´å±•ç·´ç¿’

å˜—è©¦å¯¦ç¾ä»¥ä¸‹ Visitorï¼š

1. **FileCountVisitor** - çµ±è¨ˆæª”æ¡ˆæ•¸é‡ï¼ˆå¯¦ç¾ IVisitorï¼‰
2. **BackupVisitor** - å‚™ä»½æ“ä½œï¼ˆå¯¦ç¾ IVisitorï¼Œä¸éœ€æ·±åº¦ï¼‰
3. **ValidateVisitor** - é©—è­‰æª”æ¡ˆå®Œæ•´æ€§ï¼ˆå¯¦ç¾ IVisitorï¼‰
4. **TreePrintVisitor** - ç¾åŒ–æ¨¹å½¢é¡¯ç¤ºï¼ˆå¯¦ç¾ DepthManagedVisitorï¼Œéœ€æ·±åº¦ï¼‰
5. **PermissionVisitor** - æ¬Šé™æª¢æŸ¥ï¼ˆå¯¦ç¾ IVisitorï¼‰

## Java ç·¨è­¯èˆ‡é‹è¡Œ

\`\`\`bash
# ç·¨è­¯æ‰€æœ‰æºæ–‡ä»¶
javac src/*.java

# é‹è¡Œä¸»ç¨‹åº
java -cp src FileSystemDemo

# è¼¸å‡ºç¯„ä¾‹å±•ç¤ºå››ç¨®è¨ªå•å™¨çš„æ•ˆæœ
\`\`\`

ç¥ä½ å­¸ç¿’æ„‰å¿«ï¼ ğŸ“
`);
            
            // ç”Ÿæˆä¸¦ä¸‹è¼‰ zip
            zip.generateAsync({type: 'blob'}).then(function(content) {
                const url = URL.createObjectURL(content);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'FileSystemDemo.zip';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                alert('âœ… æª”æ¡ˆå·²ä¸‹è¼‰ï¼è§£å£“å¾Œå³å¯ä½¿ç”¨ã€‚');
            });
        }
    </script>
</body>
</html>