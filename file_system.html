<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›²ç«¯æª”æ¡ˆç®¡ç†ç³»çµ± - éœ€æ±‚åˆ†æèˆ‡è¨­è¨ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ä½¿ç”¨æ¨™æº– Script è¼‰å…¥ Mermaid ä»¥ç¢ºä¿å…¨åŸŸå­˜å–ç©©å®šæ€§ -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <!-- Prism.js èªæ³•é«˜äº® -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <style>
        .tree-node { margin-left: 20px; border-left: 1px dashed #ccc; padding-left: 10px; position: relative; }
        .file-icon { color: #6b7280; }
        .folder-icon { color: #f59e0b; }
        .tab-content { display: none; opacity: 0; transition: opacity 0.3s ease-in-out; }
        .tab-content.active { display: block; opacity: 1; }
        .tab-btn.active { 
            border-bottom: 4px solid #1e40af; 
            color: #1e40af; 
            font-weight: 700;
        }
        .mermaid { min-height: 250px; display: flex; justify-content: center; }
        .control-panel { background: #f8fafc; border: 1px solid #e2e8f0; }
        .delete-btn { opacity: 0; transition: opacity 0.2s; }
        .tree-item-row:hover .delete-btn { opacity: 1; }
        #terminal-output { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 font-sans leading-relaxed">

    <div class="max-w-5xl mx-auto py-12 px-6">
        <!-- Header -->
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-extrabold text-blue-800 mb-4">é›²ç«¯æª”æ¡ˆç®¡ç†ç³»çµ±åˆ†æèˆ‡è¨­è¨ˆ</h1>
            <p class="text-lg text-gray-600">ç³»çµ±åˆ†æå¸«ï¼šGemini | ä¿®æ­£å¾Œçš„è³‡æ–™åº«æ¶æ§‹èˆ‡å¯¦ä½œ</p>
        </header>

        <!-- Tab Navigation -->
        <div class="flex border-b border-gray-200 mb-8 sticky top-0 bg-gray-50 z-20">
            <button onclick="openTab(event, 'arch')" class="tab-btn active px-6 py-3 text-gray-500 hover:text-blue-600 transition-all focus:outline-none">ç³»çµ±æ¶æ§‹</button>
            <button onclick="openTab(event, 'domain')" class="tab-btn px-6 py-3 text-gray-500 hover:text-blue-600 transition-all focus:outline-none">é ˜åŸŸæ¨¡å‹ (UML)</button>
            <button onclick="openTab(event, 'er')" class="tab-btn px-6 py-3 text-gray-500 hover:text-blue-600 transition-all focus:outline-none">è³‡æ–™åº«è¨­è¨ˆ (ERD)</button>
            <button onclick="openTab(event, 'demo')" class="tab-btn px-6 py-3 text-gray-500 hover:text-blue-600 transition-all focus:outline-none">ç³»çµ± Demo</button>
            <button onclick="openTab(event, 'java')" class="tab-btn px-6 py-3 text-gray-500 hover:text-blue-600 transition-all focus:outline-none">Java å¯¦ä½œ</button>
            <button onclick="openTab(event, 'guide')" class="tab-btn px-6 py-3 text-gray-500 hover:text-blue-600 transition-all focus:outline-none">å¦‚ä½•é¸æ“‡è¨­è¨ˆæ¨¡å¼</button>
        </div>

        <!-- 1. ç³»çµ±æ¶æ§‹èªªæ˜ -->
        <div id="arch" class="tab-content active">
            <section class="bg-white p-8 rounded-xl shadow-sm border border-gray-200">
                <h2 class="text-2xl font-bold border-b-2 border-blue-500 pb-2 mb-6">1. æ ¸å¿ƒè¨­è¨ˆè¦ç¯„</h2>
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-semibold mb-3 text-blue-700">ä¿®æ­£å¾Œçš„è³‡æ–™åº«æ€è·¯</h3>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li><strong>æ­£è¦åŒ–å¯¦é«”</strong>ï¼šé€é `USERS` èˆ‡ `NODES` çš„é—œè¯å¯¦ä½œæ¬Šé™åŸºç¤ã€‚</li>
                            <li><strong>é«˜æ“´å……æ€§</strong>ï¼šæ¡ç”¨ TPT æ¨¡å¼ï¼Œæœªä¾†è‹¥æ–°å¢ã€Œå½±ç‰‡ã€æˆ–ã€ŒéŸ³æ¨‚ã€é¡å‹ï¼Œåªéœ€å¢åŠ å…ƒæ•¸æ“šè¡¨ï¼Œä¸å½±éŸ¿æ ¸å¿ƒè¡¨çµæ§‹ã€‚</li>
                            <li><strong>éšå±¤å„ªåŒ–</strong>ï¼š`NODES` è¡¨çš„ `parent_id` å»ºç«‹ç´¢å¼•ï¼Œå„ªåŒ–éè¿´è®€å–æ•ˆèƒ½ã€‚</li>
                            <li><strong>æ¨™ç±¤ç³»çµ±</strong>ï¼šé€é `TAGS` è¡¨å¯¦ä½œå¤šå°å¤šé—œè¯ï¼Œæ”¯æ´ Urgentã€Workã€Personal ä¸‰ç¨®é è¨­æ¨™ç±¤ï¼Œå¯å½ˆæ€§æ“´å……ã€‚</li>
                            <li><strong>æ­·å²è¿½è¹¤</strong>ï¼šå…§å»º Undo/Redo æ©Ÿåˆ¶ï¼Œä¿ç•™æœ€è¿‘ 50 æ¬¡æ“ä½œç´€éŒ„ï¼Œæ”¯æ´æ“ä½œå›æº¯ã€‚</li>
                        </ul>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold mb-3 text-blue-800">æ–°å¢åŠŸèƒ½æ‘˜è¦</h3>
                        <ul class="text-sm space-y-2">
                            <li><strong>ğŸ”€ å¤šç¶­åº¦æ’åº</strong>ï¼šæ”¯æ´æŒ‰åç¨±ã€å¤§å°ã€å‰¯æª”åé€²è¡Œå‡/é™å†ªæ’åº</li>
                            <li><strong>ğŸ·ï¸ æ¨™ç±¤ç®¡ç†</strong>ï¼šæ¯å€‹ç¯€é»å¯è²¼ä¸Šå¤šå€‹æ¨™ç±¤ï¼ˆç·Šæ€¥/å·¥ä½œ/å€‹äººï¼‰ï¼Œä¾¿æ–¼åˆ†é¡</li>
                            <li><strong>ğŸ—‘ï¸ åˆªé™¤åŠŸèƒ½</strong>ï¼šå¯å®‰å…¨ç§»é™¤æª”æ¡ˆæˆ–è³‡æ–™å¤¾ï¼ˆä¿è­·æ ¹ç›®éŒ„ï¼‰</li>
                            <li><strong>â†¶â†· Undo/Redo</strong>ï¼šå®Œæ•´çš„æ“ä½œæ­·å²ç®¡ç†ï¼Œæœ€å¤šä¿ç•™ 50 ç­†ç´€éŒ„</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- è¨­è¨ˆæ¨¡å¼æ‡‰ç”¨ -->
            <section class="bg-white p-8 rounded-xl shadow-sm border border-gray-200 mt-6">
                <h2 class="text-2xl font-bold border-b-2 border-green-500 pb-2 mb-6">2. æ–°å¢åŠŸèƒ½çš„è¨­è¨ˆæ¨¡å¼æ‡‰ç”¨</h2>
                
                <div class="space-y-6">
                    <!-- æ’åºåŠŸèƒ½ - Strategy Pattern -->
                    <div class="bg-gradient-to-r from-indigo-50 to-blue-50 p-6 rounded-lg border-l-4 border-indigo-500">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">ğŸ”€</div>
                            <div class="flex-grow">
                                <h3 class="text-xl font-bold text-indigo-700 mb-2">æ’åºåŠŸèƒ½ - Strategy Patternï¼ˆç­–ç•¥æ¨¡å¼ï¼‰</h3>
                                <p class="text-gray-700 mb-3">
                                    æ’åºåŠŸèƒ½æ¡ç”¨ <strong>Strategy Pattern</strong>ï¼Œå°‡ä¸åŒçš„æ’åºç®—æ³•ï¼ˆæŒ‰åç¨±ã€å¤§å°ã€å‰¯æª”åï¼‰å°è£æˆç¨ç«‹çš„ç­–ç•¥ç‰©ä»¶ï¼Œ
                                    åœ¨åŸ·è¡Œæ™‚å‹•æ…‹é¸æ“‡é©ç•¶çš„æ’åºç­–ç•¥ï¼Œå¯¦ç¾æ¼”ç®—æ³•çš„å½ˆæ€§æ›¿æ›ã€‚
                                </p>
                                <div class="bg-white p-4 rounded-lg border border-indigo-200 text-sm">
                                    <h4 class="font-bold text-gray-700 mb-2">æ ¸å¿ƒæ¦‚å¿µï¼š</h4>
                                    <ul class="list-disc list-inside space-y-1 text-gray-600">
                                        <li><strong>Context</strong>ï¼š<code class="bg-gray-100 px-1 rounded">DirectoryComposite</code> æŒæœ‰æ’åºç­–ç•¥</li>
                                        <li><strong>Strategy Interface</strong>ï¼šæ’åºæ¨™æº–ï¼ˆname, size, extensionï¼‰ä½œç‚ºåƒæ•¸å‚³å…¥</li>
                                        <li><strong>Concrete Strategy</strong>ï¼šä½¿ç”¨ JavaScript/Java å…§å»ºçš„ Comparator å¯¦ä½œä¸åŒæ¯”è¼ƒé‚è¼¯</li>
                                        <li><strong>å„ªå‹¢</strong>ï¼šæ–°å¢æ’åºæ–¹å¼æ™‚ç„¡éœ€ä¿®æ”¹ç¾æœ‰ä»£ç¢¼ï¼Œç¬¦åˆ Open-Closed Principle</li>
                                    </ul>
                                    <pre class="mt-3 bg-gray-50 p-2 rounded text-xs overflow-x-auto"><code>// JavaScript å¯¦ä½œç¯„ä¾‹
sortChildren(sortBy, order) {
    let comparator;
    if (sortBy === 'name') comparator = (a, b) => a.name.localeCompare(b.name);
    else if (sortBy === 'size') comparator = (a, b) => a.size - b.size;
    else if (sortBy === 'extension') comparator = (a, b) => a.getExtension().localeCompare(b.getExtension());
    
    this.children.sort(order === 'asc' ? comparator : (a, b) => -comparator(a, b));
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æ¨™ç±¤ç³»çµ± - Decorator Pattern -->
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-lg border-l-4 border-purple-500">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">ğŸ·ï¸</div>
                            <div class="flex-grow">
                                <h3 class="text-xl font-bold text-purple-700 mb-2">æ¨™ç±¤ç³»çµ± - Composite Pattern æ“´å……ï¼ˆå±¬æ€§èšåˆï¼‰</h3>
                                <p class="text-gray-700 mb-3">
                                    æ¨™ç±¤ç³»çµ±é€šéåœ¨ <code class="bg-gray-100 px-1 rounded">SystemEntryComponent</code> åŸºç¤é¡ä¸­æ·»åŠ  <code class="bg-gray-100 px-1 rounded">tags</code> é›†åˆå±¬æ€§ï¼Œ
                                    å¯¦ç¾å°ç¯€é»çš„å¤šé‡æ¨™è¨˜åŠŸèƒ½ã€‚é€™ç¨®è¨­è¨ˆä¿æŒäº†åŸæœ‰ Composite Pattern çš„å®Œæ•´æ€§ï¼ŒåŒæ™‚æ“´å……äº†å…ƒæ•¸æ“šç®¡ç†èƒ½åŠ›ã€‚
                                </p>
                                <div class="bg-white p-4 rounded-lg border border-purple-200 text-sm">
                                    <h4 class="font-bold text-gray-700 mb-2">æ ¸å¿ƒæ¦‚å¿µï¼š</h4>
                                    <ul class="list-disc list-inside space-y-1 text-gray-600">
                                        <li><strong>å±¬æ€§èšåˆ</strong>ï¼šæ¯å€‹ç¯€é»æŒæœ‰ä¸€å€‹æ¨™ç±¤é›†åˆï¼ˆ<code class="bg-gray-100 px-1 rounded">List&lt;String&gt;</code>ï¼‰</li>
                                        <li><strong>å¤šå°å¤šé—œè¯</strong>ï¼šä¸€å€‹ç¯€é»å¯ä»¥æœ‰å¤šå€‹æ¨™ç±¤ï¼Œä¸€å€‹æ¨™ç±¤å¯ä»¥æ‡‰ç”¨æ–¼å¤šå€‹ç¯€é»</li>
                                        <li><strong>æ¨™ç±¤å®šç¾©</strong>ï¼šé è¨­ä¸‰ç¨®æ¨™ç±¤ï¼ˆUrgent/Work/Personalï¼‰ï¼Œæ¯ç¨®æœ‰å°ˆå±¬é¡è‰²é…ç½®</li>
                                        <li><strong>è³‡æ–™åº«è¨­è¨ˆ</strong>ï¼šé€é <code class="bg-gray-100 px-1 rounded">NODE_TAGS</code> ä¸­ä»‹è¡¨å¯¦ä½œå¤šå°å¤šé—œè¯</li>
                                        <li><strong>å„ªå‹¢</strong>ï¼šæ¨™ç±¤ä½œç‚ºç¨ç«‹å±¬æ€§ï¼Œä¸å½±éŸ¿æ ¸å¿ƒç¯€é»çµæ§‹ï¼Œæ˜“æ–¼æ“´å……å’ŒæŸ¥è©¢</li>
                                    </ul>
                                    <pre class="mt-3 bg-gray-50 p-2 rounded text-xs overflow-x-auto"><code>// æ¨™ç±¤ç®¡ç†æ–¹æ³•
addTag(tagName) { if (!this.tags.includes(tagName)) this.tags.push(tagName); }
removeTag(tagName) { this.tags = this.tags.filter(t => t !== tagName); }
hasTag(tagName) { return this.tags.includes(tagName); }

// æ¨™ç±¤å®šç¾©
const TAG_DEFINITIONS = {
    'Urgent': { color: 'red', bgColor: 'bg-red-100', textColor: 'text-red-700' },
    'Work': { color: 'blue', bgColor: 'bg-blue-100', textColor: 'text-blue-700' },
    'Personal': { color: 'green', bgColor: 'bg-green-100', textColor: 'text-green-700' }
};</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Undo/Redo - Memento Pattern -->
                    <div class="bg-gradient-to-r from-amber-50 to-orange-50 p-6 rounded-lg border-l-4 border-amber-500">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">â†¶â†·</div>
                            <div class="flex-grow">
                                <h3 class="text-xl font-bold text-amber-700 mb-2">Undo/Redo åŠŸèƒ½ - Memento Patternï¼ˆå‚™å¿˜éŒ„æ¨¡å¼ï¼‰</h3>
                                <p class="text-gray-700 mb-3">
                                    Undo/Redo åŠŸèƒ½æ¡ç”¨ <strong>Memento Pattern</strong>ï¼Œåœ¨æ¯æ¬¡æ“ä½œå‰ä¿å­˜æ•´å€‹æ¨¹ç‹€çµæ§‹çš„å¿«ç…§ï¼ˆæ·±åº¦è¤‡è£½ï¼‰ï¼Œ
                                    ä¸¦ç¶­è­·å…©å€‹å †ç–Šï¼ˆundoStack å’Œ redoStackï¼‰ä¾†ç®¡ç†æ­·å²ç‹€æ…‹ï¼Œå¯¦ç¾å®Œæ•´çš„æ“ä½œå›æº¯åŠŸèƒ½ã€‚
                                </p>
                                <div class="bg-white p-4 rounded-lg border border-amber-200 text-sm">
                                    <h4 class="font-bold text-gray-700 mb-2">æ ¸å¿ƒæ¦‚å¿µï¼š</h4>
                                    <ul class="list-disc list-inside space-y-1 text-gray-600">
                                        <li><strong>Originator</strong>ï¼š<code class="bg-gray-100 px-1 rounded">systemRoot</code>ï¼ˆç³»çµ±æ ¹ç¯€é»ï¼Œéœ€è¦ä¿å­˜ç‹€æ…‹çš„ç‰©ä»¶ï¼‰</li>
                                        <li><strong>Memento</strong>ï¼šæ•´å€‹æ¨¹ç‹€çµæ§‹çš„æ·±åº¦è¤‡è£½å¿«ç…§ï¼ˆåŒ…å«æ‰€æœ‰ç¯€é»å’Œæ¨™ç±¤ï¼‰</li>
                                        <li><strong>Caretaker</strong>ï¼š<code class="bg-gray-100 px-1 rounded">HistoryManager</code>ï¼ˆè² è²¬ç®¡ç†å¿«ç…§çš„å­˜å–ï¼‰</li>
                                        <li><strong>é›™å †ç–Šè¨­è¨ˆ</strong>ï¼šundoStack ä¿å­˜éå»ç‹€æ…‹ï¼ŒredoStack ä¿å­˜è¢«æ’¤éŠ·çš„ç‹€æ…‹</li>
                                        <li><strong>æ·±åº¦è¤‡è£½</strong>ï¼šéè¿´è¤‡è£½æ‰€æœ‰ç¯€é»ï¼Œç¢ºä¿ç‹€æ…‹ç¨ç«‹ï¼Œé¿å…å¼•ç”¨æ±¡æŸ“</li>
                                        <li><strong>å®¹é‡é™åˆ¶</strong>ï¼šæœ€å¤šä¿ç•™ 50 ç­†æ­·å²è¨˜éŒ„ï¼Œè‡ªå‹•æ¸…ç†æœ€èˆŠçš„è¨˜éŒ„</li>
                                    </ul>
                                    <pre class="mt-3 bg-gray-50 p-2 rounded text-xs overflow-x-auto"><code>// HistoryManager æ ¸å¿ƒå¯¦ä½œ
class HistoryManager {
    constructor() {
        this.undoStack = [];  // å„²å­˜éå»ç‹€æ…‹
        this.redoStack = [];  // å„²å­˜è¢«æ’¤éŠ·çš„ç‹€æ…‹
        this.maxHistorySize = 50;
    }
    
    saveState() {
        this.undoStack.push(this.cloneNode(systemRoot));  // æ·±åº¦è¤‡è£½
        if (this.undoStack.length > this.maxHistorySize) this.undoStack.shift();
        this.redoStack = [];  // æ–°æ“ä½œæœƒæ¸…ç©º redo stack
    }
    
    undo() {
        if (this.undoStack.length === 0) return false;
        this.redoStack.push(this.cloneNode(systemRoot));
        systemRoot = this.undoStack.pop();  // æ¢å¾©ä¸Šä¸€å€‹ç‹€æ…‹
        return true;
    }
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- è¨­è¨ˆæ¨¡å¼ç¸½çµ -->
                    <div class="bg-gradient-to-r from-green-50 to-teal-50 p-6 rounded-lg border-l-4 border-green-500">
                        <h3 class="text-xl font-bold text-green-700 mb-3">ğŸ¯ è¨­è¨ˆæ¨¡å¼å”åŒé‹ä½œ</h3>
                        <div class="grid md:grid-cols-3 gap-4 text-sm">
                            <div class="bg-white p-4 rounded-lg border border-green-200">
                                <div class="font-bold text-green-700 mb-2">ğŸ—ï¸ æ ¸å¿ƒæ¶æ§‹</div>
                                <ul class="text-gray-600 space-y-1">
                                    <li>â€¢ Composite Patternï¼ˆæ¨¹ç‹€çµæ§‹ï¼‰</li>
                                    <li>â€¢ Visitor Patternï¼ˆæ“ä½œè§£è€¦ï¼‰</li>
                                </ul>
                            </div>
                            <div class="bg-white p-4 rounded-lg border border-green-200">
                                <div class="font-bold text-green-700 mb-2">ğŸ”§ åŠŸèƒ½æ“´å……</div>
                                <ul class="text-gray-600 space-y-1">
                                    <li>â€¢ Strategy Patternï¼ˆæ’åºç­–ç•¥ï¼‰</li>
                                    <li>â€¢ å±¬æ€§èšåˆï¼ˆæ¨™ç±¤ç®¡ç†ï¼‰</li>
                                </ul>
                            </div>
                            <div class="bg-white p-4 rounded-lg border border-green-200">
                                <div class="font-bold text-green-700 mb-2">ğŸ’¾ ç‹€æ…‹ç®¡ç†</div>
                                <ul class="text-gray-600 space-y-1">
                                    <li>â€¢ Memento Patternï¼ˆæ­·å²è¨˜éŒ„ï¼‰</li>
                                    <li>â€¢ Deep Cloneï¼ˆç‹€æ…‹å¿«ç…§ï¼‰</li>
                                </ul>
                            </div>
                        </div>
                        <p class="mt-4 text-gray-700 text-sm">
                            é€™äº›è¨­è¨ˆæ¨¡å¼ç›¸äº’é…åˆï¼Œå½¢æˆä¸€å€‹éˆæ´»ã€å¯æ“´å……çš„æª”æ¡ˆç®¡ç†ç³»çµ±æ¶æ§‹ã€‚
                            æ ¸å¿ƒçš„ Composite å’Œ Visitor Pattern æä¾›ç©©å®šçš„åŸºç¤ï¼Œè€Œ Strategy å’Œ Memento Pattern å‰‡ç‚ºç³»çµ±å¸¶ä¾†å¼·å¤§çš„åŠŸèƒ½æ“´å……èƒ½åŠ›ã€‚
                        </p>
                    </div>
                </div>
            </section>
        </div>

        <!-- 2. Domain Model (UML) -->
        <div id="domain" class="tab-content">
            <section class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <h2 class="text-2xl font-bold border-b-2 border-blue-500 pb-2 mb-6">2. é ˜åŸŸæ¨¡å‹ (Domain Model)</h2>
                
                <!-- åŸå§‹è¨­è¨ˆ -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-blue-700 mb-3">ğŸ“‹ è¨­è¨ˆæ–¹å¼ 1: åŸºæœ¬æ¨¹ç‹€çµæ§‹ (Composite Pattern)</h3>
                    <div class="overflow-x-auto py-4">
                        <pre class="mermaid">
classDiagram
    class Node {
        &lt;&lt;abstract&gt;&gt;
        +UUID id
        +String name
        +DateTime created_at
        +get_display_name() String
        +toXML() String
        +getTotalSize() long
    }

    class Folder {
        +List~Node~ children
        +add_child(Node node)
        +remove_child(UUID id)
        +find_by_extension(String ext) List~Node~
    }

    class File {
        &lt;&lt;abstract&gt;&gt;
        +long size_bytes
        +get_size_display() String
    }

    class WordDocument { +int pages }
    class ImageFile { +int width, int height }
    class TextFile { +String encoding }

    Node <|-- Folder
    Node <|-- File
    File <|-- WordDocument
    File <|-- ImageFile
    File <|-- TextFile
    Folder "1" o-- "*" Node : contains
                        </pre>
                    </div>
                </div>

                <!-- Visitor Pattern è¨­è¨ˆ -->
                <div>
                    <h3 class="text-lg font-semibold text-blue-700 mb-3">âœ¨ è¨­è¨ˆæ–¹å¼ 2: Visitor Pattern (è¨ªå•è€…æ¨¡å¼)</h3>
                    <p class="text-gray-600 text-sm mb-4">
                        ä½¿ç”¨ Visitor Pattern å¯ä»¥å°‡ä¸åŒçš„æ“ä½œï¼ˆå¦‚å¤§å°è¨ˆç®—ã€æœå°‹ã€åŒ¯å‡ºç­‰ï¼‰èˆ‡è³‡æ–™çµæ§‹åˆ†é›¢ï¼Œ
                        ä½¿å¾—æ–°å¢æ“ä½œæ™‚ç„¡éœ€ä¿®æ”¹ç¾æœ‰çš„ç¯€é»é¡åˆ¥ã€‚æ¯å€‹è¨ªå•è€…è² è²¬ç‰¹å®šæ“ä½œçš„é‚è¼¯ã€‚
                    </p>
                    <div class="overflow-x-auto py-4">
                        <pre class="mermaid">
classDiagram
    class SystemEntryComponent {
        &lt;&lt;abstract&gt;&gt;
        #String name
        #DateTime created
        #int size
        #String attributes
        #List~String~ tags
        +abstract String getType()
        +void accept(IVisitor visitor)
        #abstract void accept(IVisitor visitor, int depth)
        +String getSizeDisplay()
        +void addTag(String tag)
        +void removeTag(String tag)
        +boolean hasTag(String tag)
        +String getExtension()
    }

    class FileLeaf {
        &lt;&lt;abstract&gt;&gt;
        +void accept(IVisitor visitor)
        #void accept(IVisitor visitor, int depth)
    }

    class DirectoryComposite {
        -List~SystemEntryComponent~ children
        +void add(SystemEntryComponent child)
        +void remove(SystemEntryComponent child)
        +SystemEntryComponent[] getChildren()
        +String getType()
        +void accept(IVisitor visitor)
        #void accept(IVisitor visitor, int depth)
        +void sortChildren(String sortBy, String order)
    }

    class WordDocumentLeaf {
        -int pages
        +int getPages()
    }
    class ImageFileLeaf {
        -int width
        -int height
        +int getWidth()
        +int getHeight()
    }
    class TextFileLeaf {
        -String encoding
        +String getEncoding()
    }

    class Tag {
        +String name
        +String color
        +String bgColor
        +String textColor
        +String borderColor
    }

    class HistoryManager {
        -Stack~SystemEntryComponent~ undoStack
        -Stack~SystemEntryComponent~ redoStack
        -int maxHistorySize
        +void saveState()
        +boolean undo()
        +boolean redo()
        +boolean canUndo()
        +boolean canRedo()
        -SystemEntryComponent cloneNode(node)
    }

    class IVisitor {
        &lt;&lt;interface&gt;&gt;
        +void visit(FileLeaf leaf, int depth)
        +void visit(DirectoryComposite composite, int depth)
    }



    class SizeCalculatorVisitor {
        -long totalSize
        +void visit(FileLeaf leaf, int depth)*
        +void visit(DirectoryComposite composite, int depth)*
        +long getTotalSize()
    }

    class FileSearchVisitor {
        -String extension
        -List~FileLeaf~ results
        +void visit(FileLeaf leaf, int depth)*
        +void visit(DirectoryComposite composite, int depth)*
        +List~FileLeaf~ getResults()
    }

    class TreeDisplayVisitor {
        -StringBuilder output
        -boolean isRoot
        +void visit(FileLeaf leaf, int depth)*
        +void visit(DirectoryComposite composite, int depth)*
        +String getOutput()
    }

    class XMLExportVisitor {
        -StringBuilder xmlOutput
        -boolean isRoot
        -Stack~ClosingTag~ pendingCloseTags
        +void visit(FileLeaf leaf, int depth)*
        +void visit(DirectoryComposite composite, int depth)*
        +String getXMLOutput()
    }

    SystemEntryComponent <|-- FileLeaf
    SystemEntryComponent <|-- DirectoryComposite
    FileLeaf <|-- WordDocumentLeaf
    FileLeaf <|-- ImageFileLeaf
    FileLeaf <|-- TextFileLeaf
    DirectoryComposite "1" o-- "*" SystemEntryComponent : contains
    SystemEntryComponent "1" o-- "*" Tag : has
    HistoryManager "1" --> "*" SystemEntryComponent : manages history
    IVisitor <|.. SizeCalculatorVisitor
    IVisitor <|.. FileSearchVisitor
    IVisitor <|.. TreeDisplayVisitor
    IVisitor <|.. XMLExportVisitor
    SystemEntryComponent --> IVisitor : depend
                        </pre>
                    </div>
                    
                    <div class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <h4 class="font-bold text-blue-700 mb-2">ğŸ’¡ Visitor Pattern çš„å„ªå‹¢ï¼š</h4>
                        <ul class="text-sm text-gray-700 list-disc list-inside space-y-1">
                            <li><strong>é–‹æ”¾å°é–‰åŸå‰‡</strong>ï¼šæ–°å¢æ“ä½œæ™‚ç„¡éœ€ä¿®æ”¹ç¯€é»é¡åˆ¥ï¼Œåªéœ€æ–°å¢ Visitor å¯¦ä½œ</li>
                            <li><strong>è·è²¬åˆ†é›¢</strong>ï¼šè³‡æ–™çµæ§‹èˆ‡æ“ä½œé‚è¼¯å®Œå…¨åˆ†é›¢ï¼Œä»£ç¢¼æ›´æ˜“ç¶­è­·</li>
                            <li><strong>æ“´å±•æ€§å¼·</strong>ï¼šæ”¯æ´çµ±è¨ˆã€æœå°‹ã€é©—è­‰ã€å‚™ä»½ç­‰å¤šç¨®æ“ä½œï¼Œæ¯å€‹éƒ½æ˜¯ç¨ç«‹çš„ Visitor</li>
                            <li><strong>é›™é‡åˆ†æ´¾</strong>ï¼šæ ¹æ“šè¨ªå•è€…å’Œç¯€é»çš„å…·é«”é¡å‹æ±ºå®šåŸ·è¡Œçš„æ–¹æ³•</li>
                            <li><strong>ç°¡æ½”è¨­è¨ˆ</strong>ï¼šVisitor æ¥å£åªéœ€å…©å€‹ Visit æ–¹æ³•ï¼ˆè‘‰å­ã€è¤‡åˆç¯€é»ï¼‰</li>
                        </ul>
                    </div>

                    <div class="mt-4 p-4 bg-amber-50 rounded-lg border border-amber-200">
                        <h4 class="font-bold text-amber-700 mb-2">ğŸ“ å¯¦ä½œé—œéµï¼š</h4>
                        <pre class="text-xs bg-white p-2 rounded border border-amber-100 overflow-x-auto"><code>// åŸºç¤å…ƒä»¶å®šç¾© accept æ–¹æ³•
abstract class SystemEntryComponent {
    // å…¬é–‹æ–¹æ³•ï¼šå¤–éƒ¨èª¿ç”¨
    void accept(IVisitor visitor) {
        accept(visitor, 0)  // è‡ªå‹•å¾æ·±åº¦ 0 é–‹å§‹
    }
    
    // å…§éƒ¨æ–¹æ³•ï¼šéè¿´ä½¿ç”¨
    abstract void accept(IVisitor visitor, int depth)
}

// è‘‰å­ç¯€é»å¯¦ä½œ
abstract class FileLeaf extends SystemEntryComponent {
    void accept(IVisitor visitor, int depth) {
        visitor.visit(this, depth)
    }
}

// è¤‡åˆç¯€é»å¯¦ä½œ
class DirectoryComposite extends SystemEntryComponent {
    List children = []
    
    void accept(IVisitor visitor, int depth) {
        visitor.visit(this, depth)        // è¨ªå•è‡ªèº«
        children.forEach(child => child.accept(visitor, depth + 1))  // éè¿´è¨ªå•å­ç¯€é»ï¼Œæ·±åº¦+1
    }
}

// è¨ªå•è€…æ¥å£ - ç°¡æ½”è¨­è¨ˆ
interface IVisitor {
    void visit(FileLeaf leaf, int depth)
    void visit(DirectoryComposite composite, int depth)
}</code></pre>
                    </div>

                    <div class="mt-4 p-4 bg-red-50 rounded-lg border border-red-200">
                        <h4 class="font-bold text-red-700 mb-2">â“ å¦‚ä½•è™•ç†æ·±åº¦ç®¡ç†ï¼Ÿ</h4>
                        <p class="text-sm text-gray-700 mb-3">
                            ä½¿ç”¨<strong>æ–¹æ³•é‡è¼‰</strong>ï¼šå¤–éƒ¨èª¿ç”¨ç°¡æ½”çš„ <code>accept(visitor)</code>ï¼Œå…§éƒ¨éè¿´ä½¿ç”¨ <code>accept(visitor, depth)</code> åƒæ•¸å‚³éæ·±åº¦ã€‚
                        </p>
                        <div class="bg-white p-3 rounded border border-red-100 text-xs">
                            <strong>å…·é«”ä¾‹å­ï¼š</strong>
                            <pre class="mt-2 overflow-x-auto"><code>å¤–éƒ¨èª¿ç”¨ï¼š
root.accept(visitor);  // ç°¡æ½”ï¼ä¸éœ€è¦çŸ¥é“åˆå§‹ depth

å…§éƒ¨å¯¦ä½œï¼š
public void accept(IVisitor visitor) {
    accept(visitor, 0);  // è‡ªå‹•å¾ 0 é–‹å§‹
}

void accept(IVisitor visitor, int depth) {
    visitor.visit(this, depth);
    children.forEach(c -> c.accept(visitor, depth + 1));
}

å„ªé»ï¼šå¤–éƒ¨ API ç°¡æ½”ï¼Œå…§éƒ¨ä¿æŒç„¡ç‹€æ…‹è¨­è¨ˆ

ç¼©è¿› = "  ".repeat(depth)ï¼Œæ‰€ä»¥ï¼š
- depth=0: ç„¡ç¼©è¿›
- depth=1: "  " (2å€‹ç©ºæ ¼)
- depth=2: "    " (4å€‹ç©ºæ ¼)</code></pre>
                        </div>
                        <p class="text-sm text-gray-700 mt-3">
                            <strong>é—œéµè¨­è¨ˆï¼š</strong>ç”± DirectoryComposite çš„ accept() æ–¹æ³•è² è²¬ç®¡ç†æ·±åº¦å¢æ¸›ï¼Œ
                            Visitor çš„ visit() æ–¹æ³•åªä½¿ç”¨ depth å€¼ï¼Œä¸ä¿®æ”¹å®ƒã€‚é€™æ¨£å¯ä»¥è®“è¨ªå•è€…çš„é‚è¼¯ä¿æŒç°¡æ½”ã€‚
                        </p>
                    </div>

                    <div class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                        <h4 class="font-bold text-yellow-700 mb-2">âš–ï¸ æ¡ç”¨ã€Œæ¥å£éš”é›¢åŸå‰‡ã€çš„è¨­è¨ˆ</h4>
                        <p class="text-sm text-gray-700 mb-3">
                            <strong>è¨­è¨ˆæ”¹é€²ï¼š</strong>å‰µå»ºå…©å€‹æ¥å£ï¼Œåªæœ‰éœ€è¦æ·±åº¦ç®¡ç†çš„ Visitor æ‰å¯¦ç¾ DepthManagedVisitorã€‚
                        </p>
                        <pre class="text-xs bg-white p-2 rounded border border-yellow-100 overflow-x-auto"><code>// åŸºç¤è¨ªå•è€…æ¥å£
interface IVisitor {
    void visit(FileLeaf leaf)
    void visit(DirectoryComposite composite)
}

// éœ€è¦æ·±åº¦ç®¡ç†çš„è¨ªå•è€…æ¥å£
interface DepthManagedVisitor extends IVisitor {
    void increaseDepth()
    void decreaseDepth()
}

// DirectoryComposite çš„ accept æ–¹æ³•
void accept(IVisitor visitor) {
    visitor.visit(this);
    if (visitor instanceof DepthManagedVisitor) {
        DepthManagedVisitor dmv = (DepthManagedVisitor) visitor;
        dmv.increaseDepth();
        this.children.forEach(child => child.accept(visitor));
        dmv.decreaseDepth();
    } else {
        // ä¸éœ€è¦æ·±åº¦ç®¡ç†çš„è¨ªå•è€…
        this.children.forEach(child => child.accept(visitor));
    }
}

// å¯¦ç¾ç¯„ä¾‹
class SizeCalculatorVisitor implements IVisitor {
    // åªå¯¦ç¾å¿…è¦çš„æ–¹æ³•ï¼Œç„¡éœ€ç©ºæ–¹æ³•
}

class DisplayVisitor implements DepthManagedVisitor {
    private int depth = 0;
    
    @Override
    public void increaseDepth() { depth++; }
    
    @Override
    public void decreaseDepth() { if (depth > 0) depth--; }
}</code></pre>
                        <p class="text-sm text-gray-700 mt-3">
                            <strong>å„ªå‹¢ï¼š</strong>
                        </p>
                        <ul class="text-sm text-gray-700 list-disc list-inside space-y-1">
                            <li>âœ… <strong>æ¥å£éš”é›¢</strong>ï¼šåªå¼·åˆ¶å¯¦ç¾å¿…è¦çš„æ–¹æ³•</li>
                            <li>âœ… <strong>ä»£ç¢¼æ¸…æ™°</strong>ï¼šä¸€ç›®äº†ç„¶èª°éœ€è¦æ·±åº¦ç®¡ç†</li>
                            <li>âœ… <strong>éˆæ´»æ“´å±•</strong>ï¼šæ–°å¢ Visitor æ™‚ç„¡éœ€æ±ºå®šæ˜¯å¦å¯¦ç¾ç©ºæ–¹æ³•</li>
                            <li>âœ… <strong>ç¬¦åˆ SOLID åŸå‰‡</strong>ï¼šå®¢æˆ¶ç«¯åªä¾è³´éœ€è¦çš„æ¥å£</li>

                        </ul>
                        <p class="text-sm text-yellow-700 mt-3 font-bold">
                            ğŸ’¡ æœ¬å¯¦ä½œä¸­æ¡ç”¨äº†ã€Œå¯¦ç¾ç©ºæ–¹æ³•ã€çš„æ–¹å¼ï¼Œé€™å°æ–¼å°å‹é …ç›®æ˜¯å¯æ¥å—çš„æŠ˜è¡·æ–¹æ¡ˆã€‚
                            ä½†å°æ–¼å¤§å‹é …ç›®ï¼Œæ‡‰å„ªå…ˆè€ƒæ…®ã€Œæ¥å£éš”é›¢ã€çš„æ–¹æ¡ˆã€‚
                        </p>
                    </div>

                    <div class="mt-4 p-4 bg-green-50 rounded-lg border border-green-200">
                        <h4 class="font-bold text-green-700 mb-2">ğŸ”§ å…·é«” Visitor å¯¦ç¾ç¯„ä¾‹ï¼š</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h5 class="text-sm font-bold text-green-700 mb-1">å¤§å°è¨ˆç®—å™¨</h5>
                                <pre class="text-xs bg-white p-2 rounded border border-green-100 overflow-x-auto"><code>class SizeCalculatorVisitor {
    totalSize = 0
    
    visit(leaf: FileLeaf) {
        totalSize += leaf.size
    }
    
    visit(composite: DirectoryComposite) {
        // åªè¨˜éŒ„è¨ªå•äº‹ä»¶
        // éè¿´ç”± accept è™•ç†
    }
    
    getTotalSize() {
        return totalSize
    }
}</code></pre>
                            </div>
                            <div>
                                <h5 class="text-sm font-bold text-green-700 mb-1">æ–‡ä»¶æœå°‹å™¨</h5>
                                <pre class="text-xs bg-white p-2 rounded border border-green-100 overflow-x-auto"><code>class FileSearchVisitor {
    extension: String
    results: List = []
    
    visit(leaf: FileLeaf) {
        if (leaf.name.endsWith(extension)) {
            results.push(leaf)
        }
    }
    
    visit(composite: DirectoryComposite) {
        // ç›´æ¥è¨ªå•ï¼Œéè¿´ç”±
        // accept æ–¹æ³•è™•ç†
    }
    
    getResults() {
        return results
    }
}</code></pre>
                            </div>
                        </div>
                        <div class="mt-2">
                            <h5 class="text-sm font-bold text-green-700 mb-1">XML åŒ¯å‡ºå™¨</h5>
                            <pre class="text-xs bg-white p-2 rounded border border-green-100 overflow-x-auto"><code>class XMLExportVisitor {
    xmlOutput: String = ""
    depth: int = 0
    
    visit(leaf: FileLeaf) {
        indent = "  ".repeat(depth)
        xmlOutput += `${indent}<${leaf.name} type="${leaf.type}"></${leaf.name}>\n`
    }
    
    visit(composite: DirectoryComposite) {
        if (!isRoot) {
            indent = "  ".repeat(depth)
            xmlOutput += `${indent}<${composite.name} type="ç›®éŒ„">\n`
        }
        isRoot = false
        // å­ç¯€é»éè¿´ç”± accept æ–¹æ³•è™•ç†
        // å›åˆ°æ­¤å±¤å¾Œé—œé–‰æ¨™ç±¤
        if (depth > 0) {
            indent = "  ".repeat(depth)
            xmlOutput += `${indent}</${composite.name}>\n`
        }
    }
    
    increaseDepth() { depth++ }
    decreaseDepth() { if (depth > 0) depth-- }
    getXMLOutput() { return xmlOutput }
}</code></pre>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- 3. ER Diagram (ä¿®æ­£å¾Œçš„è¨­è¨ˆ) -->
        <div id="er" class="tab-content">
            <section class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <h2 class="text-2xl font-bold border-b-2 border-blue-500 pb-2 mb-6">3. ä¿®æ­£å¾Œçš„è³‡æ–™åº«è¨­è¨ˆ (ER Diagram)</h2>
                <div class="overflow-x-auto py-4">
                    <pre class="mermaid">
erDiagram
    USERS ||--o{ NODES : "owns"
    NODES ||--o{ NODES : "contains (parent_id)"
    NODES ||--o| FILES : "specializes"
    FILES ||--o| WORD_DOCS : "is_type"
    FILES ||--o| IMAGE_FILES : "is_type"
    FILES ||--o| TEXT_FILES : "is_type"
    NODES ||--o{ NODE_TAGS : "has"
    TAGS ||--o{ NODE_TAGS : "applied_to"
    USERS ||--o{ OPERATION_HISTORY : "performs"

    USERS {
        uuid id PK
        string username "ä½¿ç”¨è€…åç¨±"
        string email "é›»å­éƒµä»¶"
    }

    NODES {
        uuid id PK
        uuid parent_id FK "çˆ¶ç¯€é» ID"
        uuid owner_id FK "æ“æœ‰è€… ID"
        string name "åç¨±"
        enum node_type "FOLDER, FILE"
        datetime created_at
        datetime updated_at
    }

    FILES {
        uuid node_id PK, FK "é—œè¯è‡³ NODES"
        bigint size_bytes "æª”æ¡ˆå¤§å°"
        string checksum "æ ¡é©—ç¢¼"
    }

    WORD_DOCS {
        uuid file_id PK, FK
        int page_count "é æ•¸"
        string author "ä½œè€…"
    }

    IMAGE_FILES {
        uuid file_id PK, FK
        int width "åƒç´ å¯¬"
        int height "åƒç´ é«˜"
        string color_space "å¦‚ RGB"
    }

    TEXT_FILES {
        uuid file_id PK, FK
        string encoding "å¦‚ UTF-8"
        boolean has_bom "æ˜¯å¦æœ‰ BOM"
    }

    TAGS {
        int id PK
        string name "æ¨™ç±¤åç¨± (Urgent/Work/Personal)"
        string color "é¡è‰²ä»£ç¢¼"
        string description "æ¨™ç±¤æè¿°"
    }

    NODE_TAGS {
        uuid node_id PK, FK "ç¯€é» ID"
        int tag_id PK, FK "æ¨™ç±¤ ID"
        datetime tagged_at "è²¼æ¨™ç±¤æ™‚é–“"
    }

    OPERATION_HISTORY {
        uuid id PK
        uuid user_id FK "æ“ä½œè€… ID"
        enum operation_type "CREATE, DELETE, UPDATE, TAG, SORT"
        uuid target_node_id FK "ç›®æ¨™ç¯€é»"
        text before_state "æ“ä½œå‰ç‹€æ…‹ (JSON)"
        text after_state "æ“ä½œå¾Œç‹€æ…‹ (JSON)"
        datetime created_at "æ“ä½œæ™‚é–“"
    }
                    </pre>
                </div>
                <div class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-100">
                    <h4 class="font-bold text-gray-700 mb-2">ä¿®æ­£é‡é»è§£æï¼š</h4>
                    <ul class="text-sm text-gray-600 list-disc list-inside space-y-1">
                        <li><strong>å¯¦é«”åŒ–ä½¿ç”¨è€…</strong>ï¼šæª”æ¡ˆç³»çµ±ä¸å†æ˜¯å­¤ç«‹çš„ï¼Œç¾åœ¨æ¯å€‹ç¯€é»éƒ½æœ‰æ˜ç¢ºçš„ `owner_id`ã€‚</li>
                        <li><strong>è§£æ±ºç©ºå€¼å•é¡Œ</strong>ï¼šé€é `FILES` ä¸­ä»‹è¡¨èˆ‡å„ `_METADATA` è¡¨çš„ 1:1 é—œè¯ï¼Œè³‡æ–™åº«ä¸­ä¸å†æœ‰å¤§é‡çš„ NULL æ¬„ä½ã€‚</li>
                        <li><strong>ç¶­è­·ä¸€è‡´æ€§</strong>ï¼šå°‡ `updated_at` ç¨ç«‹å‡ºä¾†ï¼Œæ–¹ä¾¿è¿½è¹¤è³‡æ–™å¤¾å…§å®¹çš„æœ€å¾Œè®Šå‹•æ™‚é–“ã€‚</li>
                        <li><strong>æ¨™ç±¤ç³»çµ±</strong>ï¼šé€é `NODE_TAGS` å¤šå°å¤šé—œè¯è¡¨å¯¦ä½œå½ˆæ€§æ¨™ç±¤åŠŸèƒ½ï¼Œæ”¯æ´æ¯å€‹ç¯€é»è²¼ä¸Šå¤šå€‹æ¨™ç±¤ã€‚</li>
                        <li><strong>æ“ä½œæ­·å²</strong>ï¼š`OPERATION_HISTORY` è¡¨ç´€éŒ„æ‰€æœ‰æ“ä½œï¼Œæ”¯æ´ Undo/Redo åŠŸèƒ½ï¼Œä¿ç•™å®Œæ•´çš„æ“ä½œè»Œè·¡ã€‚</li>
                    </ul>
                </div>
            </section>
        </div>

        <!-- 4. ç³»çµ±å¯¦ä½œèˆ‡ Demo -->
        <div id="demo" class="tab-content">
            <section class="space-y-6">
                <!-- äº’å‹•æ§åˆ¶é¢æ¿ -->
                <div class="control-panel p-6 rounded-xl shadow-sm">
                    <h3 class="text-lg font-bold mb-4 text-blue-800 flex items-center">
                        <span class="mr-2">ğŸ› ï¸</span> äº’å‹•æ§åˆ¶é¢æ¿
                    </h3>
                    
                    <!-- æ–°å¢åŠŸèƒ½åˆ— -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1 uppercase">æ–°å¢è‡³è³‡æ–™å¤¾</label>
                            <select id="parent-select" class="w-full p-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 bg-white"></select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1 uppercase">ç‰©ä»¶é¡å‹</label>
                            <select id="type-select" onchange="toggleFields()" class="w-full p-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 bg-white">
                                <option value="FOLDER">ğŸ“ è³‡æ–™å¤¾</option>
                                <option value="WORD">ğŸ“„ Word æª”æ¡ˆ</option>
                                <option value="IMAGE">ğŸ–¼ï¸ åœ–ç‰‡æª”æ¡ˆ</option>
                                <option value="TEXT">ğŸ“„ ç´”æ–‡å­—æª”</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1 uppercase">åç¨±</label>
                            <div class="flex gap-2">
                                <input type="text" id="node-name" placeholder="åç¨±" class="flex-grow p-2 border border-gray-300 rounded text-sm">
                                <button onclick="handleAddNode()" class="bg-blue-600 text-white px-4 rounded text-sm font-bold">æ–°å¢</button>
                            </div>
                        </div>
                    </div>

                    <!-- é€²éšæ“ä½œæŒ‰éˆ•åˆ— -->
                    <div class="border-t border-gray-200 pt-4 mt-2">
                        <label class="block text-xs font-bold text-gray-400 mb-3 uppercase tracking-widest">é€²éšåˆ†æåŠŸèƒ½</label>
                        <div class="flex flex-wrap gap-3">
                            <button onclick="showTotalSize()" class="bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-bold py-2 px-4 rounded shadow-sm transition-colors">
                                ğŸ“Š è¨ˆç®—ç¸½å¤§å°
                            </button>
                            <button onclick="findDocxFiles()" class="bg-amber-600 hover:bg-amber-700 text-white text-xs font-bold py-2 px-4 rounded shadow-sm transition-colors">
                                ğŸ” æ‰¾å°‹ .docx æª”æ¡ˆ
                            </button>
                            <button onclick="exportToXML()" class="bg-purple-600 hover:bg-purple-700 text-white text-xs font-bold py-2 px-4 rounded shadow-sm transition-colors">
                                ğŸ“œ åŒ¯å‡º XML æ ¼å¼
                            </button>
                            <button onclick="refreshUI()" class="bg-gray-500 hover:bg-gray-600 text-white text-xs font-bold py-2 px-4 rounded shadow-sm transition-colors ml-auto">
                                ğŸ”„ é‚„åŸçµæ§‹æª¢è¦–
                            </button>
                        </div>
                    </div>

                    <!-- æ’åºèˆ‡æ­·å²æ“ä½œ -->
                    <div class="border-t border-gray-200 pt-4 mt-4">
                        <label class="block text-xs font-bold text-gray-400 mb-3 uppercase tracking-widest">æ’åºèˆ‡æ­·å²æ“ä½œ</label>
                        <div class="flex flex-wrap gap-3 items-end">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">æ’åºä¾æ“š</label>
                                <select id="sort-by" class="p-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 bg-white">
                                    <option value="name">åç¨±</option>
                                    <option value="size">å¤§å°</option>
                                    <option value="extension">å‰¯æª”å</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">æ’åºæ–¹å‘</label>
                                <select id="sort-order" class="p-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 bg-white">
                                    <option value="asc">å‡å†ª â¬†</option>
                                    <option value="desc">é™å†ª â¬‡</option>
                                </select>
                            </div>
                            <button onclick="handleSort()" class="bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-bold py-2 px-4 rounded shadow-sm transition-colors">
                                ğŸ”€ åŸ·è¡Œæ’åº
                            </button>
                            <div class="flex gap-2 ml-auto">
                                <button id="undo-btn" onclick="handleUndo()" disabled class="bg-gray-600 hover:bg-gray-700 text-white text-xs font-bold py-2 px-4 rounded shadow-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                    â†¶ Undo
                                </button>
                                <button id="redo-btn" onclick="handleRedo()" disabled class="bg-gray-600 hover:bg-gray-700 text-white text-xs font-bold py-2 px-4 rounded shadow-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                    â†· Redo
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- ç‰¹æ®Šæ¬„ä½ -->
                    <div id="extra-fields" class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-4 hidden p-3 bg-blue-50 rounded">
                        <div id="field-pages">
                            <label class="block text-xs font-bold text-gray-500 mb-1">é æ•¸</label>
                            <input type="number" id="node-pages" value="1" class="w-full p-2 border rounded text-sm">
                        </div>
                        <div id="field-width" class="hidden">
                            <label class="block text-xs font-bold text-gray-500 mb-1">å¯¬åº¦</label>
                            <input type="number" id="node-width" value="1920" class="w-full p-2 border rounded text-sm">
                        </div>
                        <div id="field-height" class="hidden">
                            <label class="block text-xs font-bold text-gray-500 mb-1">é«˜åº¦</label>
                            <input type="number" id="node-height" value="1080" class="w-full p-2 border rounded text-sm">
                        </div>
                        <div id="field-encoding" class="hidden">
                            <label class="block text-xs font-bold text-gray-500 mb-1">ç·¨ç¢¼</label>
                            <select id="node-encoding" class="w-full p-2 border rounded text-sm">
                                <option value="UTF-8">UTF-8</option>
                                <option value="ASCII">ASCII</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">å¤§å° (B)</label>
                            <input type="number" id="node-size" value="1024" class="w-full p-2 border rounded text-sm">
                        </div>
                    </div>
                </div>

                <!-- çµæœå‘ˆç¾ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <h3 id="terminal-title" class="text-sm font-bold mb-3 text-gray-400 uppercase tracking-widest">çµ‚ç«¯æ©Ÿè¼¸å‡º</h3>
                        <div class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-xs overflow-x-auto border-l-4 border-green-500 h-96 shadow-inner">
                            <pre id="terminal-output">// ç³»çµ±æº–å‚™å°±ç·’...</pre>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <h3 class="text-sm font-bold mb-3 text-gray-400 uppercase tracking-widest">è¦–è¦ºåŒ–çµæ§‹åœ–</h3>
                        <div id="tree-visual" class="space-y-1 bg-gray-50 p-4 rounded-lg border border-gray-100 h-96 overflow-y-auto shadow-inner text-sm"></div>
                    </div>
                </div>

                <!-- æ¨™ç±¤ç®¡ç†æ¨¡æ…‹æ¡† -->
                <div id="tag-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold text-gray-800">ğŸ·ï¸ ç®¡ç†æ¨™ç±¤</h3>
                            <button onclick="closeTagModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                        </div>
                        <div class="mb-4">
                            <p class="text-sm text-gray-600">æª”æ¡ˆåç¨±: <span id="modal-node-name" class="font-bold text-gray-800"></span></p>
                        </div>
                        <div class="space-y-3 mb-6">
                            <label class="flex items-center p-3 border-2 border-red-200 rounded-lg hover:bg-red-50 cursor-pointer transition-colors">
                                <input type="checkbox" id="tag-Urgent" class="form-checkbox h-5 w-5 text-red-600 rounded">
                                <span class="ml-3 text-sm font-semibold text-red-700">ğŸ”´ Urgent (ç·Šæ€¥)</span>
                            </label>
                            <label class="flex items-center p-3 border-2 border-blue-200 rounded-lg hover:bg-blue-50 cursor-pointer transition-colors">
                                <input type="checkbox" id="tag-Work" class="form-checkbox h-5 w-5 text-blue-600 rounded">
                                <span class="ml-3 text-sm font-semibold text-blue-700">ğŸ”µ Work (å·¥ä½œ)</span>
                            </label>
                            <label class="flex items-center p-3 border-2 border-green-200 rounded-lg hover:bg-green-50 cursor-pointer transition-colors">
                                <input type="checkbox" id="tag-Personal" class="form-checkbox h-5 w-5 text-green-600 rounded">
                                <span class="ml-3 text-sm font-semibold text-green-700">ğŸŸ¢ Personal (å€‹äºº)</span>
                            </label>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="saveNodeTags()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                                ğŸ’¾ å„²å­˜
                            </button>
                            <button onclick="closeTagModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 font-bold py-2 px-4 rounded-lg transition-colors">
                                å–æ¶ˆ
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- 5. Java å¯¦ä½œ -->
        <div id="java" class="tab-content">
            <section class="space-y-6">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h2 class="text-2xl font-bold border-b-2 border-blue-500 pb-2 mb-6">5. Java å®Œæ•´å¯¦ä½œ</h2>
                    
                    <div class="mb-6 p-4 bg-gradient-to-r from-blue-50 to-green-50 rounded-lg border border-blue-200">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="font-bold text-blue-700 mb-1">ğŸ“¦ Visitor Pattern å®Œæ•´å¯¦ä½œ</h3>
                                <p class="text-sm text-gray-600">åŒ…å« 12 å€‹ Java æºæ–‡ä»¶ï¼Œé»æ“Šä¸‹è¼‰æŒ‰éˆ•ç²å–å®Œæ•´å°ˆæ¡ˆ</p>
                            </div>
                            <button onclick="downloadJavaProject()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 px-5 rounded-lg shadow-lg transition-all hover:shadow-xl hover:scale-105 flex items-center gap-2">
                                <span>ğŸ“¥</span> ä¸‹è¼‰å®Œæ•´å°ˆæ¡ˆ ZIP
                            </button>
                        </div>
                    </div>

                    <!-- Java ä»£ç¢¼ç€è¦½å™¨ -->
                    <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                        <div class="bg-gradient-to-r from-blue-600 to-blue-700 px-4 py-3">
                            <h3 class="text-white font-bold flex items-center gap-2">
                                <span>ğŸ’»</span> Java æºä»£ç¢¼ç€è¦½å™¨
                            </h3>
                        </div>
                        
                        <div class="flex" style="height: 600px;">
                            <!-- å·¦å´ï¼šæª”æ¡ˆæ¸…å–® -->
                            <div class="bg-gray-50 border-r border-gray-200 overflow-y-auto" style="min-width: 320px; width: 320px; flex-shrink: 0;">
                                <div class="p-3 bg-gray-100 border-b border-gray-200">
                                    <p class="text-xs text-gray-600 font-semibold">ğŸ“ FileSystemDemo/src/</p>
                                </div>
                                <div id="javaFileList" class="divide-y divide-gray-200">
                                    <!-- æª”æ¡ˆæ¸…å–®å°‡ç”± JavaScript ç”Ÿæˆ -->
                                </div>
                            </div>
                            
                            <!-- å³å´ï¼šä»£ç¢¼æª¢è¦– -->
                            <div class="flex-1 flex flex-col bg-white" style="min-width: 0;">
                                <div class="bg-gray-100 px-4 py-2 border-b border-gray-200 flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <span class="text-xs text-gray-500">ç•¶å‰æª”æ¡ˆï¼š</span>
                                        <span id="currentFileName" class="text-sm font-mono font-bold text-blue-600">SystemEntryComponent.java</span>
                                    </div>
                                    <button onclick="copyCurrentCode()" class="text-xs bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded transition-colors flex items-center gap-1">
                                        <span>ğŸ“‹</span> è¤‡è£½ä»£ç¢¼
                                    </button>
                                </div>
                                <div class="flex-1 overflow-auto bg-gray-900">
                                    <pre class="h-full m-0" style="background: #2d2d2d;"><code id="javaCodeView" class="language-java text-xs"></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- åŸæœ‰çš„å…¶ä»–å…§å®¹ä¿ç•™ä½†ç§»åˆ°ä¸‹æ–¹æˆ–éš±è— -->
                    <div class="space-y-4 hidden">
                        <div>
                            <h3 class="text-lg font-semibold text-blue-700 mb-2">ğŸ“„ æ ¸å¿ƒé¡åˆ¥</h3>
                            
                            <!-- SystemEntryComponent -->
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-4">
                                <h4 class="font-bold text-gray-700 mb-2">SystemEntryComponent.java</h4>
                                <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public abstract class SystemEntryComponent {
    protected String name;
    protected java.time.LocalDateTime created;
    protected long size;
    protected String attributes;
    
    public SystemEntryComponent(String name) {
        this.name = name;
        this.created = java.time.LocalDateTime.now();
        this.size = 0;
    }
    
    public abstract String getType();
    
    // å…¬é–‹æ–¹æ³•ï¼šå¤–éƒ¨èª¿ç”¨
    public void accept(IVisitor visitor) {
        accept(visitor, 0);
    }
    
    // å…§éƒ¨æ–¹æ³•ï¼šéè¿´ä½¿ç”¨
    abstract void accept(IVisitor visitor, int depth);
    
    public String getSizeDisplay() {
        if (size < 1024) return size + " B";
        return String.format("%.1f KB", size / 1024.0);
    }
    
    public String getName() { return name; }
    public long getSize() { return size; }
}</code></pre>
                            </div>

                            <!-- FileLeaf -->
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-4">
                                <h4 class="font-bold text-gray-700 mb-2">FileLeaf.java</h4>
                                <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public abstract class FileLeaf extends SystemEntryComponent {
    public FileLeaf(String name, long sizeBytes) {
        super(name);
        this.size = sizeBytes;
    }
    
    @Override
    void accept(IVisitor visitor, int depth) {
        visitor.visit(this, depth);
    }
}</code></pre>
                            </div>

                            <!-- DirectoryComposite -->
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-4">
                                <h4 class="font-bold text-gray-700 mb-2">DirectoryComposite.java</h4>
                                <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>import java.util.*;

public class DirectoryComposite extends SystemEntryComponent {
    private List&lt;SystemEntryComponent&gt; children = new ArrayList&lt;&gt;();
    
    public DirectoryComposite(String name) {
        super(name);
    }
    
    public void add(SystemEntryComponent child) {
        children.add(child);
    }
    
    public void remove(SystemEntryComponent child) {
        children.remove(child);
    }
    
    public List&lt;SystemEntryComponent&gt; getChildren() {
        return new ArrayList&lt;&gt;(children);
    }
    
    @Override
    public String getType() { return "ç›®éŒ„"; }
    
    @Override
    void accept(IVisitor visitor, int depth) {
        visitor.visit(this, depth);
        for (SystemEntryComponent child : children) {
            child.accept(visitor, depth + 1);
        }
    }
}</code></pre>
                            </div>

                            <!-- å…·é«”æ–‡ä»¶é¡å‹ -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-bold text-gray-700 mb-2">WordDocument.java</h4>
                                    <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public class WordDocument 
    extends FileLeaf {
    private int pages;
    
    public WordDocument(String name, 
        long size, int pages) {
        super(name, size);
        this.pages = pages;
    }
    
    @Override
    public String getType() { 
        return "Word æª”æ¡ˆ"; 
    }
    
    public int getPages() { 
        return pages; 
    }
}</code></pre>
                                </div>

                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-bold text-gray-700 mb-2">ImageFile.java</h4>
                                    <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public class ImageFile extends FileLeaf {
    private int width;
    private int height;
    
    public ImageFile(String name, 
        long size, int w, int h) {
        super(name, size);
        this.width = w;
        this.height = h;
    }
    
    @Override
    public String getType() { 
        return "åœ–ç‰‡"; 
    }
    
    public int getWidth() { 
        return width; 
    }
    public int getHeight() { 
        return height; 
    }
}</code></pre>
                                </div>

                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-bold text-gray-700 mb-2">TextFile.java</h4>
                                    <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public class TextFile extends FileLeaf {
    private String encoding;
    
    public TextFile(String name, 
        long size, String enc) {
        super(name, size);
        this.encoding = enc;
    }
    
    @Override
    public String getType() { 
        return "ç´”æ–‡å­—æª”"; 
    }
    
    public String getEncoding() { 
        return encoding; 
    }
}</code></pre>
                                </div>
                            </div>
                        </div>

                        <!-- Visitor æ¥å£èˆ‡å¯¦ç¾ -->
                        <div>
                            <h3 class="text-lg font-semibold text-blue-700 mb-2">ğŸ” Visitor æ¨¡å¼ - åƒæ•¸å‚³éè¨­è¨ˆ</h3>

                            <div class="mb-4 p-4 bg-green-50 rounded-lg border border-green-200">
                                <h4 class="font-bold text-green-700 mb-2">ğŸ’¡ è¨­è¨ˆåŸå‰‡ï¼šç„¡ç‹€æ…‹èˆ‡ç·šç¨‹å®‰å…¨</h4>
                                <p class="text-sm text-gray-700 mb-2">ä½¿ç”¨<strong>åƒæ•¸å‚³é depth</strong> è€Œéå…§éƒ¨ç‹€æ…‹ç®¡ç†ï¼Œå„ªé»åŒ…æ‹¬ï¼š</p>
                                <ul class="text-xs text-gray-600 list-disc list-inside space-y-1">
                                    <li>âœ… ç„¡ç‹€æ…‹è¨­è¨ˆï¼Œå¤©ç„¶ç·šç¨‹å®‰å…¨</li>
                                    <li>âœ… ä¸éœ€è¦ç®¡ç† increase/decreaseï¼Œé¿å…å¿˜è¨˜å‘¼å«çš„éŒ¯èª¤</li>
                                    <li>âœ… ç¨‹å¼ç¢¼ç°¡æ½”ï¼Œæ˜“æ–¼ç†è§£å’Œç¶­è­·</li>
                                    <li>âœ… depth åœ¨èª¿ç”¨æ£§ä¸­å‚³éï¼Œè‡ªå‹•ç®¡ç†ç”Ÿå‘½é€±æœŸ</li>
                                </ul>
                            </div>

                            <div class="mb-4">
                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-bold text-gray-700 mb-2">IVisitor.java</h4>
                                    <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public interface IVisitor {
    void visit(FileLeaf leaf, int depth);
    void visit(DirectoryComposite composite, int depth);
}</code></pre>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-bold text-gray-700 mb-2">SizeCalculatorVisitor.java</h4>
                                    <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public class SizeCalculatorVisitor 
    implements IVisitor {
    private long totalSize = 0;
    
    @Override
    public void visit(FileLeaf leaf, int depth) {
        totalSize += leaf.getSize();
        // depth åƒæ•¸åœ¨æ­¤ä¸ä½¿ç”¨ï¼Œä½†ä¿æŒç°½åä¸€è‡´
    }
    
    @Override
    public void visit(
        DirectoryComposite comp, int depth) {
        // éè¿´ç”± DirectoryComposite
        // çš„ accept æ–¹æ³•è™•ç†
    }
    
    public long getTotalSize() { 
        return totalSize; 
    }
}</code></pre>
                                </div>

                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-bold text-gray-700 mb-2">FileSearchVisitor.java</h4>
                                    <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>import java.util.*;

public class FileSearchVisitor 
    implements IVisitor {
    private String extension;
    private List&lt;FileLeaf&gt; results 
        = new ArrayList&lt;&gt;();
    
    public FileSearchVisitor(String ext) {
        this.extension = ext.toLowerCase();
    }
    
    @Override
    public void visit(FileLeaf leaf, int depth) {
        if (leaf.getName()
            .toLowerCase()
            .endsWith(extension)) {
            results.add(leaf);
        }
    }
    
    @Override
    public void visit(
        DirectoryComposite comp, int depth) {
        // ä¸éœ€è™•ç†
    }
    
    public List&lt;FileLeaf&gt; 
        getResults() { 
        return results; 
    }
}</code></pre>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-bold text-gray-700 mb-2">DisplayVisitor.java</h4>
                                    <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public class DisplayVisitor 
    implements DepthManagedVisitor {
    private StringBuilder output = 
        new StringBuilder();
    private int depth = 0;
    private boolean isRoot = true;
    
    @Override
    public void visit(FileLeaf leaf) {
        String indent = "  ".repeat(depth);
        output.append(indent).append("ğŸ“„ ")
              .append(leaf.getName())
              .append("\\n");
    }
    
    @Override
    public void visit(
        DirectoryComposite comp) {
        if (!isRoot) {
            String indent = 
                "  ".repeat(depth);
            output.append(indent)
                  .append("ğŸ“ ")
                  .append(comp.getName())
                  .append("\\n");
        }
        isRoot = false;
    }
    
    @Override
    public void increaseDepth() { 
        depth++; 
    }
    
    @Override
    public void decreaseDepth() { 
        if (depth > 0) depth--; 
    }
    
    public String getOutput() { 
        return output.toString(); 
    }
}</code></pre>
                                </div>

                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-bold text-gray-700 mb-2">XMLExportVisitor.java</h4>
                                    <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>import java.util.*;

public class XMLExportVisitor 
    implements DepthManagedVisitor {
    private StringBuilder xmlOutput = 
        new StringBuilder();
    private int depth = 0;
    private Stack&lt;String&gt; 
        pendingCloseTags = new Stack&lt;&gt;();
    
    @Override
    public void visit(FileLeaf leaf) {
        String indent = "  ".repeat(depth);
        xmlOutput.append(indent)
                 .append("&lt;").append(leaf
                 .getName()).append("&gt;")
                 .append("&lt;/").append(leaf
                 .getName()).append("&gt;\\n");
    }
    
    @Override
    public void visit(
        DirectoryComposite comp) {
        String indent = "  ".repeat(depth);
        xmlOutput.append(indent)
                 .append("&lt;").append(comp
                 .getName()).append("&gt;\\n");
        pendingCloseTags.push(comp
            .getName());
    }
    
    @Override
    public void increaseDepth() { 
        depth++; 
    }
    
    @Override
    public void decreaseDepth() {
        if (depth > 0) {
            depth--;
            if (!pendingCloseTags
                .isEmpty()) {
                String tagName = 
                    pendingCloseTags.pop();
                String indent = 
                    "  ".repeat(depth);
                xmlOutput.append(indent)
                    .append("&lt;/")
                    .append(tagName)
                    .append("&gt;\\n");
            }
        }
    }
    
    public String getXMLOutput() { 
        return xmlOutput.toString(); 
    }
}</code></pre>
                                </div>
                            </div>
                        </div>

                        <!-- Main Demo -->
                        <div>
                            <h3 class="text-lg font-semibold text-blue-700 mb-2">â–¶ï¸ ä½¿ç”¨ç¯„ä¾‹</h3>
                            
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                <h4 class="font-bold text-gray-700 mb-2">FileSystemDemo.java</h4>
                                <pre class="text-xs bg-white p-2 rounded border border-gray-100 overflow-x-auto"><code>public class FileSystemDemo {
    public static void main(String[] args) {
        // å»ºç«‹æ ¹ç›®éŒ„
        DirectoryComposite root = 
            new DirectoryComposite("æ ¹ç›®éŒ„");
        
        // å»ºç«‹å­ç›®éŒ„
        DirectoryComposite project = 
            new DirectoryComposite("å°ˆæ¡ˆæ–‡ä»¶");
        project.add(new WordDocument(
            "éœ€æ±‚è¦æ ¼æ›¸.docx", 500*1024, 15));
        project.add(new ImageFile(
            "æ¶æ§‹åœ–.png", 2*1024*1024, 1920, 1080));
        
        DirectoryComposite personal = 
            new DirectoryComposite("å€‹äººç­†è¨˜");
        personal.add(new TextFile(
            "å¾…è¾¦æ¸…å–®.txt", 1024, "UTF-8"));
        
        // çµ„åˆ
        root.add(project);
        root.add(personal);
        root.add(new TextFile(
            "README.txt", 500, "ASCII"));
        
        // æ¸¬è©¦ Visitor
        System.out.println("=== è¨ˆç®—ç¸½å¤§å° ===");
        SizeCalculatorVisitor sizeVisitor = 
            new SizeCalculatorVisitor();
        root.accept(sizeVisitor);  // ç°¡æ½”ï¼
        System.out.println("ç¸½å¤§å°: " + 
            sizeVisitor.getTotalSize() + " Bytes");
        
        System.out.println("\n=== æœå°‹ .docx æª”æ¡ˆ ===");
        FileSearchVisitor searchVisitor = 
            new FileSearchVisitor(".docx");
        root.accept(searchVisitor);  // ç°¡æ½”ï¼
        for (FileLeaf file : 
            searchVisitor.getResults()) {
            System.out.println("æ‰¾åˆ°: " + 
                file.getName());
        }
    }
}</code></pre>
                            </div>
                        </div>
                    </div>

                    <!-- ç·¨è­¯å’Œé‹è¡Œèªªæ˜ -->
                    <div class="mt-6 p-4 bg-purple-50 rounded-lg border border-purple-200">
                        <h3 class="font-bold text-purple-700 mb-3">ğŸš€ ç·¨è­¯èˆ‡é‹è¡Œ</h3>
                        
                        <!-- Windows ç³»çµ± -->
                        <div class="mb-4">
                            <h4 class="font-bold text-blue-700 mb-2 flex items-center gap-2">
                                <span>ğŸªŸ</span> Windows ç³»çµ±
                            </h4>
                            <pre class="text-xs bg-white p-3 rounded border border-purple-100 overflow-x-auto"><code><span class="text-gray-500"># æ–¹æ³•ä¸€ï¼šä½¿ç”¨è¬ç”¨å­—å…ƒç·¨è­¯ï¼ˆæ¨è–¦ï¼‰</span>
<span class="text-green-600">cd</span> C:\Users\YourName\Desktop\FileSystemDemo
<span class="text-green-600">javac</span> -d bin -encoding UTF-8 src\core\*.java src\files\*.java src\visitor\*.java src\FileSystemDemo.java
<span class="text-green-600">java</span> -cp bin FileSystemDemo

<span class="text-gray-500"># æ–¹æ³•äºŒï¼šé€å€‹ç·¨è­¯ï¼ˆé©åˆå°å°ˆæ¡ˆï¼‰</span>
<span class="text-green-600">javac</span> -d bin -encoding UTF-8 src\core\SystemEntryComponent.java src\core\FileLeaf.java src\core\DirectoryComposite.java
<span class="text-green-600">javac</span> -d bin -encoding UTF-8 -cp bin src\files\*.java
<span class="text-green-600">javac</span> -d bin -encoding UTF-8 -cp bin src\visitor\*.java
<span class="text-green-600">javac</span> -d bin -encoding UTF-8 -cp bin src\FileSystemDemo.java
<span class="text-green-600">java</span> -cp bin FileSystemDemo

<span class="text-gray-500"># æ–¹æ³•ä¸‰ï¼šä½¿ç”¨æª”æ¡ˆæ¸…å–®ï¼ˆé©åˆå¤§å‹å°ˆæ¡ˆï¼‰</span>
<span class="text-green-600">dir</span> /s /B *.java > sources.txt
<span class="text-green-600">javac</span> -d bin -encoding UTF-8 @sources.txt
<span class="text-green-600">java</span> -cp bin FileSystemDemo</code></pre>
                            <div class="mt-2 p-2 bg-blue-50 rounded text-xs">
                                <p class="font-semibold text-blue-800 mb-1">ğŸ’¡ Windows æ³¨æ„äº‹é …ï¼š</p>
                                <ul class="text-gray-700 list-disc list-inside space-y-1">
                                    <li>ä½¿ç”¨åæ–œç·š <code class="bg-white px-1 rounded">\</code> ä½œç‚ºè·¯å¾‘åˆ†éš”ç¬¦</li>
                                    <li>å»ºè­°åŠ ä¸Š <code class="bg-white px-1 rounded">-encoding UTF-8</code> é¿å…ä¸­æ–‡äº‚ç¢¼</li>
                                    <li>å¦‚é‡åˆ°ã€Œæ‰¾ä¸åˆ°æˆ–ç„¡æ³•è¼‰å…¥ä¸»é¡åˆ¥ã€ï¼Œæª¢æŸ¥ CLASSPATH è¨­å®š</li>
                                    <li>ç¢ºèªå·²å®‰è£ JDKï¼ˆä¸åªæ˜¯ JREï¼‰ï¼Œå¯ç”¨ <code class="bg-white px-1 rounded">java -version</code> å’Œ <code class="bg-white px-1 rounded">javac -version</code> æª¢æŸ¥</li>
                                </ul>
                            </div>
                        </div>

                        <!-- macOS/Linux ç³»çµ± -->
                        <div>
                            <h4 class="font-bold text-green-700 mb-2 flex items-center gap-2">
                                <span>ğŸ</span> macOS / Linux ç³»çµ±
                            </h4>
                            <pre class="text-xs bg-white p-3 rounded border border-purple-100 overflow-x-auto"><code><span class="text-gray-500"># æ–¹æ³•ä¸€ï¼šä½¿ç”¨è¬ç”¨å­—å…ƒç·¨è­¯ï¼ˆæ¨è–¦ï¼‰</span>
<span class="text-green-600">cd</span> ~/Desktop/FileSystemDemo
<span class="text-green-600">javac</span> -d bin -encoding UTF-8 src/core/*.java src/files/*.java src/visitor/*.java src/FileSystemDemo.java
<span class="text-green-600">java</span> -cp bin FileSystemDemo

<span class="text-gray-500"># æ–¹æ³•äºŒï¼šä½¿ç”¨ find å‘½ä»¤ï¼ˆé©åˆè¤‡é›œå°ˆæ¡ˆçµæ§‹ï¼‰</span>
<span class="text-green-600">mkdir</span> -p bin
<span class="text-green-600">find</span> src -name "*.java" -print | xargs javac -d bin -encoding UTF-8
<span class="text-green-600">java</span> -cp bin FileSystemDemo

<span class="text-gray-500"># æ–¹æ³•ä¸‰ï¼šä¸€è¡Œå‘½ä»¤å¿«é€Ÿç·¨è­¯åŸ·è¡Œ</span>
<span class="text-green-600">javac</span> -d bin src/**/*.java src/*.java && java -cp bin FileSystemDemo

<span class="text-gray-500"># æ¸…ç†ç·¨è­¯æª”æ¡ˆ</span>
<span class="text-green-600">rm</span> -rf bin/*.class bin/*/*.class</code></pre>
                            <div class="mt-2 p-2 bg-green-50 rounded text-xs">
                                <p class="font-semibold text-green-800 mb-1">ğŸ’¡ macOS/Linux æ³¨æ„äº‹é …ï¼š</p>
                                <ul class="text-gray-700 list-disc list-inside space-y-1">
                                    <li>ä½¿ç”¨æ­£æ–œç·š <code class="bg-white px-1 rounded">/</code> ä½œç‚ºè·¯å¾‘åˆ†éš”ç¬¦</li>
                                    <li>å¯ä½¿ç”¨ <code class="bg-white px-1 rounded">**</code> éè¿´åŒ¹é…æ‰€æœ‰å­ç›®éŒ„ï¼ˆéœ€ Bash 4.0+ï¼‰</li>
                                    <li>macOS éœ€å…ˆå®‰è£ JDKï¼š<code class="bg-white px-1 rounded">brew install openjdk</code></li>
                                    <li>Linux å¯ç”¨å¥—ä»¶ç®¡ç†å™¨ï¼š<code class="bg-white px-1 rounded">sudo apt install default-jdk</code>ï¼ˆUbuntu/Debianï¼‰</li>
                                </ul>
                            </div>
                        </div>

                        <!-- é æœŸè¼¸å‡º -->
                        <div class="mt-4 p-3 bg-gray-800 text-green-400 rounded border border-gray-700">
                            <p class="text-xs font-bold text-gray-300 mb-2">âœ… é æœŸè¼¸å‡ºçµæœï¼š</p>
                            <pre class="text-xs"><code>=== è¨ˆç®—ç¸½å¤§å° ===
ç¸½å¤§å°: 2503524 Bytes (2.4 MB)

=== æœå°‹ .docx æª”æ¡ˆ ===
å…±æ‰¾åˆ° 2 å€‹æª”æ¡ˆ:
- éœ€æ±‚è¦æ ¼æ›¸.docx (500.0 KB)
- èˆŠæœƒè­°è¨˜éŒ„.docx (200.0 KB)

=== é¡¯ç¤ºæ¨¹ç‹€çµæ§‹ ===
ğŸ“ æ ¹ç›®éŒ„(Root)
  ğŸ“ å°ˆæ¡ˆæ–‡ä»¶ (Project_Docs)
    ğŸ“„ éœ€æ±‚è¦æ ¼æ›¸.docx (Word, 15p, 500.0 KB)
    ğŸ–¼ï¸ ç³»çµ±æ¶æ§‹åœ–.png (Img, 1920x1080, 2.0 MB)
  ğŸ“ å€‹äººç­†è¨˜ (Personal_Notes)
    ğŸ“„ å¾…è¾¦æ¸…å–®.txt (Txt, UTF-8, 1.0 KB)
    ğŸ“ 2025å‚™ä»½ (Archive_2025)
      ğŸ“„ èˆŠæœƒè­°è¨˜éŒ„.docx (Word, 5p, 200.0 KB)
  ğŸ“„ README.txt (Txt, ASCII, 500 B)</code></pre>
                        </div>
                    </div>

                    <!-- å­¸ç¿’é‡é» -->
                    <div class="mt-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                        <h3 class="font-bold text-yellow-700 mb-3">ğŸ’¡ Visitor Pattern å­¸ç¿’é‡é»</h3>
                        <ul class="text-sm text-gray-700 list-disc list-inside space-y-2">
                            <li><strong>é›™é‡åˆ†æ´¾</strong>ï¼švisitor.visit(this, depth) æ ¹æ“š this çš„å…·é«”é¡å‹æ±ºå®šèª¿ç”¨çš„æ–¹æ³•</li>
                            <li><strong>é–‹æ”¾å°é–‰åŸå‰‡</strong>ï¼šæ–°å¢æ“ä½œä¸éœ€ä¿®æ”¹ç¾æœ‰é¡åˆ¥ï¼Œåªéœ€æ–°å¢ Visitor</li>
                            <li><strong>æ–¹æ³•é‡è¼‰è¨­è¨ˆ</strong>ï¼šå¤–éƒ¨ API ç°¡æ½”ï¼ˆaccept(visitor)ï¼‰ï¼Œå…§éƒ¨åƒæ•¸å‚³éç„¡ç‹€æ…‹</li>
                            <li><strong>åˆ†é›¢é—œæ³¨é»</strong>ï¼šè³‡æ–™çµæ§‹èˆ‡ç®—æ³•é‚è¼¯å®Œå…¨åˆ†é›¢ï¼Œå„å¸å…¶è·</li>
                            <li><strong>æ˜“æ–¼æ“´å±•</strong>ï¼šè¦æ–°å¢æª”æ¡ˆçµ±è¨ˆã€å‚™ä»½ã€é©—è­‰ç­‰åŠŸèƒ½ï¼Œåªéœ€æ–°å¢ç›¸æ‡‰çš„ Visitor</li>
                        </ul>
                    </div>
                </div>
            </section>
        </div>

        <!-- 6. å¦‚ä½•é¸æ“‡è¨­è¨ˆæ¨¡å¼ -->
        <div id="guide" class="tab-content">
            <section class="space-y-6">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">ğŸ§­ å¦‚ä½•é¸æ“‡æ­£ç¢ºçš„è¨­è¨ˆæ¨¡å¼ï¼Ÿ</h2>
                    <p class="text-gray-500 text-sm">é¢å°ä¸€å€‹å•é¡Œæ™‚ï¼Œä¸æ˜¯å…ˆæƒ³ã€Œé€™æ˜¯å“ªå€‹ Patternã€ï¼Œè€Œæ˜¯å…ˆå•è‡ªå·±å¹¾å€‹å•é¡Œã€‚</p>
                </div>

                <!-- Step 1: å•è‡ªå·±çš„å•é¡Œ -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-lg font-bold text-blue-700 mb-4">ğŸ” Step 1ï¼šå…ˆå•è‡ªå·±é€™äº›å•é¡Œ</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <div class="text-2xl mb-2">ğŸ—ï¸</div>
                            <h4 class="font-bold text-blue-700 mb-1">æˆ‘åœ¨ç…©æƒ±ã€Œå¦‚ä½•å»ºç«‹ç‰©ä»¶ã€ï¼Ÿ</h4>
                            <p class="text-xs text-gray-600">ç‰©ä»¶å»ºç«‹å¤ªè¤‡é›œã€æƒ³é›†ä¸­ç®¡ç†ã€æƒ³éš±è—å¯¦ä½œç´°ç¯€ï¼Ÿ</p>
                            <div class="mt-2 text-xs font-bold text-blue-600">â†’ è€ƒæ…® Creational Pattern</div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                            <div class="text-2xl mb-2">ğŸ”—</div>
                            <h4 class="font-bold text-green-700 mb-1">æˆ‘åœ¨ç…©æƒ±ã€Œå¦‚ä½•çµ„åˆçµæ§‹ã€ï¼Ÿ</h4>
                            <p class="text-xs text-gray-600">é¡åˆ¥é—œä¿‚å¤ªè¤‡é›œã€æƒ³çµ±ä¸€ä»‹é¢ã€æƒ³éˆæ´»çµ„åˆåŠŸèƒ½ï¼Ÿ</p>
                            <div class="mt-2 text-xs font-bold text-green-600">â†’ è€ƒæ…® Structural Pattern</div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                            <div class="text-2xl mb-2">âš¡</div>
                            <h4 class="font-bold text-purple-700 mb-1">æˆ‘åœ¨ç…©æƒ±ã€Œå¦‚ä½•å”èª¿è¡Œç‚ºã€ï¼Ÿ</h4>
                            <p class="text-xs text-gray-600">ç‰©ä»¶äº’å‹•å¤ªè€¦åˆã€æƒ³åˆ†é›¢è²¬ä»»ã€æƒ³å‹•æ…‹åˆ‡æ›æ¼”ç®—æ³•ï¼Ÿ</p>
                            <div class="mt-2 text-xs font-bold text-purple-600">â†’ è€ƒæ…® Behavioral Pattern</div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: æ±ºç­–æµç¨‹ -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-lg font-bold text-blue-700 mb-4">ğŸŒ³ Step 2ï¼šä¾å•é¡Œæƒ…å¢ƒå°æ‡‰æ¨¡å¼</h3>

                    <!-- Creational -->
                    <div class="mb-6">
                        <h4 class="font-bold text-blue-600 mb-3 flex items-center gap-2"><span class="bg-blue-100 text-blue-700 px-2 py-0.5 rounded text-sm">Creational å»ºç«‹å‹</span> å¦‚ä½•å»ºç«‹ç‰©ä»¶ï¼Ÿ</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm border-collapse">
                                <thead>
                                    <tr class="bg-blue-50">
                                        <th class="border border-blue-200 px-3 py-2 text-left text-blue-700">æƒ…å¢ƒå•é¡Œ</th>
                                        <th class="border border-blue-200 px-3 py-2 text-left text-blue-700">æ¨¡å¼</th>
                                        <th class="border border-blue-200 px-3 py-2 text-left text-blue-700">ç¯„ä¾‹</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="hover:bg-blue-50">
                                        <td class="border border-gray-200 px-3 py-2">ç‰©ä»¶å»ºç«‹é‚è¼¯å¾ˆè¤‡é›œï¼Œæƒ³éš±è—ç´°ç¯€</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-blue-600">Factory Method</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500">æ ¹æ“šå‰¯æª”åå»ºç«‹ WordFile / ImageFile</td>
                                    </tr>
                                    <tr class="hover:bg-blue-50">
                                        <td class="border border-gray-200 px-3 py-2">æœ‰å¤šå€‹ç›¸é—œç‰©ä»¶æ—ç¾¤ï¼Œæƒ³ä¸€èµ·åˆ‡æ›</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-blue-600">Abstract Factory</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500">Windows UI å…ƒä»¶ / Mac UI å…ƒä»¶</td>
                                    </tr>
                                    <tr class="hover:bg-blue-50">
                                        <td class="border border-gray-200 px-3 py-2">å…¨ç³»çµ±åªéœ€ä¸€å€‹å¯¦ä¾‹ï¼ˆå…±ç”¨è³‡æºï¼‰</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-blue-600">Singleton</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500">Loggerã€è¨­å®šæª”ç®¡ç†å™¨</td>
                                    </tr>
                                    <tr class="hover:bg-blue-50">
                                        <td class="border border-gray-200 px-3 py-2">ç‰©ä»¶å»ºç«‹æ­¥é©Ÿè¤‡é›œï¼Œæœ‰é †åºæ€§</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-blue-600">Builder</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500">å»ºç«‹ SQL Queryã€HTTP Request</td>
                                    </tr>
                                    <tr class="hover:bg-blue-50">
                                        <td class="border border-gray-200 px-3 py-2">æƒ³è¤‡è£½ç¾æœ‰ç‰©ä»¶ï¼ˆé¿å…é‡æ–°å»ºç«‹ï¼‰</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-blue-600">Prototype</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500"><span class="bg-yellow-100 text-yellow-700 px-1 rounded text-xs">æœ¬ç³»çµ±</span> HistoryManager.cloneNode() æ·±åº¦è¤‡è£½</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Structural -->
                    <div class="mb-6">
                        <h4 class="font-bold text-green-600 mb-3 flex items-center gap-2"><span class="bg-green-100 text-green-700 px-2 py-0.5 rounded text-sm">Structural çµæ§‹å‹</span> å¦‚ä½•çµ„åˆé¡åˆ¥ï¼Ÿ</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm border-collapse">
                                <thead>
                                    <tr class="bg-green-50">
                                        <th class="border border-green-200 px-3 py-2 text-left text-green-700">æƒ…å¢ƒå•é¡Œ</th>
                                        <th class="border border-green-200 px-3 py-2 text-left text-green-700">æ¨¡å¼</th>
                                        <th class="border border-green-200 px-3 py-2 text-left text-green-700">ç¯„ä¾‹</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="hover:bg-green-50">
                                        <td class="border border-gray-200 px-3 py-2">æ¨¹ç‹€çµæ§‹ï¼Œå–®ä¸€ç‰©ä»¶èˆ‡ç¾¤çµ„è¦çµ±ä¸€æ“ä½œ</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-green-600">Composite</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500"><span class="bg-yellow-100 text-yellow-700 px-1 rounded text-xs">æœ¬ç³»çµ±</span> FileLeaf / DirectoryComposite</td>
                                    </tr>
                                    <tr class="hover:bg-green-50">
                                        <td class="border border-gray-200 px-3 py-2">æƒ³å‹•æ…‹ç‚ºç‰©ä»¶æ–°å¢åŠŸèƒ½ï¼Œä¸ç”¨ç¹¼æ‰¿</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-green-600">Decorator</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500">ç‚ºæª”æ¡ˆåŠ æ¨™ç±¤ã€ç‚ºæ–‡å­—åŠ åº•ç·š/ç²—é«”</td>
                                    </tr>
                                    <tr class="hover:bg-green-50">
                                        <td class="border border-gray-200 px-3 py-2">å…©å€‹ä¸ç›¸å®¹çš„ä»‹é¢éœ€è¦åˆä½œ</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-green-600">Adapter</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500">èˆŠç‰ˆ API åŒ…è£æˆæ–°ç‰ˆä»‹é¢</td>
                                    </tr>
                                    <tr class="hover:bg-green-50">
                                        <td class="border border-gray-200 px-3 py-2">æƒ³ç°¡åŒ–è¤‡é›œå­ç³»çµ±çš„ä½¿ç”¨ä»‹é¢</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-green-600">Facade</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500">å°è£è¤‡é›œçš„ç¬¬ä¸‰æ–¹ Library</td>
                                    </tr>
                                    <tr class="hover:bg-green-50">
                                        <td class="border border-gray-200 px-3 py-2">å¤§é‡ç›¸ä¼¼ç‰©ä»¶ä½”ç”¨å¤ªå¤šè¨˜æ†¶é«”</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-green-600">Flyweight</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500">éŠæˆ²åœ°åœ–ä¸­å¤§é‡é‡è¤‡çš„æ¨¹æœ¨/ç£šå¡Š</td>
                                    </tr>
                                    <tr class="hover:bg-green-50">
                                        <td class="border border-gray-200 px-3 py-2">æ§åˆ¶ç‰©ä»¶å­˜å–ã€å»¶é²è¼‰å…¥æˆ–åŠ å…¥å¿«å–</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-green-600">Proxy</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500">åœ–ç‰‡å»¶é²è¼‰å…¥ã€å­˜å–æ¬Šé™æ§ç®¡</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Behavioral -->
                    <div>
                        <h4 class="font-bold text-purple-600 mb-3 flex items-center gap-2"><span class="bg-purple-100 text-purple-700 px-2 py-0.5 rounded text-sm">Behavioral è¡Œç‚ºå‹</span> å¦‚ä½•å”èª¿ç‰©ä»¶äº’å‹•ï¼Ÿ</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm border-collapse">
                                <thead>
                                    <tr class="bg-purple-50">
                                        <th class="border border-purple-200 px-3 py-2 text-left text-purple-700">æƒ…å¢ƒå•é¡Œ</th>
                                        <th class="border border-purple-200 px-3 py-2 text-left text-purple-700">æ¨¡å¼</th>
                                        <th class="border border-purple-200 px-3 py-2 text-left text-purple-700">ç¯„ä¾‹</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="hover:bg-purple-50">
                                        <td class="border border-gray-200 px-3 py-2">è¦å°çµæ§‹ä¸­æ¯å€‹å…ƒç´ åŸ·è¡Œä¸åŒæ“ä½œï¼Œä¸”å…ƒç´ ç¨®é¡å¤š</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-purple-600">Visitor</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500"><span class="bg-yellow-100 text-yellow-700 px-1 rounded text-xs">æœ¬ç³»çµ±</span> SizeCalculator / XMLExport</td>
                                    </tr>
                                    <tr class="hover:bg-purple-50">
                                        <td class="border border-gray-200 px-3 py-2">éœ€è¦ Undo / Redoã€æ“ä½œè¨˜éŒ„</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-purple-600">Memento</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500"><span class="bg-yellow-100 text-yellow-700 px-1 rounded text-xs">æœ¬ç³»çµ±</span> HistoryManager undoStack</td>
                                    </tr>
                                    <tr class="hover:bg-purple-50">
                                        <td class="border border-gray-200 px-3 py-2">ä¸€å€‹äº‹ä»¶ç™¼ç”Ÿï¼Œå¤šå€‹ç‰©ä»¶éœ€è¦è¢«é€šçŸ¥</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-purple-600">Observer</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500">UI ç‹€æ…‹è®Šæ›´é€šçŸ¥ã€event listener</td>
                                    </tr>
                                    <tr class="hover:bg-purple-50">
                                        <td class="border border-gray-200 px-3 py-2">æ¼”ç®—æ³•æœ‰å¤šç¨®è®Šé«”ï¼Œæƒ³å‹•æ…‹åˆ‡æ›</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-purple-600">Strategy</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500"><span class="bg-yellow-100 text-yellow-700 px-1 rounded text-xs">æœ¬ç³»çµ±</span> sortChildren ä¾åç¨±/å¤§å°/å‰¯æª”å</td>
                                    </tr>
                                    <tr class="hover:bg-purple-50">
                                        <td class="border border-gray-200 px-3 py-2">æµç¨‹éª¨æ¶å›ºå®šï¼Œä½†æŸäº›æ­¥é©Ÿéœ€å®¢è£½åŒ–</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-purple-600">Template Method</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500">å ±è¡¨ç”Ÿæˆæµç¨‹ï¼šå–è³‡æ–™â†’æ ¼å¼åŒ–â†’è¼¸å‡º</td>
                                    </tr>
                                    <tr class="hover:bg-purple-50">
                                        <td class="border border-gray-200 px-3 py-2">ç‰©ä»¶ç‹€æ…‹æ”¹è®Šæ™‚ï¼Œè¡Œç‚ºä¹Ÿè¦è·Ÿè‘—æ”¹è®Š</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-purple-600">State</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500">è¨‚å–®ç‹€æ…‹ï¼šå¾…ä»˜æ¬¾â†’å·²ä»˜æ¬¾â†’å·²å‡ºè²¨</td>
                                    </tr>
                                    <tr class="hover:bg-purple-50">
                                        <td class="border border-gray-200 px-3 py-2">è«‹æ±‚éœ€è¦ä¾åºç¶“éå¤šå€‹è™•ç†è€…</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-purple-600">Chain of Responsibility</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500">HTTP middlewareã€æ¬Šé™å¯©æ ¸æµç¨‹</td>
                                    </tr>
                                    <tr class="hover:bg-purple-50">
                                        <td class="border border-gray-200 px-3 py-2">éæ­·é›†åˆè€Œä¸æš´éœ²å…§éƒ¨çµæ§‹</td>
                                        <td class="border border-gray-200 px-3 py-2 font-bold text-purple-600">Iterator</td>
                                        <td class="border border-gray-200 px-3 py-2 text-gray-500">for...ofã€Java Iterator</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Step 3: æœ¬ç³»çµ±çš„é¸æ“‡ç†ç”± -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-lg font-bold text-blue-700 mb-4">ğŸ’¡ Step 3ï¼šæœ¬æª”æ¡ˆç³»çµ±ç‚ºä½•é¸é€™äº›æ¨¡å¼ï¼Ÿ</h3>
                    <div class="space-y-4">

                        <div class="flex gap-4 p-4 bg-green-50 rounded-lg border border-green-200">
                            <div class="text-3xl">ğŸŒ²</div>
                            <div>
                                <div class="font-bold text-green-700">Composite â€” å› ç‚ºè³‡æ–™çµæ§‹æ˜¯æ¨¹ç‹€</div>
                                <p class="text-sm text-gray-600 mt-1">è³‡æ–™å¤¾å¯ä»¥åŒ…å«æª”æ¡ˆï¼Œä¹Ÿå¯ä»¥åŒ…å«è³‡æ–™å¤¾ã€‚éœ€è¦å°å–®ä¸€æª”æ¡ˆå’Œæ•´å€‹è³‡æ–™å¤¾åŸ·è¡Œç›¸åŒæ“ä½œï¼ˆå¦‚è¨ˆç®—å¤§å°ï¼‰ï¼Œ<strong>Composite</strong> è®“å…©è€…çµ±ä¸€ä»‹é¢ã€‚</p>
                                <div class="mt-2 text-xs text-gray-400">å•è‡ªå·±ï¼šã€Œæˆ‘çš„è³‡æ–™æ˜¯æ¨¹ç‹€çš„å—ï¼Ÿã€â†’ Yes â†’ è€ƒæ…® Composite</div>
                            </div>
                        </div>

                        <div class="flex gap-4 p-4 bg-purple-50 rounded-lg border border-purple-200">
                            <div class="text-3xl">ğŸ‘ï¸</div>
                            <div>
                                <div class="font-bold text-purple-700">Visitor â€” å› ç‚ºæ“ä½œç¨®é¡æœƒæŒçºŒå¢åŠ </div>
                                <p class="text-sm text-gray-600 mt-1">è¨ˆç®—å¤§å°ã€æœå°‹ã€é¡¯ç¤ºæ¨¹ç‹€ã€XML åŒ¯å‡º... é€™äº›æ“ä½œæœªä¾†é‚„æœƒç¹¼çºŒå¢åŠ ã€‚å¦‚æœæ¯å€‹æ“ä½œéƒ½å¯«é€² FileLeaf / DirectoryCompositeï¼Œé¡åˆ¥æœƒè¶Šä¾†è¶Šé¾å¤§ã€‚<strong>Visitor</strong> è®“æ–°æ“ä½œç¨ç«‹æˆé¡åˆ¥ï¼Œä¸æ”¹å‹•åŸæœ‰ç¨‹å¼ç¢¼ã€‚</p>
                                <div class="mt-2 text-xs text-gray-400">å•è‡ªå·±ï¼šã€Œæˆ‘æœƒä¸€ç›´æ–°å¢å°è³‡æ–™çµæ§‹çš„æ“ä½œå—ï¼Ÿã€â†’ Yes â†’ è€ƒæ…® Visitor</div>
                            </div>
                        </div>

                        <div class="flex gap-4 p-4 bg-amber-50 rounded-lg border border-amber-200">
                            <div class="text-3xl">âª</div>
                            <div>
                                <div class="font-bold text-amber-700">Memento â€” å› ç‚ºéœ€è¦ Undo / Redo</div>
                                <p class="text-sm text-gray-600 mt-1">ä½¿ç”¨è€…éœ€è¦èƒ½æ’¤éŠ·æ“ä½œã€‚<strong>Memento</strong> åœ¨æ¯æ¬¡æ“ä½œå‰å„²å­˜å®Œæ•´å¿«ç…§ï¼Œä¸éœ€è¦äº†è§£å…§éƒ¨ç‹€æ…‹å°±èƒ½é‚„åŸã€‚ä»£åƒ¹æ˜¯è¨˜æ†¶é«”ç©ºé–“ã€‚</p>
                                <div class="mt-2 text-xs text-gray-400">å•è‡ªå·±ï¼šã€Œä½¿ç”¨è€…éœ€è¦æ’¤éŠ·å—ï¼Ÿã€â†’ Yes â†’ è€ƒæ…® Memento æˆ– Command</div>
                            </div>
                        </div>

                        <div class="flex gap-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                            <div class="text-3xl">ğŸ”€</div>
                            <div>
                                <div class="font-bold text-blue-700">Strategyï¼ˆæ’åºï¼‰â€” å› ç‚ºæ’åºè¦å‰‡å¯ä»¥åˆ‡æ›</div>
                                <p class="text-sm text-gray-600 mt-1">ä¾åç¨±ã€ä¾å¤§å°ã€ä¾å‰¯æª”åæ’åºæ˜¯ä¸‰ç¨®ä¸åŒæ¼”ç®—æ³•ã€‚ç”¨ <strong>Strategy</strong> æ¦‚å¿µè®“ <code class="bg-white px-1 rounded text-xs">sortBy</code> åƒæ•¸å‹•æ…‹æ±ºå®šæ¯”è¼ƒé‚è¼¯ï¼Œç„¡éœ€ if/else åˆ°è™•æ•£è½ã€‚</p>
                                <div class="mt-2 text-xs text-gray-400">å•è‡ªå·±ï¼šã€ŒåŒä¸€ä»¶äº‹æœ‰å¤šç¨®åšæ³•ï¼Œæƒ³å‹•æ…‹åˆ‡æ›ï¼Ÿã€â†’ Yes â†’ è€ƒæ…® Strategy</div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Step 4: å¸¸è¦‹èª¤å€ -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-lg font-bold text-red-600 mb-4">âš ï¸ å¸¸è¦‹èª¤å€ï¼šä¸è¦é€™æ¨£é¸æ¨¡å¼</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="p-4 bg-red-50 rounded-lg border border-red-200">
                            <div class="font-bold text-red-700 mb-1">âŒ å…ˆé¸æ¨¡å¼ï¼Œå†å¥—å•é¡Œ</div>
                            <p class="text-xs text-gray-600">ã€Œæˆ‘è¦ç”¨ Singletonï¼ã€â†’ ç„¶å¾Œç¡¬å¥—ã€‚æ‡‰è©²æ˜¯å…ˆæè¿°å•é¡Œï¼Œå†æ‰¾åŒ¹é…çš„æ¨¡å¼ã€‚</p>
                        </div>
                        <div class="p-4 bg-red-50 rounded-lg border border-red-200">
                            <div class="font-bold text-red-700 mb-1">âŒ æŠŠæ‰€æœ‰æ¨¡å¼éƒ½ç”¨ä¸Š</div>
                            <p class="text-xs text-gray-600">æ¨¡å¼è¶Šå¤šä¸ä»£è¡¨è¨­è¨ˆè¶Šå¥½ã€‚æ¯å€‹æ¨¡å¼éƒ½å¢åŠ æŠ½è±¡å±¤ï¼Œå°å°ˆæ¡ˆéåº¦è¨­è¨ˆåè€Œé›£ä»¥ç¶­è­·ã€‚</p>
                        </div>
                        <div class="p-4 bg-red-50 rounded-lg border border-red-200">
                            <div class="font-bold text-red-700 mb-1">âŒ åªçœ‹æ¨¡å¼åç¨±ï¼Œä¸çœ‹å•é¡Œæƒ…å¢ƒ</div>
                            <p class="text-xs text-gray-600">Visitor å’Œ Iterator éƒ½èƒ½éæ­·é›†åˆï¼Œä½†ç›®çš„ä¸åŒã€‚è¦ç†è§£ã€Œè§£æ±ºä»€éº¼å•é¡Œã€ï¼Œä¸æ˜¯ã€Œé•·ä»€éº¼æ¨£å­ã€ã€‚</p>
                        </div>
                        <div class="p-4 bg-red-50 rounded-lg border border-red-200">
                            <div class="font-bold text-red-700 mb-1">âŒ éæ—©å¼•å…¥æ¨¡å¼</div>
                            <p class="text-xs text-gray-600">å…ˆå¯«ç›´è§€çš„ç¨‹å¼ç¢¼ã€‚ç•¶ä½ ç™¼ç¾ã€Œé€™æ®µç¨‹å¼ä¸€ç›´åœ¨é‡è¤‡ã€æˆ–ã€Œé€™é‚Šå¾ˆé›£æ“´å±•ã€æ™‚ï¼Œæ‰æ˜¯å¼•å…¥æ¨¡å¼çš„æ™‚æ©Ÿã€‚</p>
                        </div>
                    </div>
                </div>

                <!-- é»ƒé‡‘åŸå‰‡ -->
                <div class="bg-gradient-to-r from-yellow-50 to-amber-50 p-6 rounded-xl border border-yellow-300">
                    <h3 class="text-lg font-bold text-yellow-700 mb-3">ğŸŒŸ é¸æ“‡è¨­è¨ˆæ¨¡å¼çš„é»ƒé‡‘æµç¨‹</h3>
                    <div class="flex flex-wrap gap-2 items-center text-sm">
                        <div class="bg-white px-3 py-2 rounded-lg border border-yellow-200 font-bold text-yellow-700">1. æè¿°ä½ çš„ç—›é»</div>
                        <div class="text-yellow-400 font-bold">â†’</div>
                        <div class="bg-white px-3 py-2 rounded-lg border border-yellow-200 font-bold text-yellow-700">2. æ‰¾å‡ºè®ŠåŒ–é»åœ¨å“ª</div>
                        <div class="text-yellow-400 font-bold">â†’</div>
                        <div class="bg-white px-3 py-2 rounded-lg border border-yellow-200 font-bold text-yellow-700">3. å°æ‡‰ä¸Šæ–¹è¡¨æ ¼</div>
                        <div class="text-yellow-400 font-bold">â†’</div>
                        <div class="bg-white px-3 py-2 rounded-lg border border-yellow-200 font-bold text-yellow-700">4. ç¢ºèªä»£åƒ¹å€¼å¾—å—</div>
                        <div class="text-yellow-400 font-bold">â†’</div>
                        <div class="bg-white px-3 py-2 rounded-lg border border-yellow-200 font-bold text-yellow-700">5. å¯¦ä½œ</div>
                    </div>
                    <p class="text-xs text-gray-600 mt-3">ğŸ’¬ è¨˜ä½ï¼š<strong>è¨­è¨ˆæ¨¡å¼æ˜¯å·¥å…·ï¼Œä¸æ˜¯ç›®æ¨™ã€‚</strong> èƒ½è§£æ±ºå•é¡Œçš„æœ€ç°¡å–®æ–¹æ¡ˆï¼Œæ‰æ˜¯æœ€å¥½çš„è¨­è¨ˆã€‚</p>
                </div>

            </section>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ– Mermaid
        mermaid.initialize({ startOnLoad: false, theme: 'neutral', securityLevel: 'loose' });

        // ========== Visitor Pattern è¨­è¨ˆ ==========
        // åŸºç¤å…ƒä»¶æŠ½è±¡é¡
        class SystemEntryComponent {
            constructor(name) {
                this.id = crypto.randomUUID();
                this.name = name;
                this.created = new Date();
                this.size = 0;
                this.attributes = "";
                this.tags = []; // æ–°å¢æ¨™ç±¤å±¬æ€§
            }
            get type() { throw new Error("Method not implemented."); }
            // å…¬é–‹æ–¹æ³•ï¼šå¤–éƒ¨èª¿ç”¨
            accept(visitor) {
                this._accept(visitor, 0);
            }
            // å…§éƒ¨æ–¹æ³•ï¼šéè¿´ä½¿ç”¨
            _accept(visitor, depth) { throw new Error("Method not implemented."); }
            getSizeDisplay() {
                if (this.size < 1024) return `${this.size} B`;
                return `${(this.size / 1024).toFixed(1)} KB`;
            }
            // æ¨™ç±¤ç®¡ç†æ–¹æ³•
            addTag(tagName) {
                if (!this.tags.includes(tagName)) {
                    this.tags.push(tagName);
                }
            }
            removeTag(tagName) {
                this.tags = this.tags.filter(t => t !== tagName);
            }
            hasTag(tagName) {
                return this.tags.includes(tagName);
            }
            // å–å¾—å‰¯æª”å
            getExtension() {
                if (this instanceof DirectoryComposite) return '';
                const parts = this.name.split('.');
                return parts.length > 1 ? parts[parts.length - 1].toLowerCase() : '';
            }
        }

        // æ–‡ä»¶è‘‰å­ç¯€é»æŠ½è±¡é¡
        class FileLeaf extends SystemEntryComponent {
            constructor(name, size_bytes) {
                super(name);
                this.size = size_bytes;
            }
            _accept(visitor, depth) {
                visitor.visit(this, depth);
            }
        }

        // å…·é«”æ–‡ä»¶é¡å‹
        class WordDocumentLeaf extends FileLeaf {
            constructor(name, size_bytes, pages) {
                super(name, size_bytes);
                this.pages = pages;
            }
            get type() { return "Word æª”æ¡ˆ"; }
        }

        class ImageFileLeaf extends FileLeaf {
            constructor(name, size_bytes, width, height) {
                super(name, size_bytes);
                this.width = width;
                this.height = height;
            }
            get type() { return "åœ–ç‰‡"; }
        }

        class TextFileLeaf extends FileLeaf {
            constructor(name, size_bytes, encoding) {
                super(name, size_bytes);
                this.encoding = encoding;
            }
            get type() { return "ç´”æ–‡å­—æª”"; }
        }

        // ç›®éŒ„è¤‡åˆç¯€é»
        class DirectoryComposite extends SystemEntryComponent {
            constructor(name) {
                super(name);
                this.children = [];
            }
            get type() { return "ç›®éŒ„"; }
            
            add(child) { this.children.push(child); }
            remove(childId) { this.children = this.children.filter(c => c.id !== childId); }
            getChildren() { return this.children; }

            _accept(visitor, depth) {
                visitor.visit(this, depth);
                this.children.forEach(child => child._accept(visitor, depth + 1));
            }

            // æ’åºæ–¹æ³•
            sortChildren(sortBy, order = 'asc') {
                this.children.sort((a, b) => {
                    let compareA, compareB;
                    
                    if (sortBy === 'name') {
                        compareA = a.name.toLowerCase();
                        compareB = b.name.toLowerCase();
                    } else if (sortBy === 'size') {
                        compareA = a.size;
                        compareB = b.size;
                    } else if (sortBy === 'extension') {
                        compareA = a.getExtension();
                        compareB = b.getExtension();
                    }
                    
                    let result = 0;
                    if (compareA < compareB) result = -1;
                    else if (compareA > compareB) result = 1;
                    
                    return order === 'asc' ? result : -result;
                });
                
                // éè¿´æ’åºå­ç›®éŒ„
                this.children.forEach(child => {
                    if (child instanceof DirectoryComposite) {
                        child.sortChildren(sortBy, order);
                    }
                });
            }
        }

        // ========== è¨ªå•è€…æ¥å£èˆ‡å¯¦ç¾ ==========
        // æ­·å²è¨˜éŒ„ç®¡ç†ç³»çµ±ï¼ˆUndo/Redoï¼‰
        class HistoryManager {
            constructor() {
                this.undoStack = [];
                this.redoStack = [];
                this.maxHistorySize = 50;
            }

            saveState() {
                // æ·±åº¦è¤‡è£½ç•¶å‰ç‹€æ…‹
                const state = this.cloneNode(systemRoot);
                this.undoStack.push(state);
                if (this.undoStack.length > this.maxHistorySize) {
                    this.undoStack.shift();
                }
                // æ¸…ç©º redo stack
                this.redoStack = [];
                this.updateUndoRedoButtons();
            }

            undo() {
                if (this.undoStack.length === 0) return false;
                
                // ä¿å­˜ç•¶å‰ç‹€æ…‹åˆ° redo
                this.redoStack.push(this.cloneNode(systemRoot));
                
                // æ¢å¾©ä¸Šä¸€å€‹ç‹€æ…‹
                const previousState = this.undoStack.pop();
                systemRoot = this.cloneNode(previousState);
                
                this.updateUndoRedoButtons();
                return true;
            }

            redo() {
                if (this.redoStack.length === 0) return false;
                
                // ä¿å­˜ç•¶å‰ç‹€æ…‹åˆ° undo
                this.undoStack.push(this.cloneNode(systemRoot));
                
                // æ¢å¾© redo ç‹€æ…‹
                const nextState = this.redoStack.pop();
                systemRoot = this.cloneNode(nextState);
                
                this.updateUndoRedoButtons();
                return true;
            }

            cloneNode(node) {
                if (node instanceof DirectoryComposite) {
                    const clone = new DirectoryComposite(node.name);
                    clone.id = node.id;
                    clone.created = new Date(node.created);
                    clone.size = node.size;
                    clone.tags = [...node.tags];
                    node.children.forEach(child => {
                        clone.add(this.cloneNode(child));
                    });
                    return clone;
                } else if (node instanceof WordDocumentLeaf) {
                    const clone = new WordDocumentLeaf(node.name, node.size, node.pages);
                    clone.id = node.id;
                    clone.created = new Date(node.created);
                    clone.tags = [...node.tags];
                    return clone;
                } else if (node instanceof ImageFileLeaf) {
                    const clone = new ImageFileLeaf(node.name, node.size, node.width, node.height);
                    clone.id = node.id;
                    clone.created = new Date(node.created);
                    clone.tags = [...node.tags];
                    return clone;
                } else if (node instanceof TextFileLeaf) {
                    const clone = new TextFileLeaf(node.name, node.size, node.encoding);
                    clone.id = node.id;
                    clone.created = new Date(node.created);
                    clone.tags = [...node.tags];
                    return clone;
                }
            }

            updateUndoRedoButtons() {
                const undoBtn = document.getElementById('undo-btn');
                const redoBtn = document.getElementById('redo-btn');
                if (undoBtn) undoBtn.disabled = this.undoStack.length === 0;
                if (redoBtn) redoBtn.disabled = this.redoStack.length === 0;
            }

            canUndo() {
                return this.undoStack.length > 0;
            }

            canRedo() {
                return this.redoStack.length > 0;
            }
        }

        class IVisitor {
            visit(element) { throw new Error("Method not implemented."); }
        }

        // è¨ˆç®—ç¸½å¤§å°è¨ªå•è€…
        class SizeCalculatorVisitor extends IVisitor {
            constructor() {
                super();
                this.totalSize = 0;
            }
            visit(element, depth) {
                if (element instanceof FileLeaf) {
                    this.totalSize += element.size;
                }
            }
            getTotalSize() { return this.totalSize; }
        }

        // æ–‡ä»¶æœå°‹è¨ªå•è€…
        class FileSearchVisitor extends IVisitor {
            constructor(extension) {
                super();
                this.extension = extension.toLowerCase();
                this.results = [];
            }
            visit(element, depth) {
                if (element instanceof FileLeaf && element.name.toLowerCase().endsWith(this.extension)) {
                    this.results.push(element);
                }
            }
            getResults() { return this.results; }
        }

        // æ–‡æœ¬é¡¯ç¤ºè¨ªå•è€…ï¼ˆç”¨æ–¼çµ‚ç«¯è¼¸å‡ºï¼‰
        class TreeDisplayVisitor extends IVisitor {
            constructor() {
                super();
                this.output = "";
                this.isRoot = true;
            }
            visit(element, depth) {
                const indent = "  ".repeat(depth);
                if (element instanceof DirectoryComposite) {
                    if (!this.isRoot) {
                        this.output += `${indent}ğŸ“ ${element.name}\n`;
                    }
                    this.isRoot = false;
                } else if (element instanceof WordDocumentLeaf) {
                    this.output += `${indent}ğŸ“„ ${element.name} (Word, ${element.pages}p, ${element.getSizeDisplay()})\n`;
                } else if (element instanceof ImageFileLeaf) {
                    this.output += `${indent}ğŸ–¼ï¸ ${element.name} (Img, ${element.width}x${element.height}, ${element.getSizeDisplay()})\n`;
                } else if (element instanceof TextFileLeaf) {
                    this.output += `${indent}ğŸ“„ ${element.name} (Txt, ${element.encoding}, ${element.getSizeDisplay()})\n`;
                }
            }
            getOutput() { return this.output; }
        }

        // XML åŒ¯å‡ºè¨ªå•è€…
        class XMLExportVisitor extends IVisitor {
            constructor() {
                super();
                this.xmlOutput = "";
                this.pendingCloseTags = [];  // ç”¨æ–¼è¿½è¹¤å¾…é—œé–‰çš„æ¨™ç±¤ { name, depth }
            }
            
            closeTagsGreaterThan(minDepth) {
                while (this.pendingCloseTags.length > 0 && this.pendingCloseTags[this.pendingCloseTags.length - 1].depth > minDepth) {
                    const tag = this.pendingCloseTags.pop();
                    const closeIndent = "  ".repeat(tag.depth);
                    this.xmlOutput += `${closeIndent}</${tag.name}>\n`;
                }
            }
            
            visit(element, depth) {
                const indent = "  ".repeat(depth);
                
                if (element instanceof DirectoryComposite) {
                    // å…ˆé—œé–‰æ·±åº¦å¤§æ–¼ç­‰æ–¼ç•¶å‰æ·±åº¦çš„æ¨™ç±¤
                    this.closeTagsGreaterThan(depth - 1);
                    
                    // è¼¸å‡ºæ‰€æœ‰ç›®éŒ„æ¨™ç±¤ï¼ˆåŒ…æ‹¬æ ¹ç›®éŒ„ï¼‰
                    this.xmlOutput += `${indent}<${element.name}>\n`;
                    this.pendingCloseTags.push({ name: element.name, depth: depth });
                } else if (element instanceof FileLeaf) {
                    // å…ˆé—œé–‰æ·±åº¦å¤§æ–¼ç•¶å‰æ·±åº¦çš„æ¨™ç±¤
                    this.closeTagsGreaterThan(depth - 1);
                    
                    this.xmlOutput += `${indent}<${element.name}></${element.name}>\n`;
                }
            }
            getXMLOutput() { 
                // é—œé–‰æ‰€æœ‰å‰©é¤˜çš„æ¨™ç±¤
                while (this.pendingCloseTags.length > 0) {
                    const tag = this.pendingCloseTags.pop();
                    const indent = "  ".repeat(tag.depth);
                    this.xmlOutput += `${indent}</${tag.name}>\n`;
                }
                return this.xmlOutput; 
            }
        }

        // ========== å…¨åŸŸç‹€æ…‹èˆ‡åŠŸèƒ½å¯¦ä½œ ==========
        let systemRoot = new DirectoryComposite("æ ¹ç›®éŒ„(Root)");
        let folderMap = new Map();
        let historyManager = new HistoryManager();
        let selectedNodeId = null; // ç”¨æ–¼æ¨™ç±¤ç®¡ç†

        // æ¨™ç±¤å®šç¾©
        const TAG_DEFINITIONS = {
            'Urgent': { color: 'red', bgColor: 'bg-red-100', textColor: 'text-red-700', borderColor: 'border-red-500' },
            'Work': { color: 'blue', bgColor: 'bg-blue-100', textColor: 'text-blue-700', borderColor: 'border-blue-500' },
            'Personal': { color: 'green', bgColor: 'bg-green-100', textColor: 'text-green-700', borderColor: 'border-green-500' }
        };

        function showTotalSize() {
            const visitor = new SizeCalculatorVisitor();
            systemRoot.accept(visitor);
            const total = visitor.getTotalSize();
            const formatted = total >= 1048576 ? (total/1048576).toFixed(2) + " MB" : (total/1024).toFixed(1) + " KB";
            document.getElementById('terminal-title').innerText = "é€²éšåˆ†æï¼šè¨ˆç®—ç¸½å¤§å°";
            document.getElementById('terminal-output').innerText = `ç³»çµ±å…§æ‰€æœ‰æª”æ¡ˆä¹‹ç¸½å¤§å°ç‚ºï¼š\n------------------------\n${total} Bytes\nç´„ç­‰åŒæ–¼ ${formatted}`;
        }

        function findDocxFiles() {
            const visitor = new FileSearchVisitor(".docx");
            systemRoot.accept(visitor);
            const files = visitor.getResults();
            document.getElementById('terminal-title').innerText = "é€²éšåˆ†æï¼šæœå°‹ .docx æª”æ¡ˆ";
            if (files.length === 0) {
                document.getElementById('terminal-output').innerText = "ç³»çµ±å…§ç›®å‰æ²’æœ‰å‰¯æª”åç‚º .docx çš„æª”æ¡ˆã€‚";
            } else {
                let res = `å…±å°‹ç² ${files.length} å€‹ç¬¦åˆæ¢ä»¶çš„æª”æ¡ˆï¼š\n------------------------\n`;
                files.forEach(f => res += `- ${f.name} (${f.getSizeDisplay()})\n`);
                document.getElementById('terminal-output').innerText = res;
            }
        }

        function exportToXML() {
            const visitor = new XMLExportVisitor();
            systemRoot.accept(visitor);
            const output = visitor.getXMLOutput();
            document.getElementById('terminal-title').innerText = "é€²éšåˆ†æï¼šXML æ ¼å¼åŒ¯å‡º";
            document.getElementById('terminal-output').innerText = output;
        }

        // ========== UI æ§åˆ¶ ==========
        function openTab(evt, tabName) {
            document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
            document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
            const activeTab = document.getElementById(tabName);
            activeTab.classList.add("active");
            evt.currentTarget.classList.add("active");

            if (tabName === 'domain' || tabName === 'er') {
                const diagrams = activeTab.querySelectorAll('.mermaid');
                diagrams.forEach(d => {
                    const code = d.getAttribute('data-original-code');
                    if (code) { d.innerHTML = code; d.removeAttribute('data-processed'); }
                });
                setTimeout(() => mermaid.run({ nodes: diagrams }), 50);
            }
        }

        function toggleFields() {
            const type = document.getElementById('type-select').value;
            const extra = document.getElementById('extra-fields');
            document.querySelectorAll("#extra-fields > div").forEach(d => d.classList.add('hidden'));

            if (type === 'FOLDER') { extra.classList.add('hidden'); } 
            else {
                extra.classList.remove('hidden');
                document.getElementById('node-size').parentElement.classList.remove('hidden');
                if (type === 'WORD') document.getElementById('field-pages').classList.remove('hidden');
                if (type === 'IMAGE') { document.getElementById('field-width').classList.remove('hidden'); document.getElementById('field-height').classList.remove('hidden'); }
                if (type === 'TEXT') document.getElementById('field-encoding').classList.remove('hidden');
            }
        }

        function handleAddNode() {
            const pId = document.getElementById('parent-select').value;
            const type = document.getElementById('type-select').value;
            const name = document.getElementById('node-name').value || "æœªå‘½å";
            const parent = folderMap.get(pId);
            if (!parent) return;

            // ä¿å­˜æ“ä½œå‰ç‹€æ…‹
            historyManager.saveState();

            let node;
            const size = parseInt(document.getElementById('node-size').value);
            if (type === 'FOLDER') {
                node = new DirectoryComposite(name);
            } else if (type === 'WORD') {
                node = new WordDocumentLeaf(name, size, parseInt(document.getElementById('node-pages').value));
            } else if (type === 'IMAGE') {
                node = new ImageFileLeaf(name, size, parseInt(document.getElementById('node-width').value), parseInt(document.getElementById('node-height').value));
            } else if (type === 'TEXT') {
                node = new TextFileLeaf(name, size, document.getElementById('node-encoding').value);
            }

            parent.add(node);
            refreshUI();
            document.getElementById('node-name').value = "";
        }

        function handleDeleteNode(id) {
            if (id === systemRoot.id) return;
            
            // ä¿å­˜æ“ä½œå‰ç‹€æ…‹
            historyManager.saveState();
            
            function search(curr) {
                const startLen = curr.getChildren().length;
                curr.remove(id);
                if (curr.getChildren().length < startLen) return true;
                for (let c of curr.getChildren()) {
                    if (c instanceof DirectoryComposite && search(c)) return true;
                }
                return false;
            }
            search(systemRoot);
            refreshUI();
        }

        // æ’åºåŠŸèƒ½
        function handleSort() {
            const sortBy = document.getElementById('sort-by').value;
            const sortOrder = document.getElementById('sort-order').value;
            
            historyManager.saveState();
            systemRoot.sortChildren(sortBy, sortOrder);
            refreshUI();
        }

        // Undo/RedoåŠŸèƒ½
        function handleUndo() {
            if (historyManager.undo()) {
                refreshUI();
            }
        }

        function handleRedo() {
            if (historyManager.redo()) {
                refreshUI();
            }
        }

        // æ¨™ç±¤ç®¡ç†åŠŸèƒ½
        function findNodeById(id, node = systemRoot) {
            if (node.id === id) return node;
            if (node instanceof DirectoryComposite) {
                for (let child of node.getChildren()) {
                    const found = findNodeById(id, child);
                    if (found) return found;
                }
            }
            return null;
        }

        function openTagModal(nodeId) {
            selectedNodeId = nodeId;
            const node = findNodeById(nodeId);
            if (!node) return;

            const modal = document.getElementById('tag-modal');
            const modalTitle = document.getElementById('modal-node-name');
            modalTitle.textContent = node.name;

            // æ›´æ–°æ¨™ç±¤é¸æ“‡ç‹€æ…‹
            Object.keys(TAG_DEFINITIONS).forEach(tagName => {
                const checkbox = document.getElementById(`tag-${tagName}`);
                if (checkbox) {
                    checkbox.checked = node.hasTag(tagName);
                }
            });

            modal.classList.remove('hidden');
        }

        function closeTagModal() {
            document.getElementById('tag-modal').classList.add('hidden');
            selectedNodeId = null;
        }

        function saveNodeTags() {
            if (!selectedNodeId) return;
            
            historyManager.saveState();
            
            const node = findNodeById(selectedNodeId);
            if (!node) return;

            // æ¸…é™¤ç¾æœ‰æ¨™ç±¤
            node.tags = [];

            // æ·»åŠ é¸ä¸­çš„æ¨™ç±¤
            Object.keys(TAG_DEFINITIONS).forEach(tagName => {
                const checkbox = document.getElementById(`tag-${tagName}`);
                if (checkbox && checkbox.checked) {
                    node.addTag(tagName);
                }
            });

            closeTagModal();
            refreshUI();
        }

        function refreshUI() {
            const displayVisitor = new TreeDisplayVisitor();
            systemRoot.accept(displayVisitor);
            document.getElementById('terminal-title').innerText = "çµ‚ç«¯æ©Ÿè¼¸å‡º (çµæ§‹æª¢è¦–)";
            document.getElementById('terminal-output').innerText = displayVisitor.getOutput();
            const tree = document.getElementById('tree-visual');
            tree.innerHTML = "";
            renderVisual(systemRoot, tree);
            updateSelect();
        }

        function renderVisual(node, container) {
            const row = document.createElement('div');
            row.className = "tree-item-row flex items-center group py-1";
            const content = document.createElement('div');
            content.className = "flex-grow flex items-center flex-wrap gap-1";
            let html = "";
            
            if (node instanceof DirectoryComposite) {
                html = `<span class="folder-icon font-bold mr-1">ğŸ“ ${node.name}</span>`;
            } else if (node instanceof WordDocumentLeaf) {
                html = `<span class="file-icon mr-1">ğŸ“„ ${node.name}</span> <span class="text-xs text-gray-400">(Word, ${node.pages}p, ${node.getSizeDisplay()})</span>`;
            } else if (node instanceof ImageFileLeaf) {
                html = `<span class="file-icon mr-1">ğŸ–¼ï¸ ${node.name}</span> <span class="text-xs text-gray-400">(Img, ${node.width}x${node.height}, ${node.getSizeDisplay()})</span>`;
            } else if (node instanceof TextFileLeaf) {
                html = `<span class="file-icon mr-1">ğŸ“„ ${node.name}</span> <span class="text-xs text-gray-400">(Txt, ${node.encoding}, ${node.getSizeDisplay()})</span>`;
            }
            
            content.innerHTML = html;

            // é¡¯ç¤ºæ¨™ç±¤
            if (node.tags && node.tags.length > 0) {
                node.tags.forEach(tag => {
                    const tagDef = TAG_DEFINITIONS[tag];
                    if (tagDef) {
                        const tagSpan = document.createElement('span');
                        tagSpan.className = `text-xs px-2 py-0.5 rounded ${tagDef.bgColor} ${tagDef.textColor} border ${tagDef.borderColor} ml-1`;
                        tagSpan.textContent = tag;
                        content.appendChild(tagSpan);
                    }
                });
            }

            row.appendChild(content);

            // æŒ‰éˆ•çµ„
            const btnGroup = document.createElement('div');
            btnGroup.className = "flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity";

            // æ¨™ç±¤æŒ‰éˆ•
            const tagBtn = document.createElement('button');
            tagBtn.className = "text-purple-600 hover:text-purple-800 text-xs ml-2 font-bold px-2 py-0.5 rounded hover:bg-purple-50";
            tagBtn.innerHTML = "ğŸ·ï¸";
            tagBtn.title = "ç®¡ç†æ¨™ç±¤";
            tagBtn.onclick = (e) => { e.stopPropagation(); openTagModal(node.id); };
            btnGroup.appendChild(tagBtn);

            // åˆªé™¤æŒ‰éˆ•
            if (node.id !== systemRoot.id) {
                const delBtn = document.createElement('button');
                delBtn.className = "text-red-500 hover:text-red-700 text-xs font-bold px-2 py-0.5 rounded hover:bg-red-50";
                delBtn.innerHTML = "ğŸ—‘ï¸";
                delBtn.title = "åˆªé™¤";
                delBtn.onclick = (e) => { e.stopPropagation(); handleDeleteNode(node.id); };
                btnGroup.appendChild(delBtn);
            }

            row.appendChild(btnGroup);

            const wrap = document.createElement('div');
            wrap.className = "tree-node";
            wrap.appendChild(row);
            container.appendChild(wrap);
            if (node instanceof DirectoryComposite) {
                node.getChildren().forEach(c => renderVisual(c, wrap));
            }
        }

        function updateSelect() {
            const select = document.getElementById('parent-select');
            const curr = select.value;
            select.innerHTML = "";
            folderMap.clear();
            function walk(n, path = "") {
                if (n instanceof DirectoryComposite) {
                    const p = path + "/" + n.name;
                    folderMap.set(n.id, n);
                    const o = document.createElement('option');
                    o.value = n.id; o.innerText = p;
                    select.appendChild(o);
                    n.getChildren().forEach(c => walk(c, p));
                }
            }
            walk(systemRoot);
            if (folderMap.has(curr)) select.value = curr;
        }

        window.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.mermaid').forEach(d => d.setAttribute('data-original-code', d.innerText.trim()));
            
            // åˆå§‹åŒ–çµæ§‹
            const project = new DirectoryComposite("å°ˆæ¡ˆæ–‡ä»¶ (Project_Docs)");
            project.add(new WordDocumentLeaf("éœ€æ±‚è¦æ ¼æ›¸.docx", 500 * 1024, 15));
            project.add(new ImageFileLeaf("ç³»çµ±æ¶æ§‹åœ–.png", 2 * 1024 * 1024, 1920, 1080));

            const personal = new DirectoryComposite("å€‹äººç­†è¨˜ (Personal_Notes)");
            personal.add(new TextFileLeaf("å¾…è¾¦æ¸…å–®.txt", 1 * 1024, "UTF-8"));
            
            const archive = new DirectoryComposite("2025å‚™ä»½ (Archive_2025)");
            archive.add(new WordDocumentLeaf("èˆŠæœƒè­°è¨˜éŒ„.docx", 200 * 1024, 5));
            personal.add(archive);
            
            systemRoot.add(project);
            systemRoot.add(personal);
            systemRoot.add(new TextFileLeaf("README.txt", 500, "ASCII"));

            refreshUI();
            toggleFields();
            
            // åˆå§‹åŒ– Java ä»£ç¢¼ç€è¦½å™¨
            console.log('ğŸ“Œ DOM å·²åŠ è¼‰å®Œæˆï¼Œæº–å‚™åˆå§‹åŒ– Java ä»£ç¢¼ç€è¦½å™¨');
            console.log('ğŸ“Œ javaFiles å°è±¡:', typeof javaFiles, Object.keys(javaFiles).length, 'å€‹æª”æ¡ˆ');
            initJavaCodeBrowser();
        });

        // ========== Java ä»£ç¢¼ç€è¦½å™¨åŠŸèƒ½ ==========
        const javaFiles = {
            'FileSystemDemo.java': {
                folder: '',
                folderName: 'ä¸»ç¨‹å¼',
                icon: 'â–¶ï¸',
                code: `public class FileSystemDemo {
    public static void main(String[] args) {
        // å»ºç«‹æ ¹ç›®éŒ„
        DirectoryComposite root = new DirectoryComposite("æ ¹ç›®éŒ„(Root)");
        
        // å»ºç«‹å°ˆæ¡ˆæ–‡ä»¶ç›®éŒ„
        DirectoryComposite project = new DirectoryComposite("å°ˆæ¡ˆæ–‡ä»¶ (Project_Docs)");
        project.add(new WordDocument("éœ€æ±‚è¦æ ¼æ›¸.docx", 500 * 1024, 15));
        project.add(new ImageFile("ç³»çµ±æ¶æ§‹åœ–.png", 2 * 1024 * 1024, 1920, 1080));
        
        // å»ºç«‹å€‹äººç­†è¨˜ç›®éŒ„
        DirectoryComposite personal = new DirectoryComposite("å€‹äººç­†è¨˜ (Personal_Notes)");
        personal.add(new TextFile("å¾…è¾¦æ¸…å–®.txt", 1 * 1024, "UTF-8"));
        
        // å»ºç«‹å‚™ä»½ç›®éŒ„
        DirectoryComposite archive = new DirectoryComposite("2025å‚™ä»½ (Archive_2025)");
        archive.add(new WordDocument("èˆŠæœƒè­°è¨˜éŒ„.docx", 200 * 1024, 5));
        personal.add(archive);
        
        // çµ„åˆçµæ§‹
        root.add(project);
        root.add(personal);
        root.add(new TextFile("README.txt", 500, "ASCII"));
        
        // æ¸¬è©¦ 1: è¨ˆç®—ç¸½å¤§å°
        System.out.println("=== è¨ˆç®—ç¸½å¤§å° ===");
        SizeCalculatorVisitor sizeVisitor = new SizeCalculatorVisitor();
        root.accept(sizeVisitor);
        long total = sizeVisitor.getTotalSize();
        String formatted = total >= 1048576 ? 
            String.format("%.2f MB", total / 1048576.0) : 
            String.format("%.1f KB", total / 1024.0);
        System.out.println("ç¸½å¤§å°: " + total + " Bytes (" + formatted + ")");
        
        // æ¸¬è©¦ 2: æœå°‹ .docx æª”æ¡ˆ
        System.out.println("\\n=== æœå°‹ .docx æª”æ¡ˆ ===");
        FileSearchVisitor searchVisitor = new FileSearchVisitor(".docx");
        root.accept(searchVisitor);
        java.util.List<FileLeaf> results = searchVisitor.getResults();
        System.out.println("å…±æ‰¾åˆ° " + results.size() + " å€‹æª”æ¡ˆ:");
        for (FileLeaf file : results) {
            System.out.println("  - " + file.getName() + " (" + file.getSizeDisplay() + ")");
        }
        
        // æ¸¬è©¦ 3: é¡¯ç¤ºçµæ§‹
        System.out.println("\\n=== æª”æ¡ˆçµæ§‹ ===");
        TreeDisplayVisitor displayVisitor = new TreeDisplayVisitor();
        root.accept(displayVisitor);
        System.out.println(displayVisitor.getOutput());
        
        // æ¸¬è©¦ 4: XML åŒ¯å‡º
        System.out.println("\\n=== XML æ ¼å¼åŒ¯å‡º ===");
        XMLExportVisitor xmlVisitor = new XMLExportVisitor();
        root.accept(xmlVisitor);
        System.out.println(xmlVisitor.getXMLOutput());
    }
}`
            },
            'core/SystemEntryComponent.java': {
                folder: 'core',
                folderName: 'æ ¸å¿ƒé¡åˆ¥',
                icon: 'ğŸ—ï¸',
                code: `import java.util.*;

public abstract class SystemEntryComponent {
    protected String name;
    protected java.time.LocalDateTime created;
    protected long size;
    protected String attributes;
    protected List<String> tags;
    
    public SystemEntryComponent(String name) {
        this.name = name;
        this.created = java.time.LocalDateTime.now();
        this.size = 0;
        this.tags = new ArrayList<>();
    }
    
    public abstract String getType();
    
    // å…¬é–‹æ–¹æ³•ï¼šå¤–éƒ¨èª¿ç”¨
    public void accept(IVisitor visitor) {
        accept(visitor, 0);
    }
    
    // å…§éƒ¨æ–¹æ³•ï¼šéè¿´ä½¿ç”¨
    abstract void accept(IVisitor visitor, int depth);
    
    public String getSizeDisplay() {
        if (size < 1024) return size + " B";
        return String.format("%.1f KB", size / 1024.0);
    }
    
    // æ¨™ç±¤ç®¡ç†æ–¹æ³•
    public void addTag(String tag) {
        if (!tags.contains(tag)) {
            tags.add(tag);
        }
    }
    
    public void removeTag(String tag) {
        tags.remove(tag);
    }
    
    public boolean hasTag(String tag) {
        return tags.contains(tag);
    }
    
    public List<String> getTags() {
        return new ArrayList<>(tags);
    }
    
    // å–å¾—å‰¯æª”å
    public String getExtension() {
        if (this instanceof DirectoryComposite) return "";
        int lastDot = name.lastIndexOf('.');
        return lastDot > 0 ? name.substring(lastDot + 1).toLowerCase() : "";
    }
    
    public String getName() { return name; }
    public long getSize() { return size; }
}`
            },
            'core/FileLeaf.java': {
                folder: 'core',
                folderName: 'æ ¸å¿ƒé¡åˆ¥',
                icon: 'ğŸ“„',
                code: `public abstract class FileLeaf extends SystemEntryComponent {
    public FileLeaf(String name, long sizeBytes) {
        super(name);
        this.size = sizeBytes;
    }
    
    @Override
    void accept(IVisitor visitor, int depth) {
        visitor.visit(this, depth);
    }
}`
            },
            'core/DirectoryComposite.java': {
                folder: 'core',
                folderName: 'æ ¸å¿ƒé¡åˆ¥',
                icon: 'ğŸ“',
                code: `import java.util.*;

public class DirectoryComposite extends SystemEntryComponent {
    private List<SystemEntryComponent> children = new ArrayList<>();
    
    public DirectoryComposite(String name) {
        super(name);
    }
    
    public void add(SystemEntryComponent child) {
        children.add(child);
    }
    
    public void remove(SystemEntryComponent child) {
        children.remove(child);
    }
    
    public List<SystemEntryComponent> getChildren() {
        return new ArrayList<>(children);
    }
    
    // æ’åºæ–¹æ³•
    public void sortChildren(String sortBy, String order) {
        Comparator<SystemEntryComponent> comparator = null;
        
        switch (sortBy.toLowerCase()) {
            case "name":
                comparator = Comparator.comparing(c -> c.getName().toLowerCase());
                break;
            case "size":
                comparator = Comparator.comparingLong(SystemEntryComponent::getSize);
                break;
            case "extension":
                comparator = Comparator.comparing(SystemEntryComponent::getExtension);
                break;
            default:
                comparator = Comparator.comparing(c -> c.getName().toLowerCase());
        }
        
        if ("desc".equalsIgnoreCase(order)) {
            comparator = comparator.reversed();
        }
        
        children.sort(comparator);
        
        // éè¿´æ’åºå­ç›®éŒ„
        for (SystemEntryComponent child : children) {
            if (child instanceof DirectoryComposite) {
                ((DirectoryComposite) child).sortChildren(sortBy, order);
            }
        }
    }
    
    @Override
    public String getType() { return "ç›®éŒ„"; }
    
    @Override
    void accept(IVisitor visitor, int depth) {
        visitor.visit(this, depth);
        for (SystemEntryComponent child : children) {
            child.accept(visitor, depth + 1);
        }
    }
}`
            },
            'files/WordDocument.java': {
                folder: 'files',
                folderName: 'å…·é«”æª”æ¡ˆé¡å‹',
                icon: 'ğŸ“',
                code: `public class WordDocument extends FileLeaf {
    private int pages;
    
    public WordDocument(String name, long size, int pages) {
        super(name, size);
        this.pages = pages;
    }
    
    @Override
    public String getType() { return "Word æª”æ¡ˆ"; }
    
    public int getPages() { return pages; }
}`
            },
            'files/ImageFile.java': {
                folder: 'files',
                folderName: 'å…·é«”æª”æ¡ˆé¡å‹',
                icon: 'ğŸ–¼ï¸',
                code: `public class ImageFile extends FileLeaf {
    private int width;
    private int height;
    
    public ImageFile(String name, long size, int width, int height) {
        super(name, size);
        this.width = width;
        this.height = height;
    }
    
    @Override
    public String getType() { return "åœ–ç‰‡"; }
    
    public int getWidth() { return width; }
    public int getHeight() { return height; }
}`
            },
            'TextFile.java': {
                category: 'å…·é«”æª”æ¡ˆé¡å‹',
                icon: 'ğŸ“ƒ',
                code: `public class TextFile extends FileLeaf {
    private String encoding;
    
    public TextFile(String name, long size, String encoding) {
        super(name, size);
        this.encoding = encoding;
    }
    
    @Override
    public String getType() { return "ç´”æ–‡å­—æª”"; }
    
    public String getEncoding() { return encoding; }
}`
            },
            'files/TextFile.java': {
                folder: 'files',
                folderName: 'å…·é«”æª”æ¡ˆé¡å‹',
                icon: 'ğŸ“ƒ',
                code: `public class TextFile extends FileLeaf {
    private String encoding;
    
    public TextFile(String name, long size, String encoding) {
        super(name, size);
        this.encoding = encoding;
    }
    
    @Override
    public String getType() { return "ç´”æ–‡å­—æª”"; }
    
    public String getEncoding() { return encoding; }
}`
            },
            'visitor/IVisitor.java': {
                folder: 'visitor',
                folderName: 'Visitor æ¥å£',
                icon: 'ğŸ”',
                code: `public interface IVisitor {
    void visit(FileLeaf leaf, int depth);
    void visit(DirectoryComposite composite, int depth);
}`
            },
            'visitor/SizeCalculatorVisitor.java': {
                folder: 'visitor',
                folderName: 'Visitor å¯¦ä½œ',
                icon: 'ğŸ“Š',
                code: `public class SizeCalculatorVisitor implements IVisitor {
    private long totalSize = 0;
    
    @Override
    public void visit(FileLeaf leaf, int depth) {
        totalSize += leaf.getSize();
    }
    
    @Override
    public void visit(DirectoryComposite composite, int depth) {
        // éè¿´ç”± DirectoryComposite.accept æ–¹æ³•è™•ç†
    }
    
    public long getTotalSize() { return totalSize; }
}`
            },
            'visitor/FileSearchVisitor.java': {
                folder: 'visitor',
                folderName: 'Visitor å¯¦ä½œ',
                icon: 'ğŸ”',
                code: `import java.util.*;

public class FileSearchVisitor implements IVisitor {
    private String extension;
    private List<FileLeaf> results = new ArrayList<>();
    
    public FileSearchVisitor(String extension) {
        this.extension = extension.toLowerCase();
    }
    
    @Override
    public void visit(FileLeaf leaf, int depth) {
        if (leaf.getName().toLowerCase().endsWith(extension)) {
            results.add(leaf);
        }
    }
    
    @Override
    public void visit(DirectoryComposite composite, int depth) {
        // éè¿´ç”± DirectoryComposite.accept æ–¹æ³•è™•ç†
    }
    
    public List<FileLeaf> getResults() { return results; }
}`
            },
            'TreeDisplayVisitor.java': {
                category: 'Visitor å¯¦ä½œ',
                icon: 'ğŸŒ²',
                code: `public class TreeDisplayVisitor implements IVisitor {
    private StringBuilder output = new StringBuilder();
    private boolean isRoot = true;
    
    @Override
    public void visit(FileLeaf leaf, int depth) {
        String indent = "  ".repeat(depth);
        output.append(indent).append("ğŸ“„ ").append(leaf.getName());
        
        if (leaf instanceof WordDocument) {
            WordDocument doc = (WordDocument) leaf;
            output.append(" (Word, ").append(doc.getPages()).append("p)");
        } else if (leaf instanceof ImageFile) {
            ImageFile img = (ImageFile) leaf;
            output.append(" (Img, ").append(img.getWidth())
                  .append("x").append(img.getHeight()).append(")");
        } else if (leaf instanceof TextFile) {
            TextFile txt = (TextFile) leaf;
            output.append(" (Txt, ").append(txt.getEncoding()).append(")");
        }
        output.append("\\n");
    }
    
    @Override
    public void visit(DirectoryComposite composite, int depth) {
        if (!isRoot) {
            String indent = "  ".repeat(depth);
            output.append(indent).append("ğŸ“ ")
                  .append(composite.getName()).append("\\n");
        }
        isRoot = false;
    }
    
    public String getOutput() { return output.toString(); }
}`
            },
            'visitor/TreeDisplayVisitor.java': {
                folder: 'visitor',
                folderName: 'Visitor å¯¦ä½œ',
                icon: 'ğŸŒ²',
                code: `public class TreeDisplayVisitor implements IVisitor {
    private StringBuilder output = new StringBuilder();
    private boolean isRoot = true;
    
    @Override
    public void visit(FileLeaf leaf, int depth) {
        String indent = getIndent(depth);
        output.append(indent).append("ğŸ“„ ").append(leaf.getName());
        
        if (leaf instanceof WordDocument) {
            WordDocument doc = (WordDocument) leaf;
            output.append(" (Word, ").append(doc.getPages()).append("p)");
        } else if (leaf instanceof ImageFile) {
            ImageFile img = (ImageFile) leaf;
            output.append(" (Img, ").append(img.getWidth())
                  .append("x").append(img.getHeight()).append(")");
        } else if (leaf instanceof TextFile) {
            TextFile txt = (TextFile) leaf;
            output.append(" (Txt, ").append(txt.getEncoding()).append(")");
        }
        output.append("\\n");
    }
    
    @Override
    public void visit(DirectoryComposite composite, int depth) {
        if (!isRoot) {
            String indent = getIndent(depth);
            output.append(indent).append("ğŸ“ ")
                  .append(composite.getName()).append("\\n");
        }
        isRoot = false;
    }
    
    private String getIndent(int depth) {
        StringBuilder sb = new StringBuilder();
        for (int i = 0; i < depth; i++) {
            sb.append("  ");
        }
        return sb.toString();
    }
    
    public String getOutput() { return output.toString(); }
}`
            },
            'visitor/XMLExportVisitor.java': {
                folder: 'visitor',
                folderName: 'Visitor å¯¦ä½œ',
                icon: 'ğŸ“‹',
                code: `import java.util.*;

public class XMLExportVisitor implements IVisitor {
    private StringBuilder xmlOutput = new StringBuilder();
    private Map<Integer, String> depthTags = new HashMap<>();
    private int maxDepth = 0;
    
    @Override
    public void visit(FileLeaf leaf, int depth) {
        // å…ˆé—œé–‰æ·±åº¦å¤§æ–¼ç•¶å‰æ·±åº¦çš„æ¨™ç±¤
        closeTagsGreaterThan(depth - 1);
        
        String indent = getIndent(depth);
        xmlOutput.append(indent).append("<").append(leaf.getName())
                .append("></").append(leaf.getName()).append(">\\n");
    }
    
    @Override
    public void visit(DirectoryComposite composite, int depth) {
        // å…ˆé—œé–‰æ·±åº¦å¤§æ–¼ç­‰æ–¼ç•¶å‰æ·±åº¦çš„æ¨™ç±¤
        closeTagsGreaterThan(depth - 1);
        
        // è¼¸å‡ºæ‰€æœ‰ç›®éŒ„æ¨™ç±¤ï¼ˆåŒ…æ‹¬æ ¹ç›®éŒ„ï¼‰
        String indent = getIndent(depth);
        xmlOutput.append(indent).append("<").append(composite.getName()).append(">\\n");
        depthTags.put(depth, composite.getName());
        maxDepth = Math.max(maxDepth, depth);
    }
    
    private void closeTagsGreaterThan(int minDepth) {
        for (int d = maxDepth; d > minDepth; d--) {
            if (depthTags.containsKey(d)) {
                String indent = getIndent(d);
                xmlOutput.append(indent).append("</").append(depthTags.get(d)).append(">\\n");
                depthTags.remove(d);
            }
        }
        // æ›´æ–° maxDepth
        while (maxDepth > minDepth && !depthTags.containsKey(maxDepth)) {
            maxDepth--;
        }
    }
    
    private String getIndent(int depth) {
        StringBuilder sb = new StringBuilder();
        for (int i = 0; i < depth; i++) {
            sb.append("  ");
        }
        return sb.toString();
    }
    
    public String getXMLOutput() {
        // é—œé–‰æ‰€æœ‰å‰©é¤˜æ¨™ç±¤
        for (int d = maxDepth; d >= 0; d--) {
            if (depthTags.containsKey(d)) {
                String indent = getIndent(d);
                xmlOutput.append(indent).append("</").append(depthTags.get(d)).append(">\\n");
            }
        }
        return xmlOutput.toString();
    }
}`
            },
            'util/Tag.java': {
                folder: 'util',
                folderName: 'å·¥å…·é¡åˆ¥',
                icon: 'ğŸ·ï¸',
                code: `public class Tag {
    private String name;
    private String color;
    private String description;
    
    public Tag(String name, String color, String description) {
        this.name = name;
        this.color = color;
        this.description = description;
    }
    
    public String getName() { return name; }
    public String getColor() { return color; }
    public String getDescription() { return description; }
    
    // é è¨­æ¨™ç±¤
    public static final Tag URGENT = new Tag("Urgent", "red", "ç·Šæ€¥äº‹é …");
    public static final Tag WORK = new Tag("Work", "blue", "å·¥ä½œç›¸é—œ");
    public static final Tag PERSONAL = new Tag("Personal", "green", "å€‹äººäº‹é …");
}`
            },
            'util/HistoryManager.java': {
                folder: 'util',
                folderName: 'å·¥å…·é¡åˆ¥',
                icon: 'â†¶â†·',
                code: `import java.util.*;

public class HistoryManager {
    private Stack<SystemEntryComponent> undoStack;
    private Stack<SystemEntryComponent> redoStack;
    private int maxHistorySize;
    
    public HistoryManager() {
        this.undoStack = new Stack<>();
        this.redoStack = new Stack<>();
        this.maxHistorySize = 50;
    }
    
    public void saveState(SystemEntryComponent root) {
        undoStack.push(cloneNode(root));
        if (undoStack.size() > maxHistorySize) {
            undoStack.remove(0);
        }
        redoStack.clear();
    }
    
    public SystemEntryComponent undo(SystemEntryComponent current) {
        if (undoStack.isEmpty()) return null;
        redoStack.push(cloneNode(current));
        return undoStack.pop();
    }
    
    public SystemEntryComponent redo(SystemEntryComponent current) {
        if (redoStack.isEmpty()) return null;
        undoStack.push(cloneNode(current));
        return redoStack.pop();
    }
    
    public boolean canUndo() {
        return !undoStack.isEmpty();
    }
    
    public boolean canRedo() {
        return !redoStack.isEmpty();
    }
    
    private SystemEntryComponent cloneNode(SystemEntryComponent node) {
        if (node instanceof DirectoryComposite) {
            DirectoryComposite clone = new DirectoryComposite(node.getName());
            clone.getTags().addAll(node.getTags());
            for (SystemEntryComponent child : ((DirectoryComposite) node).getChildren()) {
                clone.add(cloneNode(child));
            }
            return clone;
        } else if (node instanceof WordDocument) {
            WordDocument original = (WordDocument) node;
            WordDocument clone = new WordDocument(original.getName(), original.getSize(), original.getPages());
            clone.getTags().addAll(original.getTags());
            return clone;
        } else if (node instanceof ImageFile) {
            ImageFile original = (ImageFile) node;
            ImageFile clone = new ImageFile(original.getName(), original.getSize(), original.getWidth(), original.getHeight());
            clone.getTags().addAll(original.getTags());
            return clone;
        } else if (node instanceof TextFile) {
            TextFile original = (TextFile) node;
            TextFile clone = new TextFile(original.getName(), original.getSize(), original.getEncoding());
            clone.getTags().addAll(original.getTags());
            return clone;
        }
        return null;
    }
}`
            },
            'FileSystemDemo.java': {
                folder: '',
                folderName: 'ä¸»ç¨‹å¼',
                icon: 'â–¶ï¸',
                code: `public class FileSystemDemo {
    public static void main(String[] args) {
        // åˆå§‹åŒ–æ­·å²ç®¡ç†å™¨
        HistoryManager history = new HistoryManager();
        
        // å»ºç«‹æ ¹ç›®éŒ„
        DirectoryComposite root = new DirectoryComposite("æ ¹ç›®éŒ„(Root)");
        
        // å»ºç«‹å°ˆæ¡ˆæ–‡ä»¶ç›®éŒ„
        DirectoryComposite project = new DirectoryComposite("å°ˆæ¡ˆæ–‡ä»¶ (Project_Docs)");
        WordDocument spec = new WordDocument("éœ€æ±‚è¦æ ¼æ›¸.docx", 500 * 1024, 15);
        spec.addTag("Work");
        spec.addTag("Urgent");
        project.add(spec);
        
        ImageFile diagram = new ImageFile("ç³»çµ±æ¶æ§‹åœ–.png", 2 * 1024 * 1024, 1920, 1080);
        diagram.addTag("Work");
        project.add(diagram);
        
        // å»ºç«‹å€‹äººç­†è¨˜ç›®éŒ„
        DirectoryComposite personal = new DirectoryComposite("å€‹äººç­†è¨˜ (Personal_Notes)");
        TextFile todo = new TextFile("å¾…è¾¦æ¸…å–®.txt", 1 * 1024, "UTF-8");
        todo.addTag("Personal");
        personal.add(todo);
        
        // å»ºç«‹å‚™ä»½ç›®éŒ„
        DirectoryComposite archive = new DirectoryComposite("2025å‚™ä»½ (Archive_2025)");
        archive.add(new WordDocument("èˆŠæœƒè­°è¨˜éŒ„.docx", 200 * 1024, 5));
        personal.add(archive);
        
        // çµ„åˆçµæ§‹
        root.add(project);
        root.add(personal);
        root.add(new TextFile("README.txt", 500, "ASCII"));
        
        // æ¸¬è©¦ 1: è¨ˆç®—ç¸½å¤§å°
        System.out.println("=== æ¸¬è©¦ 1: è¨ˆç®—ç¸½å¤§å° ===");
        SizeCalculatorVisitor sizeVisitor = new SizeCalculatorVisitor();
        root.accept(sizeVisitor);
        long total = sizeVisitor.getTotalSize();
        String formatted = total >= 1048576 ? 
            String.format("%.2f MB", total / 1048576.0) : 
            String.format("%.1f KB", total / 1024.0);
        System.out.println("ç¸½å¤§å°: " + total + " Bytes (" + formatted + ")\\n");
        
        // æ¸¬è©¦ 2: æœå°‹ .docx æª”æ¡ˆ
        System.out.println("=== æ¸¬è©¦ 2: æœå°‹ .docx æª”æ¡ˆ ===");
        FileSearchVisitor searchVisitor = new FileSearchVisitor(".docx");
        root.accept(searchVisitor);
        java.util.List<FileLeaf> results = searchVisitor.getResults();
        System.out.println("å…±æ‰¾åˆ° " + results.size() + " å€‹æª”æ¡ˆ:");
        for (FileLeaf file : results) {
            System.out.println("  - " + file.getName() + " (" + file.getSizeDisplay() + ")");
        }
        System.out.println();
        
        // æ¸¬è©¦ 3: é¡¯ç¤ºçµæ§‹ï¼ˆæ’åºå‰ï¼‰
        System.out.println("=== æ¸¬è©¦ 3: æª”æ¡ˆçµæ§‹ï¼ˆæ’åºå‰ï¼‰===");
        TreeDisplayVisitor displayVisitor = new TreeDisplayVisitor();
        root.accept(displayVisitor);
        System.out.println(displayVisitor.getOutput());
        
        // æ¸¬è©¦ 4: æ’åºåŠŸèƒ½
        System.out.println("=== æ¸¬è©¦ 4: æŒ‰åç¨±æ’åº ===");
        history.saveState(root);
        root.sortChildren("name", "asc");
        displayVisitor = new TreeDisplayVisitor();
        root.accept(displayVisitor);
        System.out.println(displayVisitor.getOutput());
        
        // æ¸¬è©¦ 5: Undo åŠŸèƒ½
        System.out.println("=== æ¸¬è©¦ 5: Undo æ’åº ===");
        SystemEntryComponent restored = history.undo(root);
        if (restored != null) {
            root = (DirectoryComposite) restored;
            System.out.println("å·²é‚„åŸè‡³æ’åºå‰ç‹€æ…‹");
            displayVisitor = new TreeDisplayVisitor();
            root.accept(displayVisitor);
            System.out.println(displayVisitor.getOutput());
        }
        
        // æ¸¬è©¦ 6: æ¨™ç±¤ç®¡ç†
        System.out.println("=== æ¸¬è©¦ 6: æ¨™ç±¤ç³»çµ± ===");
        System.out.println("éœ€æ±‚è¦æ ¼æ›¸.docx çš„æ¨™ç±¤: " + spec.getTags());
        System.out.println("å¾…è¾¦æ¸…å–®.txt çš„æ¨™ç±¤: " + todo.getTags());
        
        // æ¸¬è©¦ 7: åˆªé™¤åŠŸèƒ½
        System.out.println("\\n=== æ¸¬è©¦ 7: åˆªé™¤æª”æ¡ˆ ===");
        history.saveState(root);
        project.remove(diagram);
        System.out.println("å·²åˆªé™¤: ç³»çµ±æ¶æ§‹åœ–.png");
        displayVisitor = new TreeDisplayVisitor();
        root.accept(displayVisitor);
        System.out.println(displayVisitor.getOutput());
        
        // æ¸¬è©¦ 8: XML åŒ¯å‡º
        System.out.println("=== æ¸¬è©¦ 8: XML æ ¼å¼åŒ¯å‡º ===");
        XMLExportVisitor xmlVisitor = new XMLExportVisitor();
        root.accept(xmlVisitor);
        System.out.println(xmlVisitor.getXMLOutput());
    }
}`
            }
        };

        // åˆå§‹åŒ–ä»£ç¢¼ç€è¦½å™¨
        function initJavaCodeBrowser() {
            console.log('ğŸš€ åˆå§‹åŒ– Java ä»£ç¢¼ç€è¦½å™¨...');
            const fileList = document.getElementById('javaFileList');
            if (!fileList) {
                console.error('âŒ æ‰¾ä¸åˆ° javaFileList å…ƒç´ ï¼');
                return;
            }
            console.log('âœ… æ‰¾åˆ° javaFileList å…ƒç´ ');
            
            // ç”Ÿæˆç°¡æ½”çš„æ¨¹ç‹€çµæ§‹
            let html = `
                <div class="text-xs text-gray-400 px-3 py-1">src/</div>
                <div onclick="showJavaFile('FileSystemDemo.java')" 
                     class="java-file-item cursor-pointer hover:bg-blue-50 px-3 py-1.5 text-sm border-l-2 border-transparent hover:border-blue-500"
                     data-file="FileSystemDemo.java">
                    <span class="text-blue-600 font-medium">â–¶ FileSystemDemo.java</span>
                </div>
                
                <div class="text-xs text-gray-400 px-3 py-1 mt-2">core/</div>
                <div onclick="showJavaFile('core/SystemEntryComponent.java')" 
                     class="java-file-item cursor-pointer hover:bg-blue-50 px-3 py-1.5 text-sm border-l-2 border-transparent hover:border-blue-500"
                     data-file="core/SystemEntryComponent.java">
                    <span class="text-gray-700">SystemEntryComponent</span>
                </div>
                <div onclick="showJavaFile('core/FileLeaf.java')" 
                     class="java-file-item cursor-pointer hover:bg-blue-50 px-3 py-1.5 text-sm border-l-2 border-transparent hover:border-blue-500"
                     data-file="core/FileLeaf.java">
                    <span class="text-gray-700">FileLeaf</span>
                </div>
                <div onclick="showJavaFile('core/DirectoryComposite.java')" 
                     class="java-file-item cursor-pointer hover:bg-blue-50 px-3 py-1.5 text-sm border-l-2 border-transparent hover:border-blue-500"
                     data-file="core/DirectoryComposite.java">
                    <span class="text-gray-700">DirectoryComposite</span>
                </div>
                
                <div class="text-xs text-gray-400 px-3 py-1 mt-2">files/</div>
                <div onclick="showJavaFile('files/WordDocument.java')" 
                     class="java-file-item cursor-pointer hover:bg-blue-50 px-3 py-1.5 text-sm border-l-2 border-transparent hover:border-blue-500"
                     data-file="files/WordDocument.java">
                    <span class="text-gray-700">WordDocument</span>
                </div>
                <div onclick="showJavaFile('files/ImageFile.java')" 
                     class="java-file-item cursor-pointer hover:bg-blue-50 px-3 py-1.5 text-sm border-l-2 border-transparent hover:border-blue-500"
                     data-file="files/ImageFile.java">
                    <span class="text-gray-700">ImageFile</span>
                </div>
                <div onclick="showJavaFile('files/TextFile.java')" 
                     class="java-file-item cursor-pointer hover:bg-blue-50 px-3 py-1.5 text-sm border-l-2 border-transparent hover:border-blue-500"
                     data-file="files/TextFile.java">
                    <span class="text-gray-700">TextFile</span>
                </div>
                
                <div class="text-xs text-gray-400 px-3 py-1 mt-2">visitor/</div>
                <div onclick="showJavaFile('visitor/IVisitor.java')" 
                     class="java-file-item cursor-pointer hover:bg-blue-50 px-3 py-1.5 text-sm border-l-2 border-transparent hover:border-blue-500"
                     data-file="visitor/IVisitor.java">
                    <span class="text-gray-700">IVisitor</span>
                </div>
                <div onclick="showJavaFile('visitor/SizeCalculatorVisitor.java')" 
                     class="java-file-item cursor-pointer hover:bg-blue-50 px-3 py-1.5 text-sm border-l-2 border-transparent hover:border-blue-500"
                     data-file="visitor/SizeCalculatorVisitor.java">
                    <span class="text-gray-700">SizeCalculatorVisitor</span>
                </div>
                <div onclick="showJavaFile('visitor/FileSearchVisitor.java')" 
                     class="java-file-item cursor-pointer hover:bg-blue-50 px-3 py-1.5 text-sm border-l-2 border-transparent hover:border-blue-500"
                     data-file="visitor/FileSearchVisitor.java">
                    <span class="text-gray-700">FileSearchVisitor</span>
                </div>
                <div onclick="showJavaFile('visitor/TreeDisplayVisitor.java')" 
                     class="java-file-item cursor-pointer hover:bg-blue-50 px-3 py-1.5 text-sm border-l-2 border-transparent hover:border-blue-500"
                     data-file="visitor/TreeDisplayVisitor.java">
                    <span class="text-gray-700">TreeDisplayVisitor</span>
                </div>
                <div onclick="showJavaFile('visitor/XMLExportVisitor.java')" 
                     class="java-file-item cursor-pointer hover:bg-blue-50 px-3 py-1.5 text-sm border-l-2 border-transparent hover:border-blue-500"
                     data-file="visitor/XMLExportVisitor.java">
                    <span class="text-gray-700">XMLExportVisitor</span>
                </div>
                
                <div class="text-xs text-gray-400 px-3 py-1 mt-2">util/</div>
                <div onclick="showJavaFile('util/Tag.java')" 
                     class="java-file-item cursor-pointer hover:bg-blue-50 px-3 py-1.5 text-sm border-l-2 border-transparent hover:border-blue-500"
                     data-file="util/Tag.java">
                    <span class="text-gray-700">Tag</span>
                </div>
                <div onclick="showJavaFile('util/HistoryManager.java')" 
                     class="java-file-item cursor-pointer hover:bg-blue-50 px-3 py-1.5 text-sm border-l-2 border-transparent hover:border-blue-500"
                     data-file="util/HistoryManager.java">
                    <span class="text-gray-700">HistoryManager</span>
                </div>
            `;
            
            console.log('âœ… æª”æ¡ˆåˆ—è¡¨ HTML å·²ç”Ÿæˆï¼Œé•·åº¦:', html.length);
            fileList.innerHTML = html;
            console.log('âœ… æª”æ¡ˆåˆ—è¡¨å·²æ’å…¥ DOM');
            
            // é»˜èªé¡¯ç¤ºç¬¬ä¸€å€‹æ–‡ä»¶
            console.log('ğŸ” æº–å‚™é¡¯ç¤ºé è¨­æª”æ¡ˆ: FileSystemDemo.java');
            showJavaFile('FileSystemDemo.java');
        }

        // é¡¯ç¤ºé¸ä¸­çš„ Java æª”æ¡ˆ
        function showJavaFile(filePath) {
            console.log('ğŸ“‚ å˜—è©¦é¡¯ç¤ºæª”æ¡ˆ:', filePath);
            const file = javaFiles[filePath];
            if (!file) {
                console.error('âŒ æ‰¾ä¸åˆ°æª”æ¡ˆ:', filePath);
                console.log('å¯ç”¨çš„æª”æ¡ˆ:', Object.keys(javaFiles));
                return;
            }
            console.log('âœ… æ‰¾åˆ°æª”æ¡ˆ:', filePath);
            
            const fileName = filePath.split('/').pop();
            
            // æ›´æ–°æª”æ¡ˆåé¡¯ç¤ºï¼ˆé¡¯ç¤ºå®Œæ•´è·¯å¾‘ï¼‰
            document.getElementById('currentFileName').textContent = filePath;
            
            // æ›´æ–°ä»£ç¢¼é¡¯ç¤ºä¸¦æ‡‰ç”¨èªæ³•é«˜äº®
            const codeView = document.getElementById('javaCodeView');
            codeView.textContent = file.code;
            
            // ä½¿ç”¨ Prism.js é€²è¡Œèªæ³•é«˜äº®
            if (window.Prism) {
                Prism.highlightElement(codeView);
            }
            
            // æ›´æ–°é¸ä¸­ç‹€æ…‹
            document.querySelectorAll('.java-file-item').forEach(item => {
                item.classList.remove('bg-blue-50', 'border-blue-500');
                if (item.dataset.file === filePath) {
                    item.classList.add('bg-blue-50', 'border-blue-500');
                }
            });
        }

        // è¤‡è£½ç•¶å‰ä»£ç¢¼
        function copyCurrentCode() {
            const filePath = document.getElementById('currentFileName').textContent;
            const file = javaFiles[filePath];
            if (!file) return;
            
            navigator.clipboard.writeText(file.code).then(() => {
                alert('âœ… ä»£ç¢¼å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—:', err);
            });
        }

        // ========== Java é …ç›®ä¸‹è¼‰åŠŸèƒ½ ==========
        async function downloadJavaProject() {
            // å¼•å…¥ JSZip åº«
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
            script.onload = function() {
                createAndDownloadZip();
            };
            document.head.appendChild(script);
        }

        function createAndDownloadZip() {
            const JSZip = window.JSZip;
            const zip = new JSZip();
            
            // å»ºç«‹è³‡æ–™å¤¾çµæ§‹
            const projectRoot = zip.folder('FileSystemDemo');
            const src = projectRoot.folder('src');
            const core = src.folder('core');
            const files = src.folder('files');
            const visitor = src.folder('visitor');
            
            // core ç›®éŒ„çš„æª”æ¡ˆ
            const coreFiles = {
                'SystemEntryComponent.java': `public abstract class SystemEntryComponent {
    protected String name;
    protected java.time.LocalDateTime created;
    protected long size;
    protected String attributes;
    
    public SystemEntryComponent(String name) {
        this.name = name;
        this.created = java.time.LocalDateTime.now();
        this.size = 0;
    }
    
    public abstract String getType();
    
    // å…¬é–‹æ–¹æ³•ï¼šå¤–éƒ¨èª¿ç”¨
    public void accept(IVisitor visitor) {
        accept(visitor, 0);
    }
    
    // å…§éƒ¨æ–¹æ³•ï¼šéè¿´ä½¿ç”¨
    abstract void accept(IVisitor visitor, int depth);
    
    public String getSizeDisplay() {
        if (size < 1024) return size + " B";
        return String.format("%.1f KB", size / 1024.0);
    }
    
    public String getName() { return name; }
    public long getSize() { return size; }
}`,
                'FileLeaf.java': `public abstract class FileLeaf extends SystemEntryComponent {
    public FileLeaf(String name, long sizeBytes) {
        super(name);
        this.size = sizeBytes;
    }
    
    @Override
    void accept(IVisitor visitor, int depth) {
        visitor.visit(this, depth);
    }
}`,
                'DirectoryComposite.java': `import java.util.*;

public class DirectoryComposite extends SystemEntryComponent {
    private List<SystemEntryComponent> children = new ArrayList<>();
    
    public DirectoryComposite(String name) {
        super(name);
    }
    
    public void add(SystemEntryComponent child) {
        children.add(child);
    }
    
    public void remove(SystemEntryComponent child) {
        children.remove(child);
    }
    
    public List<SystemEntryComponent> getChildren() {
        return new ArrayList<>(children);
    }
    
    @Override
    public String getType() { return "ç›®éŒ„"; }
    
    @Override
    void accept(IVisitor visitor, int depth) {
        visitor.visit(this, depth);
        for (SystemEntryComponent child : children) {
            child.accept(visitor, depth + 1);
        }
    }
}`
            };
            
            // files ç›®éŒ„çš„æª”æ¡ˆ
            const filesFiles = {
                'WordDocument.java': `public class WordDocument extends FileLeaf {
    private int pages;
    
    public WordDocument(String name, long size, int pages) {
        super(name, size);
        this.pages = pages;
    }
    
    @Override
    public String getType() { return "Word æª”æ¡ˆ"; }
    
    public int getPages() { return pages; }
}`,
                'ImageFile.java': `public class ImageFile extends FileLeaf {
    private int width;
    private int height;
    
    public ImageFile(String name, long size, int width, int height) {
        super(name, size);
        this.width = width;
        this.height = height;
    }
    
    @Override
    public String getType() { return "åœ–ç‰‡"; }
    
    public int getWidth() { return width; }
    public int getHeight() { return height; }
}`,
                'TextFile.java': `public class TextFile extends FileLeaf {
    private String encoding;
    
    public TextFile(String name, long size, String encoding) {
        super(name, size);
        this.encoding = encoding;
    }
    
    @Override
    public String getType() { return "ç´”æ–‡å­—æª”"; }
    
    public String getEncoding() { return encoding; }
}`
            };
            
            // visitor ç›®éŒ„çš„æª”æ¡ˆ
            const visitorFiles = {
                'IVisitor.java': `public interface IVisitor {
    void visit(FileLeaf leaf, int depth);
    void visit(DirectoryComposite composite, int depth);
}`,

                'SizeCalculatorVisitor.java': `public class SizeCalculatorVisitor implements IVisitor {
    private long totalSize = 0;
    
    @Override
    public void visit(FileLeaf leaf, int depth) {
        totalSize += leaf.getSize();
    }
    
    @Override
    public void visit(DirectoryComposite composite, int depth) {
        // éè¿´ç”± DirectoryComposite.accept æ–¹æ³•è™•ç†
    }
    
    public long getTotalSize() { return totalSize; }
}`,
                'FileSearchVisitor.java': `import java.util.*;

public class FileSearchVisitor implements IVisitor {
    private String extension;
    private List<FileLeaf> results = new ArrayList<>();
    
    public FileSearchVisitor(String extension) {
        this.extension = extension.toLowerCase();
    }
    
    @Override
    public void visit(FileLeaf leaf, int depth) {
        if (leaf.getName().toLowerCase().endsWith(extension)) {
            results.add(leaf);
        }
    }
    
    @Override
    public void visit(DirectoryComposite composite, int depth) {
        // éè¿´ç”± DirectoryComposite.accept æ–¹æ³•è™•ç†
    }
    
    public List<FileLeaf> getResults() { return results; }
}`,
                'XMLExportVisitor.java': `import java.util.*;

public class XMLExportVisitor implements IVisitor {
    private StringBuilder xmlOutput = new StringBuilder();
    private Map<Integer, String> depthTags = new HashMap<>();
    private int maxDepth = 0;
    
    @Override
    public void visit(FileLeaf leaf, int depth) {
        // å…ˆé—œé–‰æ·±åº¦å¤§æ–¼ç•¶å‰æ·±åº¦çš„æ¨™ç±¤
        closeTagsGreaterThan(depth - 1);
        
        String indent = getIndent(depth);
        xmlOutput.append(indent).append("<").append(leaf.getName())
                .append("></").append(leaf.getName()).append(">\\n");
    }
    
    @Override
    public void visit(DirectoryComposite composite, int depth) {
        // å…ˆé—œé–‰æ·±åº¦å¤§æ–¼ç­‰æ–¼ç•¶å‰æ·±åº¦çš„æ¨™ç±¤
        closeTagsGreaterThan(depth - 1);
        
        // è¼¸å‡ºæ‰€æœ‰ç›®éŒ„æ¨™ç±¤ï¼ˆåŒ…æ‹¬æ ¹ç›®éŒ„ï¼‰
        String indent = getIndent(depth);
        xmlOutput.append(indent).append("<").append(composite.getName()).append(">\\n");
        depthTags.put(depth, composite.getName());
        maxDepth = Math.max(maxDepth, depth);
    }
    
    private void closeTagsGreaterThan(int minDepth) {
        for (int d = maxDepth; d > minDepth; d--) {
            if (depthTags.containsKey(d)) {
                String indent = getIndent(d);
                xmlOutput.append(indent).append("</").append(depthTags.get(d)).append(">\\n");
                depthTags.remove(d);
            }
        }
        // æ›´æ–° maxDepth
        while (maxDepth > minDepth && !depthTags.containsKey(maxDepth)) {
            maxDepth--;
        }
    }
    
    private String getIndent(int depth) {
        StringBuilder sb = new StringBuilder();
        for (int i = 0; i < depth; i++) {
            sb.append("  ");
        }
        return sb.toString();
    }
    
    public String getXMLOutput() {
        // é—œé–‰æ‰€æœ‰å‰©é¤˜æ¨™ç±¤
        for (int d = maxDepth; d >= 0; d--) {
            if (depthTags.containsKey(d)) {
                String indent = getIndent(d);
                xmlOutput.append(indent).append("</").append(depthTags.get(d)).append(">\\n");
            }
        }
        return xmlOutput.toString();
    }
}`,
                'TreeDisplayVisitor.java': `public class TreeDisplayVisitor implements IVisitor {
    private StringBuilder output = new StringBuilder();
    private boolean isRoot = true;
    
    @Override
    public void visit(FileLeaf leaf, int depth) {
        String indent = getIndent(depth);
        output.append(indent).append("ğŸ“„ ").append(leaf.getName());
        if (leaf instanceof WordDocument) {
            WordDocument doc = (WordDocument) leaf;
            output.append(" (Word, ").append(doc.getPages()).append("p, ")
                   .append(doc.getSizeDisplay()).append(")");
        } else if (leaf instanceof ImageFile) {
            ImageFile img = (ImageFile) leaf;
            output.append(" (Img, ").append(img.getWidth()).append("x")
                   .append(img.getHeight()).append(", ")
                   .append(img.getSizeDisplay()).append(")");
        } else if (leaf instanceof TextFile) {
            TextFile txt = (TextFile) leaf;
            output.append(" (Txt, ").append(txt.getEncoding()).append(", ")
                   .append(txt.getSizeDisplay()).append(")");
        }
        output.append("\\n");
    }
    
    @Override
    public void visit(DirectoryComposite composite, int depth) {
        if (!isRoot) {
            String indent = getIndent(depth);
            output.append(indent).append("ğŸ“ ").append(composite.getName()).append("\\n");
        }
        isRoot = false;
    }
    
    private String getIndent(int depth) {
        StringBuilder sb = new StringBuilder();
        for (int i = 0; i < depth; i++) {
            sb.append("  ");
        }
        return sb.toString();
    }
    
    public String getOutput() { return output.toString(); }
}`
            };
            
            // ä¸»ç¨‹å¼æª”æ¡ˆ
            const mainFile = `public class FileSystemDemo {
    public static void main(String[] args) {
        // å»ºç«‹æ ¹ç›®éŒ„
        DirectoryComposite root = new DirectoryComposite("æ ¹ç›®éŒ„(Root)");
        
        // å»ºç«‹å°ˆæ¡ˆæ–‡ä»¶ç›®éŒ„
        DirectoryComposite project = new DirectoryComposite("å°ˆæ¡ˆæ–‡ä»¶ (Project_Docs)");
        project.add(new WordDocument("éœ€æ±‚è¦æ ¼æ›¸.docx", 500 * 1024, 15));
        project.add(new ImageFile("ç³»çµ±æ¶æ§‹åœ–.png", 2 * 1024 * 1024, 1920, 1080));
        
        // å»ºç«‹å€‹äººç­†è¨˜ç›®éŒ„
        DirectoryComposite personal = new DirectoryComposite("å€‹äººç­†è¨˜ (Personal_Notes)");
        personal.add(new TextFile("å¾…è¾¦æ¸…å–®.txt", 1 * 1024, "UTF-8"));
        
        // å»ºç«‹å‚™ä»½ç›®éŒ„
        DirectoryComposite archive = new DirectoryComposite("2025å‚™ä»½ (Archive_2025)");
        archive.add(new WordDocument("èˆŠæœƒè­°è¨˜éŒ„.docx", 200 * 1024, 5));
        personal.add(archive);
        
        // çµ„åˆçµæ§‹
        root.add(project);
        root.add(personal);
        root.add(new TextFile("README.txt", 500, "ASCII"));
        
        // æ¸¬è©¦ 1: è¨ˆç®—ç¸½å¤§å°
        System.out.println("=== è¨ˆç®—ç¸½å¤§å° ===");
        SizeCalculatorVisitor sizeVisitor = new SizeCalculatorVisitor();
        root.accept(sizeVisitor);
        long total = sizeVisitor.getTotalSize();
        String formatted = total >= 1048576 ? 
            String.format("%.2f MB", total / 1048576.0) : 
            String.format("%.1f KB", total / 1024.0);
        System.out.println("ç¸½å¤§å°: " + total + " Bytes (" + formatted + ")\\n");
        
        // æ¸¬è©¦ 2: æœå°‹ .docx æª”æ¡ˆ
        System.out.println("=== æœå°‹ .docx æª”æ¡ˆ ===");
        FileSearchVisitor searchVisitor = new FileSearchVisitor(".docx");
        root.accept(searchVisitor);
        java.util.List<FileLeaf> results = searchVisitor.getResults();
        System.out.println("å…±æ‰¾åˆ° " + results.size() + " å€‹æª”æ¡ˆ:");
        for (FileLeaf file : results) {
            System.out.println("  - " + file.getName() + " (" + file.getSizeDisplay() + ")");
        }
        System.out.println();
        
        // æ¸¬è©¦ 3: é¡¯ç¤ºçµæ§‹
        System.out.println("=== æª”æ¡ˆçµæ§‹ ===");
        TreeDisplayVisitor displayVisitor = new TreeDisplayVisitor();
        root.accept(displayVisitor);
        System.out.println(displayVisitor.getOutput());
        
        // æ¸¬è©¦ 4: XML åŒ¯å‡º
        System.out.println("=== XML æ ¼å¼åŒ¯å‡º ===");
        XMLExportVisitor xmlVisitor = new XMLExportVisitor();
        root.accept(xmlVisitor);
        System.out.println(xmlVisitor.getXMLOutput());
    }
}`;
            
            // æ·»åŠ æª”æ¡ˆåˆ°å°æ‡‰ç›®éŒ„
            Object.entries(coreFiles).forEach(([filename, content]) => {
                core.file(filename, content);
            });
            
            Object.entries(filesFiles).forEach(([filename, content]) => {
                files.file(filename, content);
            });
            
            Object.entries(visitorFiles).forEach(([filename, content]) => {
                visitor.file(filename, content);
            });
            
            // æ·»åŠ ä¸»ç¨‹å¼åˆ° src æ ¹ç›®éŒ„
            src.file('FileSystemDemo.java', mainFile);
            
            // æ·»åŠ  README
            projectRoot.file('README.md', `# é›²ç«¯æª”æ¡ˆç®¡ç†ç³»çµ± - Java å¯¦ä½œ

## é …ç›®æ¦‚è¿°
ä½¿ç”¨ Visitor Patternï¼ˆè¨ªå•è€…æ¨¡å¼ï¼‰å¯¦ä½œçš„æª”æ¡ˆç³»çµ±ç®¡ç†ç³»çµ±ï¼Œå±•ç¤ºè¨­è¨ˆæ¨¡å¼åœ¨å¯¦éš›æ‡‰ç”¨ä¸­çš„å¨åŠ›ã€‚

## é …ç›®çµæ§‹
\`\`\`
FileSystemDemo/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ SystemEntryComponent.java    // åŸºç¤å…ƒä»¶æŠ½è±¡é¡
â”‚   â”‚   â”œâ”€â”€ FileLeaf.java                // æ–‡ä»¶è‘‰å­ç¯€é»æŠ½è±¡é¡
â”‚   â”‚   â””â”€â”€ DirectoryComposite.java      // ç›®éŒ„è¤‡åˆç¯€é»
â”‚   â”œâ”€â”€ files/
â”‚   â”‚   â”œâ”€â”€ WordDocument.java            // Word æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ ImageFile.java               // åœ–ç‰‡æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ TextFile.java                // ç´”æ–‡å­—æ–‡ä»¶
â”‚   â”œâ”€â”€ visitor/
â”‚   â”‚   â”œâ”€â”€ IVisitor.java                // è¨ªå•è€…æ¥å£
â”‚   â”‚   â”œâ”€â”€ SizeCalculatorVisitor.java   // å¤§å°è¨ˆç®—è¨ªå•è€…
â”‚   â”‚   â”œâ”€â”€ FileSearchVisitor.java       // æ–‡ä»¶æœå°‹è¨ªå•è€…
â”‚   â”‚   â”œâ”€â”€ TreeDisplayVisitor.java      // æ–‡æœ¬é¡¯ç¤ºè¨ªå•è€…
â”‚   â”‚   â””â”€â”€ XMLExportVisitor.java        // XML åŒ¯å‡ºè¨ªå•è€…
â”‚   â””â”€â”€ FileSystemDemo.java              // ä¸»ç¨‹å¼
â””â”€â”€ README.md                            // æœ¬æ–‡ä»¶
\`\`\`

## ç·¨è­¯æ­¥é©Ÿ

### Windows
\`\`\`cmd
cd FileSystemDemo
javac -d bin -encoding UTF-8 src\\core\\*.java src\\files\\*.java src\\visitor\\*.java src\\FileSystemDemo.java
java -cp bin FileSystemDemo
\`\`\`

### macOS / Linux
\`\`\`bash
cd FileSystemDemo
javac -d bin -encoding UTF-8 src/core/*.java src/files/*.java src/visitor/*.java src/FileSystemDemo.java
java -cp bin FileSystemDemo
\`\`\`

## é‹è¡Œçµæœé æœŸ
\`\`\`
=== è¨ˆç®—ç¸½å¤§å° ===
ç¸½å¤§å°: 2603524 Bytes (2.48 MB)

=== æœå°‹ .docx æª”æ¡ˆ ===
å…±æ‰¾åˆ° 2 å€‹æª”æ¡ˆ:
  - éœ€æ±‚è¦æ ¼æ›¸.docx (500.0 KB)
  - èˆŠæœƒè­°è¨˜éŒ„.docx (200.0 KB)

=== æª”æ¡ˆçµæ§‹ ===
ğŸ“ å°ˆæ¡ˆæ–‡ä»¶ (Project_Docs)
  ğŸ“„ éœ€æ±‚è¦æ ¼æ›¸.docx (Word, 15p, 500.0 KB)
  ğŸ–¼ï¸ ç³»çµ±æ¶æ§‹åœ–.png (Img, 1920x1080, 2.0 MB)
ğŸ“ å€‹äººç­†è¨˜ (Personal_Notes)
  ğŸ“„ å¾…è¾¦æ¸…å–®.txt (Txt, UTF-8, 1.0 KB)
  ğŸ“ 2025å‚™ä»½ (Archive_2025)
    ğŸ“„ èˆŠæœƒè­°è¨˜éŒ„.docx (Word, 5p, 200.0 KB)
ğŸ“„ README.txt (Txt, ASCII, 500 B)

=== XML æ ¼å¼åŒ¯å‡º ===
<å°ˆæ¡ˆæ–‡ä»¶ (Project_Docs) type="ç›®éŒ„">
  <éœ€æ±‚è¦æ ¼æ›¸.docx type="Word æª”æ¡ˆ"></éœ€æ±‚è¦æ ¼æ›¸.docx>
  <ç³»çµ±æ¶æ§‹åœ–.png type="åœ–ç‰‡"></ç³»çµ±æ¶æ§‹åœ–.png>
</å°ˆæ¡ˆæ–‡ä»¶ (Project_Docs)>
...
\`\`\`

## é—œéµæ¦‚å¿µ

### Visitor Patternï¼ˆè¨ªå•è€…æ¨¡å¼ï¼‰
- **ç›®çš„**ï¼šå°‡ç®—æ³•èˆ‡å…¶æ‰€ä½œç”¨çš„å°è±¡åˆ†é›¢
- **å„ªå‹¢**ï¼š
  - âœ… é–‹æ”¾å°é–‰åŸå‰‡ï¼šæ–°å¢æ“ä½œç„¡éœ€ä¿®æ”¹ç¾æœ‰é¡åˆ¥
  - âœ… å–®ä¸€è·è²¬ï¼šæ¯å€‹è¨ªå•è€…åªè² è²¬ä¸€ç¨®æ“ä½œ
  - âœ… æ˜“æ–¼ç¶­è­·ï¼šé‚è¼¯æ¸…æ™°ï¼Œä»£ç¢¼çµ„ç¹”åˆç†

### Interface Segregation Principleï¼ˆæ¥å£éš”é›¢åŸå‰‡ï¼‰
- ä¸å¼·åˆ¶å®¢æˆ¶ç«¯ä¾è³´å®ƒå€‘ä¸ä½¿ç”¨çš„æ¥å£
- **è¨­è¨ˆåˆ†é›¢**ï¼š
  - \`IVisitor\`ï¼šæ ¸å¿ƒè¨ªå•å¥‘ç´„ï¼ˆvisit æ–¹æ³•ï¼‰
  - \`DepthManagedVisitor\`ï¼šæ“´å±•æ¥å£ï¼Œåƒ…ä¾›éœ€è¦æ·±åº¦ç®¡ç†çš„è¨ªå•è€…ä½¿ç”¨
- **å„ªå‹¢**ï¼š
  - ç°¡å–®è¨ªå•è€…ç„¡éœ€å¯¦ç¾ç„¡ç”¨æ–¹æ³•
  - ä»£ç¢¼æ›´æ¸…æ™°ï¼Œæ¸›å°‘å†—ä½™

### è¨­è¨ˆæ¨¡å¼æ‡‰ç”¨
1. **Composite Pattern**ï¼šæ¨¹ç‹€çµæ§‹ï¼ˆç›®éŒ„/æ–‡ä»¶ï¼‰
2. **Visitor Pattern**ï¼šä¸åŒçš„è¨ªå•æ“ä½œ
3. **Strategy Pattern**ï¼šä¸åŒè¨ªå•è€…çš„ä¸åŒç­–ç•¥
4. **Interface Segregation**ï¼šå…©å±¤æ¥å£æ¶æ§‹

## èª²ç¨‹å­¸ç¿’é‡é»

1. **ç†è§£é›™é‡åˆ†æ´¾**
   - è¨ªå•è€…æ¨¡å¼é€šé \`accept()\` å’Œ \`visit()\` å¯¦ç¾é›™é‡åˆ†æ´¾
   - æ ¹æ“šè¨ªå•è€…å’Œå…ƒç´ çš„é¡å‹æ±ºå®šåŸ·è¡Œçš„æ–¹æ³•
   - \`instanceof\` æª¢æŸ¥ç”¨æ–¼å‹•æ…‹è­˜åˆ¥è¨ªå•è€…é¡å‹

2. **åˆ†é›¢é—œæ³¨é»**
   - æ•¸æ“šçµæ§‹ï¼ˆComponentï¼‰èˆ‡æ“ä½œé‚è¼¯ï¼ˆVisitorï¼‰åˆ†é›¢
   - æ˜“æ–¼æ–°å¢åŠŸèƒ½è€Œç„¡éœ€ä¿®æ”¹ç¾æœ‰ä»£ç¢¼
   - DirectoryComposite çš„ \`accept()\` å±•ç¤ºäº†æ™ºèƒ½åˆ†æ´¾

3. **å¯¦ç¾å¯æ“´å±•æ€§**
   - è¦æ–°å¢çµ±è¨ˆã€å‚™ä»½ã€é©—è­‰ç­‰åŠŸèƒ½ï¼Ÿåªéœ€æ–°å¢ Visitor
   - ç¬¦åˆé–‹æ”¾å°é–‰åŸå‰‡ï¼ˆOpen/Closed Principleï¼‰
   - æ¯å€‹ Visitor å°ˆæ³¨æ–¼è‡ªå·±çš„è·è²¬

4. **æ¥å£è¨­è¨ˆæœ€ä½³å¯¦è¸**
   - æœ€å°åŒ–æ¥å£ï¼šIVisitor åªåŒ…å«å¿…é ˆæ–¹æ³•
   - åˆ†å±¤è¨­è¨ˆï¼šDepthManagedVisitor æ“´å±• IVisitor
   - é¿å…æ¥å£æ±¡æŸ“ï¼šä¸å¼·åˆ¶å¯¦ç¾ç„¡ç”¨æ–¹æ³•

## æ“´å±•ç·´ç¿’

å˜—è©¦å¯¦ç¾ä»¥ä¸‹ Visitorï¼š

1. **FileCountVisitor** - çµ±è¨ˆæª”æ¡ˆæ•¸é‡ï¼ˆå¯¦ç¾ IVisitorï¼‰
2. **BackupVisitor** - å‚™ä»½æ“ä½œï¼ˆå¯¦ç¾ IVisitorï¼Œä¸éœ€æ·±åº¦ï¼‰
3. **ValidateVisitor** - é©—è­‰æª”æ¡ˆå®Œæ•´æ€§ï¼ˆå¯¦ç¾ IVisitorï¼‰
4. **TreePrintVisitor** - ç¾åŒ–æ¨¹å½¢é¡¯ç¤ºï¼ˆå¯¦ç¾ DepthManagedVisitorï¼Œéœ€æ·±åº¦ï¼‰
5. **PermissionVisitor** - æ¬Šé™æª¢æŸ¥ï¼ˆå¯¦ç¾ IVisitorï¼‰

## Java ç·¨è­¯èˆ‡é‹è¡Œ

\`\`\`bash
# ç·¨è­¯æ‰€æœ‰æºæ–‡ä»¶
javac src/*.java

# é‹è¡Œä¸»ç¨‹åº
java -cp src FileSystemDemo

# è¼¸å‡ºç¯„ä¾‹å±•ç¤ºå››ç¨®è¨ªå•å™¨çš„æ•ˆæœ
\`\`\`

ç¥ä½ å­¸ç¿’æ„‰å¿«ï¼ ğŸ“
`);
            
            // ç”Ÿæˆä¸¦ä¸‹è¼‰ zip
            zip.generateAsync({type: 'blob'}).then(function(content) {
                const url = URL.createObjectURL(content);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'FileSystemDemo.zip';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                alert('âœ… æª”æ¡ˆå·²ä¸‹è¼‰ï¼è§£å£“å¾Œå³å¯ä½¿ç”¨ã€‚');
            });
        }
    </script>
</body>
</html>